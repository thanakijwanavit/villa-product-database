---

title: Database Class


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>missing environment variable &#39;INVENTORY_BUCKET_NAME&#39; in query NB
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Database-Class">Main Database Class<a class="anchor-link" href="#Main-Database-Class"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductDatabase" class="doc_header"><code>class</code> <code>ProductDatabase</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L61" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductDatabase</code>(<strong><code>hash_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>range_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>_user_instantiated</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong>**<code>attributes</code></strong>:<code>Any</code>) :: <a href="/villaProductDatabase/query.html#Querier"><code>Querier</code></a></p>
</blockquote>
<p>Defines a <code>PynamoDB</code> Model</p>
<p>This model is backed by a table in DynamoDB.
You can create the table by with the <code>create_table</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="set-up-notebook-for-tests">set up notebook for tests<a class="anchor-link" href="#set-up-notebook-for-tests"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Update-with-dictionary">Update with dictionary<a class="anchor-link" href="#Update-with-dictionary"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="test">test<a class="anchor-link" href="#test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">## get original item</span>
<span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;engname is </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">### update item</span>
<span class="n">updatedItem</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateWithDict</span><span class="p">(</span><span class="n">item</span><span class="p">,{</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span><span class="s1">&#39;testName&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;testName&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name is changed to  </span><span class="si">{</span><span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>engname is JOHNNIE WALKER RED 70 CL.
 name is changed to  testName
CPU times: user 3.43 ms, sys: 292 µs, total: 3.72 ms
Wall time: 6 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Batch-load-and-save-data">Batch load and save data<a class="anchor-link" href="#Batch-load-and-save-data"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;loadFrom cache not working&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 5ab4ab6eb4875b73fc878567db2765589e723e37
data is still in sync, using local cache
CPU times: user 308 ms, sys: 93.6 ms, total: 401 ms
Wall time: 682 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Dump-database-to-s3-cache">Dump database to s3 cache<a class="anchor-link" href="#Dump-database-to-s3-cache"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">resetCache</span><span class="p">():</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">resetS3Cache</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">Response</span><span class="o">.</span><span class="n">returnSuccess</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="check-table-length">check table length<a class="anchor-link" href="#check-table-length"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">table</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 7.59 s, sys: 452 ms, total: 8.04 s
Wall time: 11.8 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>45075</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="reset-cache-test">reset cache test<a class="anchor-link" href="#reset-cache-test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">resetCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>db is scanned
(45075, 75) changes to update
hashKey is allData-hash
saving hash to s3
saved hash 9dc8d22f45ca04f053917ab08f13f4ec104dccc4
CPU times: user 14.2 s, sys: 1.01 s, total: 15.2 s
Wall time: 20.2 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;true&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="CacheDb-method">CacheDb method<a class="anchor-link" href="#CacheDb-method"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cacheDb" class="doc_header"><code>cacheDb</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L109" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cacheDb</code>(<strong><code>bucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>'allData'</code></em>, <strong><code>limit</code></strong>=<em><code>100</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>cache db to s3 and local efs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># originalDb = ProductDatabase.loadFromCache()</span>
<span class="c1"># listPd = list(product.needsUpdateIndex.query(&#39;Y&#39;, limit=5))</span>
<span class="c1"># changesDf = ProductDatabase.toDf(listPd)</span>
<span class="c1"># changesDf.set_index(&#39;cprcode&#39;, inplace=True)</span>
<span class="c1"># originalDb.set_index(&#39;cprcode&#39;,inplace=True)</span>
<span class="c1"># newDf = originalDb.append(changesDf)</span>
<span class="c1"># newDf.reset_index(inplace=True)</span>
<span class="c1"># originalDb</span>

<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 9dc8d22f45ca04f053917ab08f13f4ec104dccc4
data is still in sync, using local cache
quering for changes
convert to df
(100, 58)
hashKey is allData-hash
saving hash to s3
saved hash 575c60ff28c4571b5ca0ab05ae8b64816c680f95
saving to remote cache
CPU times: user 4.02 s, sys: 470 ms, total: 4.49 s
Wall time: 6.17 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>...</th>
      <th>preorder_fix_date</th>
      <th>preorder_relative_day</th>
      <th>meta_title</th>
      <th>meta_keywords</th>
      <th>meta_description</th>
      <th>depth</th>
      <th>priority_score</th>
      <th>product_attribute_id</th>
      <th>product_attribute</th>
      <th>related_products</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>225407.0</td>
      <td>225407</td>
      <td>225407</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>True</td>
      <td>87</td>
      <td>21</td>
      <td>KONJAC LINGUINI</td>
      <td>010</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>241101.0</td>
      <td>241101</td>
      <td>241101</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>True</td>
      <td>06</td>
      <td>08</td>
      <td>BUMILGOCHUJANG</td>
      <td>006</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>190100.0</td>
      <td>190100</td>
      <td>190100</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>True</td>
      <td>05</td>
      <td>19</td>
      <td>WHITE SHIMEJI</td>
      <td>143</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>62644.0</td>
      <td>62644</td>
      <td>62644</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>True</td>
      <td>07</td>
      <td>08</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>192167.0</td>
      <td>192167</td>
      <td>192167</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>True</td>
      <td>10</td>
      <td>09</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>005</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>45071</th>
      <td>76931.0</td>
      <td>76931</td>
      <td>76931</td>
      <td>Y</td>
      <td>ST. REMY BRANDY 70CL</td>
      <td>True</td>
      <td>16</td>
      <td>01</td>
      <td>ST. REMY BRANDY 70CL.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45072</th>
      <td>203391.0</td>
      <td>203391</td>
      <td>203391</td>
      <td>Y</td>
      <td>CH TERREFORT-QUANCA</td>
      <td>True</td>
      <td>10</td>
      <td>01</td>
      <td>CH TERREFORT-QUANCARD</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45073</th>
      <td>205603.0</td>
      <td>205603</td>
      <td>205603</td>
      <td>Y</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>True</td>
      <td>15</td>
      <td>19</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>132</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45074</th>
      <td>211585.0</td>
      <td>211585</td>
      <td>211585</td>
      <td>Y</td>
      <td>EGG</td>
      <td>True</td>
      <td>49</td>
      <td>19</td>
      <td>EGG</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>239605</th>
      <td>NaN</td>
      <td>239605</td>
      <td>239605</td>
      <td>Y</td>
      <td>MILLE LITTLEPONY WON</td>
      <td>True</td>
      <td>24</td>
      <td>19</td>
      <td>MILLE LITTLEPONY WONDERFUL BLUSHER #3TWI</td>
      <td>066</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>45076 rows × 75 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="dump-to-s3-method">dump to s3 method<a class="anchor-link" href="#dump-to-s3-method"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@add_class_method</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dumpToS3</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucketName</span><span class="o">=</span> <span class="n">INVENTORY_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;allData&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">dumpToS3</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 575c60ff28c4571b5ca0ab05ae8b64816c680f95
data is still in sync, using local cache
quering for changes
convert to df
(1000, 58)
hashKey is allData-hash
saving hash to s3
saved hash 2c173546efe68a494d4484423b33e1b2e8de6d03
saving to remote cache
CPU times: user 4.38 s, sys: 496 ms, total: 4.88 s
Wall time: 7.21 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>...</th>
      <th>preorder_fix_date</th>
      <th>preorder_relative_day</th>
      <th>meta_title</th>
      <th>meta_keywords</th>
      <th>meta_description</th>
      <th>depth</th>
      <th>priority_score</th>
      <th>product_attribute_id</th>
      <th>product_attribute</th>
      <th>related_products</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>225407.0</td>
      <td>225407</td>
      <td>225407</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>True</td>
      <td>87</td>
      <td>21</td>
      <td>KONJAC LINGUINI</td>
      <td>010</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>241101.0</td>
      <td>241101</td>
      <td>241101</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>True</td>
      <td>06</td>
      <td>08</td>
      <td>BUMILGOCHUJANG</td>
      <td>006</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>190100.0</td>
      <td>190100</td>
      <td>190100</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>True</td>
      <td>05</td>
      <td>19</td>
      <td>WHITE SHIMEJI</td>
      <td>143</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>62644.0</td>
      <td>62644</td>
      <td>62644</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>True</td>
      <td>07</td>
      <td>08</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>192167.0</td>
      <td>192167</td>
      <td>192167</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>True</td>
      <td>10</td>
      <td>09</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>005</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>45071</th>
      <td>76931.0</td>
      <td>76931</td>
      <td>76931</td>
      <td>Y</td>
      <td>ST. REMY BRANDY 70CL</td>
      <td>True</td>
      <td>16</td>
      <td>01</td>
      <td>ST. REMY BRANDY 70CL.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45072</th>
      <td>203391.0</td>
      <td>203391</td>
      <td>203391</td>
      <td>Y</td>
      <td>CH TERREFORT-QUANCA</td>
      <td>True</td>
      <td>10</td>
      <td>01</td>
      <td>CH TERREFORT-QUANCARD</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45073</th>
      <td>205603.0</td>
      <td>205603</td>
      <td>205603</td>
      <td>Y</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>True</td>
      <td>15</td>
      <td>19</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>132</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45074</th>
      <td>211585.0</td>
      <td>211585</td>
      <td>211585</td>
      <td>Y</td>
      <td>EGG</td>
      <td>True</td>
      <td>49</td>
      <td>19</td>
      <td>EGG</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>171067</th>
      <td>NaN</td>
      <td>171067</td>
      <td>171067</td>
      <td>Y</td>
      <td>AMPA ORANGE HONEY QU</td>
      <td>True</td>
      <td>26</td>
      <td>19</td>
      <td>AMPA ORANGE HONEY QUEEN</td>
      <td>023</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>45076 rows × 75 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="lambda-function-dump-to-s3">lambda function dump to s3<a class="anchor-link" href="#lambda-function-dump-to-s3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpToS3" class="doc_header"><code>lambdaDumpToS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L134" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpToS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">lambdaDumpToS3</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 2c173546efe68a494d4484423b33e1b2e8de6d03
data is still in sync, using local cache
quering for changes
convert to df
(500, 58)
hashKey is allData-hash
saving hash to s3
saved hash 6c2f587eca3f1e4b484acd6f07dfba9a1152c155
saving to remote cache
{&#39;cprcode&#39;: 225407.0, &#39;iprcode&#39;: 225407, &#39;oprcode&#39;: 225407, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;MOKU&#39;, &#39;pr_active&#39;: True, &#39;pr_cgcode&#39;: &#39;87&#39;, &#39;pr_dpcode&#39;: &#39;21&#39;, &#39;pr_engname&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_ggcode&#39;: &#39;010&#39;, &#39;pr_market&#39;: &#39;MOKU&#39;, &#39;pr_name&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;F1148&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: &#39;&#39;, &#39;pr_country_en&#39;: &#39;Thailand&#39;, &#39;pr_keyword_th&#39;: &#39;&#39;, &#39;pr_keyword_en&#39;: &#39;&#39;, &#39;pr_filter_th&#39;: &#39;&#39;, &#39;pr_filter_en&#39;: &#39;&#39;, &#39;online_category_l1_th&#39;: &#39;อาหารสำเร็จรูปและไข่&#39;, &#39;online_category_l1_en&#39;: &#39;Delicatessen &amp; Eggs&#39;, &#39;online_category_l2_th&#39;: &#39;อาหารพร้อมทาน&#39;, &#39;online_category_l2_en&#39;: &#39;Ready Meals&#39;, &#39;online_category_l3_th&#39;: &#39;&#39;, &#39;online_category_l3_en&#39;: &#39;Other Ready Meals&#39;, &#39;villa_category_l1_en&#39;: &#39;Fresh&#39;, &#39;villa_category_l2_en&#39;: &#39;Delicatessen&#39;, &#39;villa_category_l3_en&#39;: &#39;Local&#39;, &#39;villa_category_l4_en&#39;: &#39;Local Foods&#39;, &#39;content_en&#39;: &#39;0225407 0225407 KONJAC LINGUINI&#39;, &#39;content_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;hema_brand_th&#39;: &#39;&#39;, &#39;hema_brand_en&#39;: &#39;Moku&#39;, &#39;hema_sizedesc&#39;: &#39;160g&#39;, &#39;pr_brand_en&#39;: &#39;&#39;, &#39;pr_brand_th&#39;: &#39;&#39;, &#39;pr_online_name_en&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_online_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;hema_name_en&#39;: &#39;Konjac Flat Noodle&#39;, &#39;hema_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;pr_name_en&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;pr_barcode&#39;: &#39;8858661102531&#39;, &#39;pr_barcode2&#39;: &#39;885866110253&#39;, &#39;sort_weight&#39;: &#39;0&#39;, &#39;master_online&#39;: True, &#39;salemode_unit&#39;: &#39;ITEM&#39;, &#39;ba_nprice&#39;: 25.0, &#39;sort_villa_sku&#39;: 0, &#39;product_detail_description&#39;: &#39;&#39;, &#39;height&#39;: 0.0, &#39;width&#39;: 0.0, &#39;dept&#39;: 0.0, &#39;weight&#39;: 0.0, &#39;psqty&#39;: 1, &#39;avail_store&#39;: None, &#39;portion&#39;: None, &#39;warehouse&#39;: None, &#39;consign_inv&#39;: None, &#39;enabled&#39;: None, &#39;preorder_delivery_type&#39;: None, &#39;preorder_fix_date&#39;: None, &#39;preorder_relative_day&#39;: None, &#39;meta_title&#39;: None, &#39;meta_keywords&#39;: None, &#39;meta_description&#39;: None, &#39;depth&#39;: None, &#39;priority_score&#39;: None, &#39;product_attribute_id&#39;: None, &#39;product_attribute&#39;: None, &#39;related_products&#39;: None}
CPU times: user 4.25 s, sys: 419 ms, total: 4.66 s
Wall time: 6.83 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 6c2f587eca3f1e4b484acd6f07dfba9a1152c155
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>...</th>
      <th>preorder_fix_date</th>
      <th>preorder_relative_day</th>
      <th>meta_title</th>
      <th>meta_keywords</th>
      <th>meta_description</th>
      <th>depth</th>
      <th>priority_score</th>
      <th>product_attribute_id</th>
      <th>product_attribute</th>
      <th>related_products</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>225407.0</td>
      <td>225407</td>
      <td>225407</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>True</td>
      <td>87</td>
      <td>21</td>
      <td>KONJAC LINGUINI</td>
      <td>010</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>241101.0</td>
      <td>241101</td>
      <td>241101</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>True</td>
      <td>06</td>
      <td>08</td>
      <td>BUMILGOCHUJANG</td>
      <td>006</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>190100.0</td>
      <td>190100</td>
      <td>190100</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>True</td>
      <td>05</td>
      <td>19</td>
      <td>WHITE SHIMEJI</td>
      <td>143</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>62644.0</td>
      <td>62644</td>
      <td>62644</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>True</td>
      <td>07</td>
      <td>08</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>192167.0</td>
      <td>192167</td>
      <td>192167</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>True</td>
      <td>10</td>
      <td>09</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>005</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>45071</th>
      <td>76931.0</td>
      <td>76931</td>
      <td>76931</td>
      <td>Y</td>
      <td>ST. REMY BRANDY 70CL</td>
      <td>True</td>
      <td>16</td>
      <td>01</td>
      <td>ST. REMY BRANDY 70CL.</td>
      <td>002</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45072</th>
      <td>203391.0</td>
      <td>203391</td>
      <td>203391</td>
      <td>Y</td>
      <td>CH TERREFORT-QUANCA</td>
      <td>True</td>
      <td>10</td>
      <td>01</td>
      <td>CH TERREFORT-QUANCARD</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45073</th>
      <td>205603.0</td>
      <td>205603</td>
      <td>205603</td>
      <td>Y</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>True</td>
      <td>15</td>
      <td>19</td>
      <td>19 GRAIN WHEAT LOAF</td>
      <td>132</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45074</th>
      <td>211585.0</td>
      <td>211585</td>
      <td>211585</td>
      <td>Y</td>
      <td>EGG</td>
      <td>True</td>
      <td>49</td>
      <td>19</td>
      <td>EGG</td>
      <td>001</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>45075</th>
      <td>NaN</td>
      <td>200710</td>
      <td>202776</td>
      <td>Y</td>
      <td>PACK.50 0200710 OCB</td>
      <td>True</td>
      <td>02</td>
      <td>11</td>
      <td>PACK.50 0200710 OCB VERGIN</td>
      <td>005</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>45076 rows × 75 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="filter-and-cache-for-ecommerce">filter and cache for ecommerce<a class="anchor-link" href="#filter-and-cache-for-ecommerce"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpOnlineS3" class="doc_header"><code>lambdaDumpOnlineS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L142" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpOnlineS3</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="test">test<a class="anchor-link" href="#test"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lambdaDumpOnlineS3</span><span class="p">({})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&lt;ipython-input-26-6f20c99e62c6&gt;:6: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  onlineList:List[str] = yaml.load(requests.get(ECOMMERCE_COL_LIST).content)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>shape is: (19108, 11)
size is: 3.272721 Mb
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Save-using-Standard-(instant-save)">Save using Standard (instant save)<a class="anchor-link" href="#Save-using-Standard-(instant-save)"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Product" class="doc_header"><code>class</code> <code>Product</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L173" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Product</code>(<strong><code>iprcode</code></strong>:<code>int</code>, <strong><code>cprcode</code></strong>:<code>int</code>, <strong><code>data</code></strong>:<code>Optional</code>[<code>CatchAllVar</code>])</p>
</blockquote>
<p>Product(iprcode: int, cprcode: int, data: Union[~CatchAllVar, NoneType])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ValueUpdate" class="doc_header"><code>class</code> <code>ValueUpdate</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L179" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ValueUpdate</code>(<strong><code>items</code></strong>:<code>List</code>[<a href="/villaProductDatabase/database.html#Product"><code>Product</code></a>])</p>
</blockquote>
<p>ValueUpdate(items: List[villaProductDatabase.database.Product])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chunks" class="doc_header"><code>chunks</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L183" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chunks</code>(<strong><code>l</code></strong>, <strong><code>n</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span> <span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT YOUNG KALE 2&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAAT YOUNG KALE 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;057&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;CM845&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]</span> <span class="c1">#ProductDatabase.valueUpdate({&#39;items&#39;:sampleProducts})</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">({</span><span class="s1">&#39;items&#39;</span><span class="p">:</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">convertIntCols</span><span class="p">(</span><span class="n">sampleProducts</span><span class="p">)})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateProduct" class="doc_header"><code>lambdaUpdateProduct</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateProduct</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
<span class="n">lambdaUpdateProduct</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-s3">Save using s3<a class="anchor-link" href="#Save-using-s3"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="update-using-s3-link">update using s3 link<a class="anchor-link" href="#update-using-s3-link"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updateS3Input" class="doc_header"><code>updateS3Input</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updateS3Input</code>(<strong><code>inputBucketName</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>key</code></strong>:<code>str</code>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span>
                     <span class="n">accelerate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;test input data saved to s3&#39;</span><span class="p">)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span> <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s3 save result is </span><span class="si">{</span><span class="n">saveResult</span><span class="si">}</span><span class="s1"> update result is </span><span class="si">{</span><span class="n">updateResult</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateS3" class="doc_header"><code>lambdaUpdateS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L201" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="error-data-test">error data test<a class="anchor-link" href="#error-data-test"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>
<span class="n">testData</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="mi">36679</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="mi">36679</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="mi">36679</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;LA COOKIES SMALL100G&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;01&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0036679&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;18&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;LA COOKIES BAG SMALL 100 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;006&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอคุกกี้ถุงเล็ก100ก.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอ คุกกี้ถุงเล็ก 100 ก.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1.00&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;F106&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_country_th&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_country_en&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_keyword_th&#39;</span><span class="p">:</span> <span class="s1">&#39;เบเกอรี่&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_keyword_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_filter_th&#39;</span><span class="p">:</span> <span class="s1">&#39;Bakery  Snacks,Fresh&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_filter_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Bakery  Snacks,Fresh&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l1_th&#39;</span><span class="p">:</span> <span class="s1">&#39;อาหารสด&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Fresh&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l2_th&#39;</span><span class="p">:</span> <span class="s1">&#39;เบเกอรี่ และ แสน็ค&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l2_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Bakery &amp; Snacks&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l3_th&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;online_category_l3_en&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;villa_category_l1_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Fresh&#39;</span><span class="p">,</span> <span class="s1">&#39;villa_category_l2_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Fresh Produce&#39;</span><span class="p">,</span> <span class="s1">&#39;villa_category_l3_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;villa_category_l4_en&#39;</span><span class="p">:</span> <span class="s1">&#39;Cookie and confectionery&#39;</span><span class="p">,</span> <span class="s1">&#39;content_en&#39;</span><span class="p">:</span> <span class="s1">&#39;0036679 La Bakery Cookies (s) 100gm Bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;content_th&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอ คุกกี้ถุงเล็ก 100 ก. เบเกอรี่&#39;</span><span class="p">,</span> <span class="s1">&#39;hema_brand_th&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;hema_brand_en&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;hema_sizedesc&#39;</span><span class="p">:</span> <span class="s1">&#39;nan&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_brand_en&#39;</span><span class="p">:</span> <span class="s1">&#39;L.A. Bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_brand_th&#39;</span><span class="p">:</span> <span class="s1">&#39;L.A. Bakery&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_online_name_en&#39;</span><span class="p">:</span> <span class="s1">&#39;La Bakery Cookies (s) 100gm&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_online_name_th&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอ คุกกี้ถุงเล็ก 100 ก.&#39;</span><span class="p">,</span> <span class="s1">&#39;hema_name_en&#39;</span><span class="p">:</span> <span class="s1">&#39;La Bakery Cookies (s) 100gm&#39;</span><span class="p">,</span> <span class="s1">&#39;hema_name_th&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอ คุกกี้ถุงเล็ก 100 ก.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name_en&#39;</span><span class="p">:</span> <span class="s1">&#39;LA COOKIES BAG SMALL 100 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name_th&#39;</span><span class="p">:</span> <span class="s1">&#39;แอลเอ คุกกี้ถุงเล็ก 100 ก.&#39;</span><span class="p">,</span> <span class="s1">&#39;sort_weight&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">([</span><span class="n">testData</span><span class="p">],</span><span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">sampleProducts</span><span class="p">,</span><span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="p">[</span><span class="n">testData</span><span class="p">]</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">({</span><span class="s1">&#39;items&#39;</span><span class="p">:</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">convertIntCols</span><span class="p">([</span><span class="n">testData</span><span class="p">])})</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="mi">36679</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Query-test">Query test<a class="anchor-link" href="#Query-test"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Product-Query">Product Query<a class="anchor-link" href="#Product-Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductsFromList" class="doc_header"><code>class</code> <code>ProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L218" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductsFromList</code>(<strong><code>iprcodes</code></strong>:<code>List</code>[<code>str</code>])</p>
</blockquote>
<p>ProductsFromList(iprcodes: List[str])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaProductsFromList" class="doc_header"><code>lambdaProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L222" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaProductsFromList</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0217153&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0000009&#39;</span><span class="p">]})</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;result length is not 3 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;result type is not dict&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:[</span><span class="s1">&#39;0000009&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0217153&#39;</span><span class="p">]})</span>
<span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleQueryInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span>
<span class="p">}</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;12345&#39;</span><span class="p">}))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaSingleQuery" class="doc_header"><code>lambdaSingleQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L230" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaSingleQuery</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;11234&#39;</span><span class="p">}),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AllQuery">AllQuery<a class="anchor-link" href="#AllQuery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">%</span><span class="k">time</span> url = ProductDatabase.allQuery(bucket = INVENTORY_BUCKET_NAME, key=&#39;allData-json.zl&#39;)
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># response = requests.get(url)</span>
<span class="k">def</span> <span class="nf">retrieveJsonZl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">response</span><span class="p">:</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">jsonDb</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">newDb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">jsonDb</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newDb</span>
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;pr_suref3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQuery" class="doc_header"><code>lambdaAllQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L239" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQuery</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="o">%</span><span class="k">time</span> url = Response.fromDict(lambdaAllQuery(&#39;&#39;, &#39;&#39;)).body[&#39;url&#39;]
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AllQueryFeather">AllQueryFeather<a class="anchor-link" href="#AllQueryFeather"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQueryFeather" class="doc_header"><code>lambdaAllQueryFeather</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L244" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQueryFeather</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> r = lambdaAllQueryFeather(&#39;&#39;)
<span class="o">%</span><span class="k">time</span> result = Response.fromDict(r).body
<span class="n">url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">time</span> pd.read_feather(url)
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">pdUtils</span><span class="o">.</span><span class="n">getDfHash</span><span class="p">(</span><span class="n">database</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;database and hash are not the same&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-s3,-checking-scan-time">Update s3, checking scan time<a class="anchor-link" href="#Update-s3,-checking-scan-time"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;checking scan time&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nicHelper.schema</span> <span class="kn">import</span> <span class="n">validateUrl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">validateUrl</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/thanakijwanavit/villaMasterSchema/master/Product.json&#39;</span><span class="p">,</span> <span class="n">input_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">cprcode</span>
<span class="n">result</span><span class="o">.</span><span class="n">iprcode</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nicHelper.dictUtil</span> <span class="kn">import</span> <span class="n">genSchema</span>
<span class="kn">import</span> <span class="nn">yaml</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">genSchema</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span><span class="n">format_</span><span class="o">=</span><span class="s1">&#39;yaml&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schemaDict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schemaDict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;/tmp/product.json&#39;</span><span class="p">,</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;records&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s1">&#39;/tmp/product.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">productJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

