---

title: Database Class


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>missing environment variable &#39;INVENTORY_BUCKET_NAME&#39; in query NB
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Database-Class">Main Database Class<a class="anchor-link" href="#Main-Database-Class"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductDatabase" class="doc_header"><code>class</code> <code>ProductDatabase</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L58" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductDatabase</code>(<strong><code>hash_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>range_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>_user_instantiated</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong>**<code>attributes</code></strong>:<code>Any</code>) :: <a href="/villaProductDatabase/query.html#Querier"><code>Querier</code></a></p>
</blockquote>
<p>Defines a <code>PynamoDB</code> Model</p>
<p>This model is backed by a table in DynamoDB.
You can create the table by with the <code>create_table</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-with-dictionary">Update with dictionary<a class="anchor-link" href="#Update-with-dictionary"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">## get original item</span>
<span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;0000009&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;engname is </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">### update item</span>
<span class="n">updatedItem</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateWithDict</span><span class="p">(</span><span class="n">item</span><span class="p">,{</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span><span class="s1">&#39;testName&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;testName&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name is changed to  </span><span class="si">{</span><span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>engname is JOHNNIE WALKER RED 70 CL.
 name is changed to  testName
CPU times: user 3.4 ms, sys: 0 ns, total: 3.4 ms
Wall time: 6.66 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-load-and-save-data">Batch load and save data<a class="anchor-link" href="#Batch-load-and-save-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;loadFrom cache not working&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
CPU times: user 570 ms, sys: 104 ms, total: 674 ms
Wall time: 1.22 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dump-database-to-s3">Dump database to s3<a class="anchor-link" href="#Dump-database-to-s3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ProductDatabase.resetS3Cache()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cacheDb" class="doc_header"><code>cacheDb</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cacheDb</code>(<strong><code>bucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>'allData'</code></em>, <strong><code>limit</code></strong>=<em><code>100</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>cache db to s3 and local efs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># originalDb = ProductDatabase.loadFromCache()</span>
<span class="c1"># listPd = list(product.needsUpdateIndex.query(&#39;Y&#39;, limit=5))</span>
<span class="c1"># changesDf = ProductDatabase.toDf(listPd)</span>
<span class="c1"># changesDf.set_index(&#39;cprcode&#39;, inplace=True)</span>
<span class="c1"># originalDb.set_index(&#39;cprcode&#39;,inplace=True)</span>
<span class="c1"># newDf = originalDb.append(changesDf)</span>
<span class="c1"># newDf.reset_index(inplace=True)</span>
<span class="c1"># originalDb</span>

<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
quering for changes
convert to df
(100, 54)
       cprcode  iprcode  oprcode ordertype                pr_abb pr_active  \
0      0231705  0231705  0231705         Y  SMOKED CIRCLE HAM (1         Y   
1      0224567  0224567  0224567         Y  VEDETT EXTRA ORDINAR         Y   
2      0198937  0198937  0198937         Y  MOOTOWN CHEESE DIP &amp;         Y   
3      0222115  0222115  0222115         Y   WERNLI PETIT BEURRE         Y   
4      0237423  0237423  0237423         Y  THE CUTLERYLIGHT-COL         Y   
...        ...      ...      ...       ...                   ...       ...   
15996  0242597  0242597  0242597         Y  ROYAL CANIN FCN INTE         Y   
15997  0210428  0210428  0210428         Y  POLO WHITE SHIRT SIZ         Y   
15998  0119503  0119503  0119503         Y  HUA HIN BAKERY ITALI         Y   
15999  0239331  0239331  0239331         Y   CrocodileCreek45507         Y   
16000      NaN  0238496  0238496         Y    Oral-B Extra Pack2         Y   

      pr_cgcode  pr_code pr_dpcode                                pr_engname  \
0            73  0231705        19                  SMOKED CIRCLE HAM (165G)   
1            08  0224567        01                 VEDETT EXTRA ORDINARY IPA   
2            99  0198937        28  MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA   
3            01  0222115        02           WERNLI PETIT BEURRE NOIR 125 G.   
4            08  0237423        19  THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...         ...      ...       ...                                       ...   
15996        54  0242597        19       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997        08  0210428        19                  POLO WHITE SHIRT SIZE 3S   
15998        15  0119503        19        HUA HIN BAKERY ITALIAN BREAD 450 G   
15999        08  0239331        19            CROCODILE CREEK,45507,MERMAIDS   
16000        02  0238496        09           ORAL-B EXTRA FRESH 500ML. PACK2   

       ...                                      pr_keyword_th  \
0      ...                                                      
1      ...  เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...   
2      ...                                                ชีส   
3      ...                                                      
4      ...                                                      
...    ...                                                ...   
15996  ...                                                      
15997  ...                                                      
15998  ...                                           เบเกอรี่   
15999  ...                                                      
16000  ...                                                      

                                     pr_name_en  \
0                      SMOKED CIRCLE HAM (165G)   
1                     VEDETT EXTRA ORDINARY IPA   
2      MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA   
3               WERNLI PETIT BEURRE NOIR 125 G.   
4      THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...                                         ...   
15996       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                  POLO WHITE SHIRT SIZE 3S   
15998        HUA HIN BAKERY ITALIAN BREAD 450 G   
15999            CROCODILE CREEK,45507,MERMAIDS   
16000           ORAL-B EXTRA FRESH 500ML. PACK2   

                                            pr_name_th  \
0                           สโมคเซอร์เคิลแฮม 165  กรัม   
1                            VEDETT EXTRA ORDINARY IPA   
2           MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK   
3            เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.   
4                     THE CUTLERY เสื่อรองจานกลมสีอ่อน   
...                                                ...   
15996              ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                 เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S   
15998            HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.   
15999  CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS   
16000  น้ำยาบ้วนปากออรัลบี เอ็กซ์ตร้าเฟรช500มล.แพ็คคู่   

                              pr_online_name_en  \
0                      SMOKED CIRCLE HAM (165G)   
1               Vedett Extra Ordinary Ipa 330ml   
2      MooTown Cheese Dip &amp; Pretzel Sticks 128g   
3               Wernli Petit Beurre Noir 125 G.   
4      THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...                                         ...   
15996       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                  POLO WHITE SHIRT SIZE 3S   
15998        Hua Hin Bakery Italian Bread 450 G   
15999              Crocodile Creek45507Mermaids   
16000           ORAL-B EXTRA FRESH 500ML. PACK2   

                                    pr_online_name_th sort_weight  \
0                            SMOKED CIRCLE HAM (165G)           0   
1                     Vedett Extra Ordinary Ipa 330ml           0   
2            MooTown Cheese Dip &amp; Pretzel Sticks 128g           0   
3           เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.           0   
4            THE CUTLERYLIGHT-COLOURED ROUND TABLE MA           0   
...                                               ...         ...   
15996             ROYAL CANIN FCN INTENSE HAIRBALL 2K           0   
15997                        POLO WHITE SHIRT SIZE 3S           0   
15998           HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.           0   
15999  CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS           0   
16000                 ORAL-B EXTRA FRESH 500ML. PACK2           0   

      villa_category_l1_en villa_category_l2_en villa_category_l3_en  \
0                    Fresh         Delicatessen                Local   
1              Dry Grocery   Alcohol &amp; Beverage          Beer Import   
2              Dry Grocery              Grocery     Cookies &amp; Snacks   
3              Dry Grocery              Grocery     Cookies &amp; Snacks   
4              Dry Grocery            Household   Household Hardware   
...                    ...                  ...                  ...   
15996          Dry Grocery            Household         Pet Supplies   
15997          Dry Grocery              Grocery             Seasonal   
15998                Fresh        Fresh Produce               Bakery   
15999          Dry Grocery            Household                 Toys   
16000          Dry Grocery            Household   Household Products   

      villa_category_l4_en  
0                 Sausages  
1              Beer Import  
2      Biscuits &amp; Crackers  
3      Biscuits &amp; Crackers  
4              Kitchenware  
...                    ...  
15996                  Dog  
15997                  TBA  
15998       Bread category  
15999             Kidoodle  
16000             Cleaning  

[16001 rows x 55 columns]
hashKey is allData-hash
saving hash to s3
saved hash 44d5a59eafeb67bc2d6be19b27affa3099638ead
saving to remote cache
CPU times: user 3 s, sys: 234 ms, total: 3.24 s
Wall time: 5.02 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0231705</td>
      <td>0231705</td>
      <td>0231705</td>
      <td>Y</td>
      <td>SMOKED CIRCLE HAM (1</td>
      <td>Y</td>
      <td>73</td>
      <td>0231705</td>
      <td>19</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>...</td>
      <td></td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>สโมคเซอร์เคิลแฮม 165  กรัม</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0224567</td>
      <td>0224567</td>
      <td>0224567</td>
      <td>Y</td>
      <td>VEDETT EXTRA ORDINAR</td>
      <td>Y</td>
      <td>08</td>
      <td>0224567</td>
      <td>01</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>...</td>
      <td>เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Beer Import</td>
      <td>Beer Import</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0198937</td>
      <td>0198937</td>
      <td>0198937</td>
      <td>Y</td>
      <td>MOOTOWN CHEESE DIP &amp;</td>
      <td>Y</td>
      <td>99</td>
      <td>0198937</td>
      <td>28</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>...</td>
      <td>ชีส</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0222115</td>
      <td>0222115</td>
      <td>0222115</td>
      <td>Y</td>
      <td>WERNLI PETIT BEURRE</td>
      <td>Y</td>
      <td>01</td>
      <td>0222115</td>
      <td>02</td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>...</td>
      <td></td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>Wernli Petit Beurre Noir 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0237423</td>
      <td>0237423</td>
      <td>0237423</td>
      <td>Y</td>
      <td>THE CUTLERYLIGHT-COL</td>
      <td>Y</td>
      <td>08</td>
      <td>0237423</td>
      <td>19</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>...</td>
      <td></td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERY เสื่อรองจานกลมสีอ่อน</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Kitchenware</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15996</th>
      <td>0242597</td>
      <td>0242597</td>
      <td>0242597</td>
      <td>Y</td>
      <td>ROYAL CANIN FCN INTE</td>
      <td>Y</td>
      <td>54</td>
      <td>0242597</td>
      <td>19</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>...</td>
      <td></td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Pet Supplies</td>
      <td>Dog</td>
    </tr>
    <tr>
      <th>15997</th>
      <td>0210428</td>
      <td>0210428</td>
      <td>0210428</td>
      <td>Y</td>
      <td>POLO WHITE SHIRT SIZ</td>
      <td>Y</td>
      <td>08</td>
      <td>0210428</td>
      <td>19</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>...</td>
      <td></td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Seasonal</td>
      <td>TBA</td>
    </tr>
    <tr>
      <th>15998</th>
      <td>0119503</td>
      <td>0119503</td>
      <td>0119503</td>
      <td>Y</td>
      <td>HUA HIN BAKERY ITALI</td>
      <td>Y</td>
      <td>15</td>
      <td>0119503</td>
      <td>19</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>...</td>
      <td>เบเกอรี่</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>Hua Hin Bakery Italian Bread 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Bakery</td>
      <td>Bread category</td>
    </tr>
    <tr>
      <th>15999</th>
      <td>0239331</td>
      <td>0239331</td>
      <td>0239331</td>
      <td>Y</td>
      <td>CrocodileCreek45507</td>
      <td>Y</td>
      <td>08</td>
      <td>0239331</td>
      <td>19</td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>...</td>
      <td></td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS</td>
      <td>Crocodile Creek45507Mermaids</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kidoodle</td>
    </tr>
    <tr>
      <th>0238496</th>
      <td>NaN</td>
      <td>0238496</td>
      <td>0238496</td>
      <td>Y</td>
      <td>Oral-B Extra Pack2</td>
      <td>Y</td>
      <td>02</td>
      <td>0238496</td>
      <td>09</td>
      <td>ORAL-B EXTRA FRESH 500ML. PACK2</td>
      <td>...</td>
      <td></td>
      <td>ORAL-B EXTRA FRESH 500ML. PACK2</td>
      <td>น้ำยาบ้วนปากออรัลบี เอ็กซ์ตร้าเฟรช500มล.แพ็คคู่</td>
      <td>ORAL-B EXTRA FRESH 500ML. PACK2</td>
      <td>ORAL-B EXTRA FRESH 500ML. PACK2</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Products</td>
      <td>Cleaning</td>
    </tr>
  </tbody>
</table>
<p>16001 rows × 55 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@add_class_method</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dumpToS3</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucketName</span><span class="o">=</span> <span class="n">INVENTORY_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;allData&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">dumpToS3</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 44d5a59eafeb67bc2d6be19b27affa3099638ead
data is still in sync, using local cache
quering for changes
convert to df
(1000, 54)
       cprcode  iprcode  oprcode ordertype                pr_abb pr_active  \
0      0231705  0231705  0231705         Y  SMOKED CIRCLE HAM (1         Y   
1      0224567  0224567  0224567         Y  VEDETT EXTRA ORDINAR         Y   
2      0198937  0198937  0198937         Y  MOOTOWN CHEESE DIP &amp;         Y   
3      0222115  0222115  0222115         Y   WERNLI PETIT BEURRE         Y   
4      0237423  0237423  0237423         Y  THE CUTLERYLIGHT-COL         Y   
...        ...      ...      ...       ...                   ...       ...   
15996  0242597  0242597  0242597         Y  ROYAL CANIN FCN INTE         Y   
15997  0210428  0210428  0210428         Y  POLO WHITE SHIRT SIZ         Y   
15998  0119503  0119503  0119503         Y  HUA HIN BAKERY ITALI         Y   
15999  0239331  0239331  0239331         Y   CrocodileCreek45507         Y   
16000      NaN  0230058  0230058         Y  VITA APPLE JUICE 250         Y   

      pr_cgcode  pr_code pr_dpcode                                pr_engname  \
0            73  0231705        19                  SMOKED CIRCLE HAM (165G)   
1            08  0224567        01                 VEDETT EXTRA ORDINARY IPA   
2            99  0198937        28  MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA   
3            01  0222115        02           WERNLI PETIT BEURRE NOIR 125 G.   
4            08  0237423        19  THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...         ...      ...       ...                                       ...   
15996        54  0242597        19       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997        08  0210428        19                  POLO WHITE SHIRT SIZE 3S   
15998        15  0119503        19        HUA HIN BAKERY ITALIAN BREAD 450 G   
15999        08  0239331        19            CROCODILE CREEK,45507,MERMAIDS   
16000        05  0230058        20                  VITA APPLE JUICE 250 ML.   

       ...                                      pr_keyword_th  \
0      ...                                                      
1      ...  เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...   
2      ...                                                ชีส   
3      ...                                                      
4      ...                                                      
...    ...                                                ...   
15996  ...                                                      
15997  ...                                                      
15998  ...                                           เบเกอรี่   
15999  ...                                                      
16000  ...                                           น้ำผลไม้   

                                     pr_name_en  \
0                      SMOKED CIRCLE HAM (165G)   
1                     VEDETT EXTRA ORDINARY IPA   
2      MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA   
3               WERNLI PETIT BEURRE NOIR 125 G.   
4      THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...                                         ...   
15996       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                  POLO WHITE SHIRT SIZE 3S   
15998        HUA HIN BAKERY ITALIAN BREAD 450 G   
15999            CROCODILE CREEK,45507,MERMAIDS   
16000                  VITA APPLE JUICE 250 ML.   

                                            pr_name_th  \
0                           สโมคเซอร์เคิลแฮม 165  กรัม   
1                            VEDETT EXTRA ORDINARY IPA   
2           MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK   
3            เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.   
4                     THE CUTLERY เสื่อรองจานกลมสีอ่อน   
...                                                ...   
15996              ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                 เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S   
15998            HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.   
15999  CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS   
16000           วิต้า น้ำผลไม้รสแอปเปิ้ลไม่มีน้ำตาล250   

                              pr_online_name_en  \
0                      SMOKED CIRCLE HAM (165G)   
1               Vedett Extra Ordinary Ipa 330ml   
2      MooTown Cheese Dip &amp; Pretzel Sticks 128g   
3               Wernli Petit Beurre Noir 125 G.   
4      THE CUTLERYLIGHT-COLOURED ROUND TABLE MA   
...                                         ...   
15996       ROYAL CANIN FCN INTENSE HAIRBALL 2K   
15997                  POLO WHITE SHIRT SIZE 3S   
15998        Hua Hin Bakery Italian Bread 450 G   
15999              Crocodile Creek45507Mermaids   
16000                  VITA APPLE JUICE 250 ML.   

                                    pr_online_name_th sort_weight  \
0                            SMOKED CIRCLE HAM (165G)           0   
1                     Vedett Extra Ordinary Ipa 330ml           0   
2            MooTown Cheese Dip &amp; Pretzel Sticks 128g           0   
3           เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.           0   
4            THE CUTLERYLIGHT-COLOURED ROUND TABLE MA           0   
...                                               ...         ...   
15996             ROYAL CANIN FCN INTENSE HAIRBALL 2K           0   
15997                        POLO WHITE SHIRT SIZE 3S           0   
15998           HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.           0   
15999  CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS           0   
16000                        VITA APPLE JUICE 250 ML.           0   

      villa_category_l1_en villa_category_l2_en villa_category_l3_en  \
0                    Fresh         Delicatessen                Local   
1              Dry Grocery   Alcohol &amp; Beverage          Beer Import   
2              Dry Grocery              Grocery     Cookies &amp; Snacks   
3              Dry Grocery              Grocery     Cookies &amp; Snacks   
4              Dry Grocery            Household   Household Hardware   
...                    ...                  ...                  ...   
15996          Dry Grocery            Household         Pet Supplies   
15997          Dry Grocery              Grocery             Seasonal   
15998                Fresh        Fresh Produce               Bakery   
15999          Dry Grocery            Household                 Toys   
16000          Dry Grocery   Alcohol &amp; Beverage                Juice   

      villa_category_l4_en  
0                 Sausages  
1              Beer Import  
2      Biscuits &amp; Crackers  
3      Biscuits &amp; Crackers  
4              Kitchenware  
...                    ...  
15996                  Dog  
15997                  TBA  
15998       Bread category  
15999             Kidoodle  
16000         Juice Import  

[16001 rows x 55 columns]
hashKey is allData-hash
saving hash to s3
saved hash 299b410cfb43b21b22e4e9a954cefec5b4fd6c61
saving to remote cache
CPU times: user 13.6 s, sys: 176 ms, total: 13.7 s
Wall time: 16.1 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0231705</td>
      <td>0231705</td>
      <td>0231705</td>
      <td>Y</td>
      <td>SMOKED CIRCLE HAM (1</td>
      <td>Y</td>
      <td>73</td>
      <td>0231705</td>
      <td>19</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>...</td>
      <td></td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>สโมคเซอร์เคิลแฮม 165  กรัม</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0224567</td>
      <td>0224567</td>
      <td>0224567</td>
      <td>Y</td>
      <td>VEDETT EXTRA ORDINAR</td>
      <td>Y</td>
      <td>08</td>
      <td>0224567</td>
      <td>01</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>...</td>
      <td>เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Beer Import</td>
      <td>Beer Import</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0198937</td>
      <td>0198937</td>
      <td>0198937</td>
      <td>Y</td>
      <td>MOOTOWN CHEESE DIP &amp;</td>
      <td>Y</td>
      <td>99</td>
      <td>0198937</td>
      <td>28</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>...</td>
      <td>ชีส</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0222115</td>
      <td>0222115</td>
      <td>0222115</td>
      <td>Y</td>
      <td>WERNLI PETIT BEURRE</td>
      <td>Y</td>
      <td>01</td>
      <td>0222115</td>
      <td>02</td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>...</td>
      <td></td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>Wernli Petit Beurre Noir 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0237423</td>
      <td>0237423</td>
      <td>0237423</td>
      <td>Y</td>
      <td>THE CUTLERYLIGHT-COL</td>
      <td>Y</td>
      <td>08</td>
      <td>0237423</td>
      <td>19</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>...</td>
      <td></td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERY เสื่อรองจานกลมสีอ่อน</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Kitchenware</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15996</th>
      <td>0242597</td>
      <td>0242597</td>
      <td>0242597</td>
      <td>Y</td>
      <td>ROYAL CANIN FCN INTE</td>
      <td>Y</td>
      <td>54</td>
      <td>0242597</td>
      <td>19</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>...</td>
      <td></td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Pet Supplies</td>
      <td>Dog</td>
    </tr>
    <tr>
      <th>15997</th>
      <td>0210428</td>
      <td>0210428</td>
      <td>0210428</td>
      <td>Y</td>
      <td>POLO WHITE SHIRT SIZ</td>
      <td>Y</td>
      <td>08</td>
      <td>0210428</td>
      <td>19</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>...</td>
      <td></td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Seasonal</td>
      <td>TBA</td>
    </tr>
    <tr>
      <th>15998</th>
      <td>0119503</td>
      <td>0119503</td>
      <td>0119503</td>
      <td>Y</td>
      <td>HUA HIN BAKERY ITALI</td>
      <td>Y</td>
      <td>15</td>
      <td>0119503</td>
      <td>19</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>...</td>
      <td>เบเกอรี่</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>Hua Hin Bakery Italian Bread 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Bakery</td>
      <td>Bread category</td>
    </tr>
    <tr>
      <th>15999</th>
      <td>0239331</td>
      <td>0239331</td>
      <td>0239331</td>
      <td>Y</td>
      <td>CrocodileCreek45507</td>
      <td>Y</td>
      <td>08</td>
      <td>0239331</td>
      <td>19</td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>...</td>
      <td></td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS</td>
      <td>Crocodile Creek45507Mermaids</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kidoodle</td>
    </tr>
    <tr>
      <th>0230058</th>
      <td>NaN</td>
      <td>0230058</td>
      <td>0230058</td>
      <td>Y</td>
      <td>VITA APPLE JUICE 250</td>
      <td>Y</td>
      <td>05</td>
      <td>0230058</td>
      <td>20</td>
      <td>VITA APPLE JUICE 250 ML.</td>
      <td>...</td>
      <td>น้ำผลไม้</td>
      <td>VITA APPLE JUICE 250 ML.</td>
      <td>วิต้า น้ำผลไม้รสแอปเปิ้ลไม่มีน้ำตาล250</td>
      <td>VITA APPLE JUICE 250 ML.</td>
      <td>VITA APPLE JUICE 250 ML.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Juice</td>
      <td>Juice Import</td>
    </tr>
  </tbody>
</table>
<p>16001 rows × 55 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpToS3" class="doc_header"><code>lambdaDumpToS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L123" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpToS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">lambdaDumpToS3</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 299b410cfb43b21b22e4e9a954cefec5b4fd6c61
data is still in sync, using local cache
quering for changes
convert to df
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0231705</td>
      <td>0231705</td>
      <td>0231705</td>
      <td>Y</td>
      <td>SMOKED CIRCLE HAM (1</td>
      <td>Y</td>
      <td>73</td>
      <td>0231705</td>
      <td>19</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>...</td>
      <td></td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>สโมคเซอร์เคิลแฮม 165  กรัม</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0224567</td>
      <td>0224567</td>
      <td>0224567</td>
      <td>Y</td>
      <td>VEDETT EXTRA ORDINAR</td>
      <td>Y</td>
      <td>08</td>
      <td>0224567</td>
      <td>01</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>...</td>
      <td>เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Beer Import</td>
      <td>Beer Import</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0198937</td>
      <td>0198937</td>
      <td>0198937</td>
      <td>Y</td>
      <td>MOOTOWN CHEESE DIP &amp;</td>
      <td>Y</td>
      <td>99</td>
      <td>0198937</td>
      <td>28</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>...</td>
      <td>ชีส</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0222115</td>
      <td>0222115</td>
      <td>0222115</td>
      <td>Y</td>
      <td>WERNLI PETIT BEURRE</td>
      <td>Y</td>
      <td>01</td>
      <td>0222115</td>
      <td>02</td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>...</td>
      <td></td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>Wernli Petit Beurre Noir 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0237423</td>
      <td>0237423</td>
      <td>0237423</td>
      <td>Y</td>
      <td>THE CUTLERYLIGHT-COL</td>
      <td>Y</td>
      <td>08</td>
      <td>0237423</td>
      <td>19</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>...</td>
      <td></td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERY เสื่อรองจานกลมสีอ่อน</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Kitchenware</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15995</th>
      <td>0089545</td>
      <td>0089545</td>
      <td>0089545</td>
      <td>Y</td>
      <td>SEASONING HERBS TOM</td>
      <td>Y</td>
      <td>17</td>
      <td>0089545</td>
      <td>19</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>...</td>
      <td></td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>ไป-กิน-ข้าว ต้มข่า 100 กรัม</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Oil &amp; Seasoning &amp; Sauce</td>
      <td>Cooking Needs</td>
    </tr>
    <tr>
      <th>15996</th>
      <td>0242597</td>
      <td>0242597</td>
      <td>0242597</td>
      <td>Y</td>
      <td>ROYAL CANIN FCN INTE</td>
      <td>Y</td>
      <td>54</td>
      <td>0242597</td>
      <td>19</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>...</td>
      <td></td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Pet Supplies</td>
      <td>Dog</td>
    </tr>
    <tr>
      <th>15997</th>
      <td>0210428</td>
      <td>0210428</td>
      <td>0210428</td>
      <td>Y</td>
      <td>POLO WHITE SHIRT SIZ</td>
      <td>Y</td>
      <td>08</td>
      <td>0210428</td>
      <td>19</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>...</td>
      <td></td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Seasonal</td>
      <td>TBA</td>
    </tr>
    <tr>
      <th>15998</th>
      <td>0119503</td>
      <td>0119503</td>
      <td>0119503</td>
      <td>Y</td>
      <td>HUA HIN BAKERY ITALI</td>
      <td>Y</td>
      <td>15</td>
      <td>0119503</td>
      <td>19</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>...</td>
      <td>เบเกอรี่</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>Hua Hin Bakery Italian Bread 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Bakery</td>
      <td>Bread category</td>
    </tr>
    <tr>
      <th>15999</th>
      <td>0239331</td>
      <td>0239331</td>
      <td>0239331</td>
      <td>Y</td>
      <td>CrocodileCreek45507</td>
      <td>Y</td>
      <td>08</td>
      <td>0239331</td>
      <td>19</td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>...</td>
      <td></td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS</td>
      <td>Crocodile Creek45507Mermaids</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kidoodle</td>
    </tr>
  </tbody>
</table>
<p>16000 rows × 55 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-Standard-(instant-save)">Save using Standard (instant save)<a class="anchor-link" href="#Save-using-Standard-(instant-save)"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Product" class="doc_header"><code>class</code> <code>Product</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L130" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Product</code>(<strong><code>iprcode</code></strong>:<code>str</code>, <strong><code>cprcode</code></strong>:<code>str</code>, <strong><code>data</code></strong>:<code>Optional</code>[<code>CatchAllVar</code>])</p>
</blockquote>
<p>Product(iprcode: str, cprcode: str, data: Union[~CatchAllVar, NoneType])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ValueUpdate" class="doc_header"><code>class</code> <code>ValueUpdate</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L136" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ValueUpdate</code>(<strong><code>items</code></strong>:<code>List</code>[<a href="/villaProductDatabase/database.html#Product"><code>Product</code></a>])</p>
</blockquote>
<p>ValueUpdate(items: List[villaProductDatabase.database.Product])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chunks" class="doc_header"><code>chunks</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L140" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chunks</code>(<strong><code>l</code></strong>, <strong><code>n</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74, 75, 76, 77, 78, 79],
 [80, 81, 82, 83, 84, 85, 86, 87, 88, 89],
 [90, 91, 92, 93, 94, 95, 96, 97, 98, 99]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span> <span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT YOUNG KALE 2&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAAT YOUNG KALE 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;057&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;CM845&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]</span> <span class="c1">#ProductDatabase.valueUpdate({&#39;items&#39;:sampleProducts})</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">ValueUpdate</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;items&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="c1"># print(products[0])</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.015000000000000001 ms
divided into chunks 0.8109999999999999 ms
loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
get all from s3 1058.4389999999999 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;success&#39;: 1,
 &#39;failure&#39;: 0,
 &#39;skipped&#39;: 0,
 &#39;failureMessage&#39;: [],
 &#39;timetaken(ms)&#39;: 1081.0720000000001}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateProduct" class="doc_header"><code>lambdaUpdateProduct</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L143" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateProduct</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
<span class="n">lambdaUpdateProduct</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.014 ms
divided into chunks 0.553 ms
loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
get all from s3 1053.943 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:1,&#34;failure&#34;:0,&#34;skipped&#34;:0,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:1076.91}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-s3">Save using s3<a class="anchor-link" href="#Save-using-s3"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="update-using-s3-link">update using s3 link<a class="anchor-link" href="#update-using-s3-link"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updateS3Input" class="doc_header"><code>updateS3Input</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L149" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updateS3Input</code>(<strong><code>inputBucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span>
                     <span class="n">accelerate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;test input data saved to s3&#39;</span><span class="p">)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span> <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s3 save result is </span><span class="si">{</span><span class="n">saveResult</span><span class="si">}</span><span class="s1"> update result is </span><span class="si">{</span><span class="n">updateResult</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.013 ms
divided into chunks 0.122 ms
loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
get all from s3 1041.13 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateS3" class="doc_header"><code>lambdaUpdateS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L157" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.015000000000000001 ms
divided into chunks 0.424 ms
loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
get all from s3 1153.338 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:1,&#34;failure&#34;:0,&#34;skipped&#34;:0,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:1174.987}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Query-test">Query test<a class="anchor-link" href="#Query-test"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Product-Query">Product Query<a class="anchor-link" href="#Product-Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductsFromList" class="doc_header"><code>class</code> <code>ProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L174" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductsFromList</code>(<strong><code>iprcodes</code></strong>:<code>List</code>[<code>str</code>])</p>
</blockquote>
<p>ProductsFromList(iprcodes: List[str])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaProductsFromList" class="doc_header"><code>lambdaProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L178" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaProductsFromList</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0217153&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0000009&#39;</span><span class="p">]})</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;result length is not 3 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;result type is not dict&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
db shape is (16000, 55)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;timed exec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-red-fg">AssertionError</span>: result length is not 3 1</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:[</span><span class="s1">&#39;0000009&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0217153&#39;</span><span class="p">]})</span>
<span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
remote hash is not the same, load remote cache
db shape is (16000, 55)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;[{&#34;cprcode&#34;:&#34;0217153&#34;,&#34;iprcode&#34;:&#34;0217153&#34;,&#34;oprcode&#34;:&#34;0217153&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;COCOA LOCO MILK CHOC&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;98&#34;,&#34;pr_code&#34;:&#34;0217153&#34;,&#34;pr_dpcode&#34;:&#34;28&#34;,&#34;pr_engname&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_ggcode&#34;:&#34;003&#34;,&#34;pr_market&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL&#34;,&#34;pr_name&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_puqty&#34;:&#34;24.00&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;F1239&#34;,&#34;pr_suref3&#34;:&#34;S&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;SaleMode_unit&#34;:&#34;ITEM&#34;,&#34;ba_nprice&#34;:&#34;115.00&#34;,&#34;content_en&#34;:&#34;0217153 0217153 COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.  0217153-5060148383378  Dry Grocery Grocery Cookies &amp; Snacks Biscuits &amp; Crackers&#34;,&#34;content_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_brand_en&#34;:&#34;&#34;,&#34;hema_brand_th&#34;:&#34;&#34;,&#34;hema_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_sizedesc&#34;:&#34;&#34;,&#34;master_online&#34;:&#34;N&#34;,&#34;online_category_l1_en&#34;:&#34;&#34;,&#34;online_category_l1_th&#34;:&#34;&#34;,&#34;online_category_l2_en&#34;:&#34;&#34;,&#34;online_category_l2_th&#34;:&#34;&#34;,&#34;online_category_l3_en&#34;:&#34;&#34;,&#34;online_category_l3_th&#34;:&#34;&#34;,&#34;pr_barcode&#34;:&#34;5060148383378&#34;,&#34;pr_barcode2&#34;:&#34;506014838337&#34;,&#34;pr_brand_en&#34;:&#34;&#34;,&#34;pr_brand_th&#34;:&#34;&#34;,&#34;pr_country_en&#34;:&#34;United Kingdom&#34;,&#34;pr_country_th&#34;:&#34;&#34;,&#34;pr_filter_en&#34;:&#34;&#34;,&#34;pr_filter_th&#34;:&#34;&#34;,&#34;pr_keyword_en&#34;:&#34;&#34;,&#34;pr_keyword_th&#34;:&#34;&#34;,&#34;pr_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_online_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_online_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;sort_weight&#34;:&#34;0&#34;,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Grocery&#34;,&#34;villa_category_l3_en&#34;:&#34;Cookies &amp; Snacks&#34;,&#34;villa_category_l4_en&#34;:&#34;Biscuits &amp; Crackers&#34;}]&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleQueryInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span>
<span class="p">}</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;12345&#39;</span><span class="p">}))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product not found
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>iprcode                          0171670
cprcode                          0171670
oprcode                          0171670
ordertype                              Y
pr_abb              JIRAPAT YOUNG KALE 2
pr_active                              Y
pr_cgcode                             05
pr_code                          0171670
pr_dpcode                             19
pr_engname      JIRAAT YOUNG KALE 200 G.
pr_ggcode                            057
pr_market        JIRAPAT ยอดคะน้า 200 G.
pr_name          JIRAPAT ยอดคะน้า 200 G.
pr_puqty                               1
pr_sa_method                           1
pr_sucode1                         CM845
pr_suref3                              A
prtype                                 I
psqty                                  1
pstype                                 1
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaSingleQuery" class="doc_header"><code>lambdaSingleQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L186" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaSingleQuery</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;iprcode&#34;:&#34;0171670&#34;,&#34;cprcode&#34;:&#34;0171670&#34;,&#34;oprcode&#34;:&#34;0171670&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;JIRAPAT YOUNG KALE 2&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;05&#34;,&#34;pr_code&#34;:&#34;0171670&#34;,&#34;pr_dpcode&#34;:&#34;19&#34;,&#34;pr_engname&#34;:&#34;JIRAAT YOUNG KALE 200 G.&#34;,&#34;pr_ggcode&#34;:&#34;057&#34;,&#34;pr_market&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_name&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_puqty&#34;:&#34;1&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;CM845&#34;,&#34;pr_suref3&#34;:&#34;A&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;11234&#39;</span><span class="p">}),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;error&#39;: &#39;product not found&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AllQuery">AllQuery<a class="anchor-link" href="#AllQuery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">%</span><span class="k">time</span> url = ProductDatabase.allQuery(bucket = INVENTORY_BUCKET_NAME, key=&#39;allData-json.zl&#39;)
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># response = requests.get(url)</span>
<span class="k">def</span> <span class="nf">retrieveJsonZl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">response</span><span class="p">:</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">jsonDb</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">newDb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">jsonDb</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newDb</span>
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 5.59 ms, sys: 77 µs, total: 5.67 ms
Wall time: 5.53 ms
https://product-bucket-dev-manual.s3-accelerate.amazonaws.com/allData-json.zl?AWSAccessKeyId=AKIAVX4Z5TKDSNNNULGB&amp;Signature=RvBVWlvIKDZslpM%2BXcOxDIdiPBw%3D&amp;Expires=1610792580
CPU times: user 625 ms, sys: 81.5 ms, total: 707 ms
Wall time: 850 ms
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>231705</td>
      <td>231705</td>
      <td>231705</td>
      <td>Y</td>
      <td>SMOKED CIRCLE HAM (1</td>
      <td>Y</td>
      <td>73</td>
      <td>231705</td>
      <td>19</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>...</td>
      <td></td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>สโมคเซอร์เคิลแฮม 165  กรัม</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
    </tr>
    <tr>
      <th>1</th>
      <td>224567</td>
      <td>224567</td>
      <td>224567</td>
      <td>Y</td>
      <td>VEDETT EXTRA ORDINAR</td>
      <td>Y</td>
      <td>8</td>
      <td>224567</td>
      <td>1</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>...</td>
      <td>เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Beer Import</td>
      <td>Beer Import</td>
    </tr>
    <tr>
      <th>2</th>
      <td>198937</td>
      <td>198937</td>
      <td>198937</td>
      <td>Y</td>
      <td>MOOTOWN CHEESE DIP &amp;</td>
      <td>Y</td>
      <td>99</td>
      <td>198937</td>
      <td>28</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>...</td>
      <td>ชีส</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>3</th>
      <td>222115</td>
      <td>222115</td>
      <td>222115</td>
      <td>Y</td>
      <td>WERNLI PETIT BEURRE</td>
      <td>Y</td>
      <td>1</td>
      <td>222115</td>
      <td>2</td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>...</td>
      <td></td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>Wernli Petit Beurre Noir 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>237423</td>
      <td>237423</td>
      <td>237423</td>
      <td>Y</td>
      <td>THE CUTLERYLIGHT-COL</td>
      <td>Y</td>
      <td>8</td>
      <td>237423</td>
      <td>19</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>...</td>
      <td></td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERY เสื่อรองจานกลมสีอ่อน</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Kitchenware</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 55 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>8974</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>7026</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;cprcode&#39;, &#39;iprcode&#39;, &#39;oprcode&#39;, &#39;ordertype&#39;, &#39;pr_abb&#39;, &#39;pr_active&#39;,
       &#39;pr_cgcode&#39;, &#39;pr_code&#39;, &#39;pr_dpcode&#39;, &#39;pr_engname&#39;, &#39;pr_ggcode&#39;,
       &#39;pr_market&#39;, &#39;pr_name&#39;, &#39;pr_puqty&#39;, &#39;pr_sa_method&#39;, &#39;pr_sucode1&#39;,
       &#39;pr_suref3&#39;, &#39;prtype&#39;, &#39;psqty&#39;, &#39;pstype&#39;, &#39;SaleMode_unit&#39;, &#39;ba_nprice&#39;,
       &#39;content_en&#39;, &#39;content_th&#39;, &#39;hema_brand_en&#39;, &#39;hema_brand_th&#39;,
       &#39;hema_name_en&#39;, &#39;hema_name_th&#39;, &#39;hema_sizedesc&#39;, &#39;master_online&#39;,
       &#39;online_category_l1_en&#39;, &#39;online_category_l1_th&#39;,
       &#39;online_category_l2_en&#39;, &#39;online_category_l2_th&#39;,
       &#39;online_category_l3_en&#39;, &#39;online_category_l3_th&#39;, &#39;pr_barcode&#39;,
       &#39;pr_barcode2&#39;, &#39;pr_brand_en&#39;, &#39;pr_brand_th&#39;, &#39;pr_country_en&#39;,
       &#39;pr_country_th&#39;, &#39;pr_filter_en&#39;, &#39;pr_filter_th&#39;, &#39;pr_keyword_en&#39;,
       &#39;pr_keyword_th&#39;, &#39;pr_name_en&#39;, &#39;pr_name_th&#39;, &#39;pr_online_name_en&#39;,
       &#39;pr_online_name_th&#39;, &#39;sort_weight&#39;, &#39;villa_category_l1_en&#39;,
       &#39;villa_category_l2_en&#39;, &#39;villa_category_l3_en&#39;, &#39;villa_category_l4_en&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;pr_suref3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>A    11591
T     1726
C     1592
S     1089
s        2
Name: pr_suref3, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQuery" class="doc_header"><code>lambdaAllQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L195" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQuery</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="o">%</span><span class="k">time</span> url = Response.fromDict(lambdaAllQuery(&#39;&#39;, &#39;&#39;)).body[&#39;url&#39;]
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 6.47 ms, sys: 0 ns, total: 6.47 ms
Wall time: 6.51 ms
CPU times: user 605 ms, sys: 40.3 ms, total: 645 ms
Wall time: 934 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(16000, 55)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AllQueryFeather">AllQueryFeather<a class="anchor-link" href="#AllQueryFeather"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQueryFeather" class="doc_header"><code>lambdaAllQueryFeather</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L200" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQueryFeather</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> r = lambdaAllQueryFeather(&#39;&#39;)
<span class="o">%</span><span class="k">time</span> result = Response.fromDict(r).body
<span class="n">url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">time</span> pd.read_feather(url)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
loading hashkey allData-hash
using url
presign success
loaded hash is 529cd4153ad333994bbd7713bcee0957bde5810f
CPU times: user 28.4 ms, sys: 211 µs, total: 28.6 ms
Wall time: 58.5 ms
CPU times: user 21 µs, sys: 0 ns, total: 21 µs
Wall time: 25 µs
CPU times: user 128 ms, sys: 20.1 ms, total: 148 ms
Wall time: 251 ms
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0231705</td>
      <td>0231705</td>
      <td>0231705</td>
      <td>Y</td>
      <td>SMOKED CIRCLE HAM (1</td>
      <td>Y</td>
      <td>73</td>
      <td>0231705</td>
      <td>19</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>...</td>
      <td></td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>สโมคเซอร์เคิลแฮม 165  กรัม</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>SMOKED CIRCLE HAM (165G)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0224567</td>
      <td>0224567</td>
      <td>0224567</td>
      <td>Y</td>
      <td>VEDETT EXTRA ORDINAR</td>
      <td>Y</td>
      <td>08</td>
      <td>0224567</td>
      <td>01</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>...</td>
      <td>เบียร์,เบียร์กระป๋อง,เบียร์ขวด,เบียร์ลัง,เบียร...</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>VEDETT EXTRA ORDINARY IPA</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>Vedett Extra Ordinary Ipa 330ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Beer Import</td>
      <td>Beer Import</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0198937</td>
      <td>0198937</td>
      <td>0198937</td>
      <td>Y</td>
      <td>MOOTOWN CHEESE DIP &amp;</td>
      <td>Y</td>
      <td>99</td>
      <td>0198937</td>
      <td>28</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>...</td>
      <td>ชีส</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PA</td>
      <td>MOOTOWN CHEESE DIP &amp; PRETZEL STICKS 5 PACK</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>MooTown Cheese Dip &amp; Pretzel Sticks 128g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0222115</td>
      <td>0222115</td>
      <td>0222115</td>
      <td>Y</td>
      <td>WERNLI PETIT BEURRE</td>
      <td>Y</td>
      <td>01</td>
      <td>0222115</td>
      <td>02</td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>...</td>
      <td></td>
      <td>WERNLI PETIT BEURRE NOIR 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>Wernli Petit Beurre Noir 125 G.</td>
      <td>เวิร์นลี ฃ็อกโก เปอร์ติต เบอร์ นัว 125 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0237423</td>
      <td>0237423</td>
      <td>0237423</td>
      <td>Y</td>
      <td>THE CUTLERYLIGHT-COL</td>
      <td>Y</td>
      <td>08</td>
      <td>0237423</td>
      <td>19</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>...</td>
      <td></td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERY เสื่อรองจานกลมสีอ่อน</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>THE CUTLERYLIGHT-COLOURED ROUND TABLE MA</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Kitchenware</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>15995</th>
      <td>0089545</td>
      <td>0089545</td>
      <td>0089545</td>
      <td>Y</td>
      <td>SEASONING HERBS TOM</td>
      <td>Y</td>
      <td>17</td>
      <td>0089545</td>
      <td>19</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>...</td>
      <td></td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>ไป-กิน-ข้าว ต้มข่า 100 กรัม</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>SEASONING HERBS TOM KHA 100 G.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Oil &amp; Seasoning &amp; Sauce</td>
      <td>Cooking Needs</td>
    </tr>
    <tr>
      <th>15996</th>
      <td>0242597</td>
      <td>0242597</td>
      <td>0242597</td>
      <td>Y</td>
      <td>ROYAL CANIN FCN INTE</td>
      <td>Y</td>
      <td>54</td>
      <td>0242597</td>
      <td>19</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>...</td>
      <td></td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>ROYAL CANIN FCN INTENSE HAIRBALL 2K</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Pet Supplies</td>
      <td>Dog</td>
    </tr>
    <tr>
      <th>15997</th>
      <td>0210428</td>
      <td>0210428</td>
      <td>0210428</td>
      <td>Y</td>
      <td>POLO WHITE SHIRT SIZ</td>
      <td>Y</td>
      <td>08</td>
      <td>0210428</td>
      <td>19</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>...</td>
      <td></td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>เสื้อในหลวง รุ่นปกแถบขาว-SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>POLO WHITE SHIRT SIZE 3S</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Seasonal</td>
      <td>TBA</td>
    </tr>
    <tr>
      <th>15998</th>
      <td>0119503</td>
      <td>0119503</td>
      <td>0119503</td>
      <td>Y</td>
      <td>HUA HIN BAKERY ITALI</td>
      <td>Y</td>
      <td>15</td>
      <td>0119503</td>
      <td>19</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>...</td>
      <td>เบเกอรี่</td>
      <td>HUA HIN BAKERY ITALIAN BREAD 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>Hua Hin Bakery Italian Bread 450 G</td>
      <td>HUA HIN BAKERY อิตาเลี่ยน เบรด 450 ก.</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Bakery</td>
      <td>Bread category</td>
    </tr>
    <tr>
      <th>15999</th>
      <td>0239331</td>
      <td>0239331</td>
      <td>0239331</td>
      <td>Y</td>
      <td>CrocodileCreek45507</td>
      <td>Y</td>
      <td>08</td>
      <td>0239331</td>
      <td>19</td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>...</td>
      <td></td>
      <td>CROCODILE CREEK,45507,MERMAIDS</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507,MERMAIDS</td>
      <td>Crocodile Creek45507Mermaids</td>
      <td>CROCODILE CREEK-กระเป๋าสะพายหลัง 45507MERMAIDS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kidoodle</td>
    </tr>
  </tbody>
</table>
<p>16000 rows × 55 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">pdUtils</span><span class="o">.</span><span class="n">getDfHash</span><span class="p">(</span><span class="n">database</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;database and hash are not the same&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-50-1c996e7b9e05&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> database <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>read_feather<span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;url&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span><span class="ansi-green-fg">assert</span> pdUtils<span class="ansi-blue-fg">.</span>getDfHash<span class="ansi-blue-fg">(</span>database<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">==</span> result<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;hash&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;database and hash are not the same&#39;</span>

<span class="ansi-red-fg">AssertionError</span>: database and hash are not the same</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-s3,-checking-scan-time">Update s3, checking scan time<a class="anchor-link" href="#Update-s3,-checking-scan-time"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;checking scan time&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

