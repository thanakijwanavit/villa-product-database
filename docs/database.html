---

title: Database Class


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>missing environment variable &#39;INVENTORY_BUCKET_NAME&#39; in query NB
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Database-Class">Main Database Class<a class="anchor-link" href="#Main-Database-Class"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductDatabase" class="doc_header"><code>class</code> <code>ProductDatabase</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductDatabase</code>(<strong><code>hash_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>range_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>_user_instantiated</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong>**<code>attributes</code></strong>:<code>Any</code>) :: <a href="/villaProductDatabase/query.html#Querier"><code>Querier</code></a></p>
</blockquote>
<p>Defines a <code>PynamoDB</code> Model</p>
<p>This model is backed by a table in DynamoDB.
You can create the table by with the <code>create_table</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-with-dictionary">Update with dictionary<a class="anchor-link" href="#Update-with-dictionary"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">## get original item</span>
<span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="mi">171670</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;engname is </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">### update item</span>
<span class="n">updatedItem</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateWithDict</span><span class="p">(</span><span class="n">item</span><span class="p">,{</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span><span class="s1">&#39;testName&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;testName&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name is changed to  </span><span class="si">{</span><span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>engname is JIRAAT YOUNG KALE 200 G.
 name is changed to  testName
CPU times: user 3.87 ms, sys: 0 ns, total: 3.87 ms
Wall time: 7.16 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-load-and-save-data">Batch load and save data<a class="anchor-link" href="#Batch-load-and-save-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;loadFrom cache not working&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4c2637c97219e67a081834a3fa3a34495e7e6510
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;timed exec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-red-fg">AssertionError</span>: loadFrom cache not working</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dump-database-to-s3">Dump database to s3<a class="anchor-link" href="#Dump-database-to-s3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cacheDb" class="doc_header"><code>cacheDb</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L99" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cacheDb</code>(<strong><code>bucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>'allData'</code></em>, <strong><code>limit</code></strong>=<em><code>100</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>cache db to s3 and local efs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">()</span>
<span class="n">db</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
converting keys into int
quering for changes
convert to df
changesDf is shape (5, 50)
converting keys into int
saving to remote cache
hashKey is allData-hash
saving hash to s3
saved hash 0987e18ed48c3957c08b575e0de976724e45d880
setting noupdate
CPU times: user 242 ms, sys: 1.08 ms, total: 243 ms
Wall time: 1.42 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_keyword_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>Y</td>
      <td>J. WALKER RED 70 CL.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000009</td>
      <td>01</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>...</td>
      <td>None</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>JOHNNIE WALKER RED 70 CL</td>
      <td>Johnnie Walker Red 700ml</td>
      <td>JOHNNIE WALKER RED 700ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td>Scoth Whisky</td>
    </tr>
    <tr>
      <th>2</th>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>Y</td>
      <td>J B RARE WHISKY 750</td>
      <td>Y</td>
      <td>01</td>
      <td>0000028</td>
      <td>01</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>...</td>
      <td>None</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>J B RARE WHISKY 750 ML</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td>Scoth Whisky</td>
    </tr>
    <tr>
      <th>3</th>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>Y</td>
      <td>J.WALER BLACK 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000012</td>
      <td>01</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>...</td>
      <td>None</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>Johnnie Walker Black 70 Cl.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
      <td>33</td>
      <td>33</td>
      <td>Y</td>
      <td>BALLANTINE S 700ml.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000033</td>
      <td>01</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>...</td>
      <td>None</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>BALLANTINE S FINEST 700 ML</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td>None</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>Y</td>
      <td>JOHN JAMESON 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000026</td>
      <td>01</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>...</td>
      <td>None</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>John Jameson Whisky 700ml</td>
      <td>John Jameson Whisky 700ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># result = Response.fromDict(r).body</span>
<span class="c1"># url = result[&#39;url&#39;]</span>
<span class="c1"># pd.read_feather(url)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@add_class_method</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dumpToS3</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucketName</span><span class="o">=</span> <span class="n">INVENTORY_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;allData&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">dumpToS3</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
converting keys into int
quering for changes
convert to df
changesDf is shape (0, 0)
converting keys into int
saving to remote cache
hashKey is allData-hash
saving hash to s3
saved hash 4315e49752277cb0f5dbad228fdbdcce714878f5
setting noupdate
CPU times: user 139 ms, sys: 6.17 ms, total: 145 ms
Wall time: 1.28 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>pr_market</th>
      <th>pr_name</th>
      <th>pr_puqty</th>
      <th>pr_sa_method</th>
      <th>pr_sucode1</th>
      <th>pr_suref3</th>
      <th>prtype</th>
      <th>psqty</th>
      <th>pstype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>057</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>1</td>
      <td>1</td>
      <td>CM845</td>
      <td>A</td>
      <td>I</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpToS3" class="doc_header"><code>lambdaDumpToS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L162" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpToS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">lambdaDumpToS3</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
converting keys into int
quering for changes
convert to df
changesDf is shape (0, 0)
converting keys into int
saving to remote cache
hashKey is allData-hash
saving hash to s3
saved hash 4315e49752277cb0f5dbad228fdbdcce714878f5
setting noupdate
{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}
CPU times: user 139 ms, sys: 3.07 ms, total: 142 ms
Wall time: 1.27 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>pr_market</th>
      <th>pr_name</th>
      <th>pr_puqty</th>
      <th>pr_sa_method</th>
      <th>pr_sucode1</th>
      <th>pr_suref3</th>
      <th>prtype</th>
      <th>psqty</th>
      <th>pstype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>057</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>1</td>
      <td>1</td>
      <td>CM845</td>
      <td>A</td>
      <td>I</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-Standard-(instant-save)">Save using Standard (instant save)<a class="anchor-link" href="#Save-using-Standard-(instant-save)"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span> <span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT YOUNG KALE 2&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAAT YOUNG KALE 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;057&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;CM845&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]</span> <span class="c1">#ProductDatabase.valueUpdate({&#39;items&#39;:sampleProducts})</span>
<span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">INTCOLS</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">product</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">sampleProducts</span><span class="p">]</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">({</span><span class="s1">&#39;items&#39;</span> <span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.321013 ms
divided into chunks -0.321101 ms
loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
get all from s3 -0.735002 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;success&#39;: 0,
 &#39;failure&#39;: 0,
 &#39;skipped&#39;: 1,
 &#39;failureMessage&#39;: [],
 &#39;timetaken(ms)&#39;: 741.0600000000001}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateProduct" class="doc_header"><code>lambdaUpdateProduct</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L168" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateProduct</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
<span class="n">lambdaUpdateProduct</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.027118 ms
divided into chunks -0.027165 ms
loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
get all from s3 -0.460161 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:0,&#34;failure&#34;:0,&#34;skipped&#34;:1,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:462.19}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-s3">Save using s3<a class="anchor-link" href="#Save-using-s3"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="update-using-s3-link">update using s3 link<a class="anchor-link" href="#update-using-s3-link"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updateS3Input" class="doc_header"><code>updateS3Input</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L174" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updateS3Input</code>(<strong><code>inputBucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span>
                     <span class="n">accelerate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;test input data saved to s3&#39;</span><span class="p">)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span> <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s3 save result is </span><span class="si">{</span><span class="n">saveResult</span><span class="si">}</span><span class="s1"> update result is </span><span class="si">{</span><span class="n">updateResult</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.02045 ms
divided into chunks -0.020497 ms
loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
get all from s3 -0.484014 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateS3" class="doc_header"><code>lambdaUpdateS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L182" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.018978 ms
divided into chunks -0.01913 ms
loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
get all from s3 -0.478786 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:0,&#34;failure&#34;:0,&#34;skipped&#34;:1,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:480.883}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">df</span><span class="p">:</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;sampleData/products.csv&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
  <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">INTCOLS</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">fullDbData</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;records&#39;</span><span class="p">))</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">fullDbData</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="c1"># lambdaUpdateS3(event, &#39;&#39;)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span>
      <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 9, &#39;iprcode&#39;: 9, &#39;oprcode&#39;: 9, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;J. WALKER RED 70 CL.&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0000009&#39;, &#39;pr_dpcode&#39;: &#39;01&#39;, &#39;pr_engname&#39;: &#39;JOHNNIE WALKER RED 70 CL.&#39;, &#39;pr_ggcode&#39;: &#39;001&#39;, &#39;pr_market&#39;: &#39;J. WALKER RED 70 CL&#39;, &#39;pr_name&#39;: &#39;JOHNNIE WALKER RED 70 CL&#39;, &#39;pr_puqty&#39;: &#39;12.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1782&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: None, &#39;pr_country_en&#39;: &#39;United Kingdom&#39;, &#39;pr_keyword_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_filter_th&#39;: &#39;Alcohol,Spirits  Liqueurs&#39;, &#39;pr_filter_en&#39;: &#39;Alcohol,Spirits  Liqueurs&#39;, &#39;online_category_l1_th&#39;: &#39;เบียร์, ไวน์และสุรา&#39;, &#39;online_category_l1_en&#39;: &#39;Beer Wine &amp; Spirits&#39;, &#39;online_category_l2_th&#39;: &#39;เหล้า&#39;, &#39;online_category_l2_en&#39;: &#39;Spirits &amp; Liqueurs&#39;, &#39;online_category_l3_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Alcohol &amp; Beverage&#39;, &#39;villa_category_l3_en&#39;: &#39;Whisky&#39;, &#39;villa_category_l4_en&#39;: &#39;Scoth Whisky&#39;, &#39;content_en&#39;: &#39;0000009 Johnnie Walker Red 700ml&#39;, &#39;content_th&#39;: &#39;JOHNNIE WALKER RED 700ml&#39;, &#39;hema_brand_th&#39;: &#39;Johnnie Walker&#39;, &#39;hema_brand_en&#39;: &#39;Johnnie Walker&#39;, &#39;hema_sizedesc&#39;: &#39;700ml&#39;, &#39;pr_brand_en&#39;: &#39;Johnnie Walker&#39;, &#39;pr_brand_th&#39;: &#39;Johnnie Walker&#39;, &#39;pr_online_name_en&#39;: &#39;Johnnie Walker Red 700ml&#39;, &#39;pr_online_name_th&#39;: &#39;JOHNNIE WALKER RED 700ml&#39;, &#39;hema_name_en&#39;: &#39;Johnnie Walker Red&#39;, &#39;hema_name_th&#39;: &#39;JOHNNIE WALKER RED&#39;, &#39;pr_name_en&#39;: &#39;JOHNNIE WALKER RED 70 CL.&#39;, &#39;pr_name_th&#39;: &#39;JOHNNIE WALKER RED 70 CL&#39;, &#39;sort_weight&#39;: &#39;0&#39;}, {&#39;cprcode&#39;: 12, &#39;iprcode&#39;: 12, &#39;oprcode&#39;: 12, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;J.WALER BLACK 70 CL&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0000012&#39;, &#39;pr_dpcode&#39;: &#39;01&#39;, &#39;pr_engname&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;pr_ggcode&#39;: &#39;001&#39;, &#39;pr_market&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;pr_name&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;pr_puqty&#39;: &#39;12.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1782&#39;, &#39;pr_suref3&#39;: &#39;C&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: None, &#39;pr_country_en&#39;: &#39;United Kingdom&#39;, &#39;pr_keyword_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_filter_th&#39;: None, &#39;pr_filter_en&#39;: None, &#39;online_category_l1_th&#39;: None, &#39;online_category_l1_en&#39;: None, &#39;online_category_l2_th&#39;: None, &#39;online_category_l2_en&#39;: None, &#39;online_category_l3_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Alcohol &amp; Beverage&#39;, &#39;villa_category_l3_en&#39;: &#39;Whisky&#39;, &#39;villa_category_l4_en&#39;: None, &#39;content_en&#39;: &#39;0000012 Johnnie Walker Black 70 Cl.&#39;, &#39;content_th&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;hema_brand_th&#39;: &#39;Johnnie Walker&#39;, &#39;hema_brand_en&#39;: &#39;Johnnie Walker&#39;, &#39;hema_sizedesc&#39;: &#39;70 CL.&#39;, &#39;pr_brand_en&#39;: &#39;Johnnie Walker&#39;, &#39;pr_brand_th&#39;: &#39;Johnnie Walker&#39;, &#39;pr_online_name_en&#39;: &#39;Johnnie Walker Black 70 Cl.&#39;, &#39;pr_online_name_th&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;hema_name_en&#39;: &#39;Johnnie Walker Black&#39;, &#39;hema_name_th&#39;: &#39;JOHNNIE WALKER BLACK&#39;, &#39;pr_name_en&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;pr_name_th&#39;: &#39;JOHNNIE WALKER BLACK 70 CL.&#39;, &#39;sort_weight&#39;: &#39;0&#39;}, {&#39;cprcode&#39;: 26, &#39;iprcode&#39;: 26, &#39;oprcode&#39;: 26, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JOHN JAMESON 70 CL&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0000026&#39;, &#39;pr_dpcode&#39;: &#39;01&#39;, &#39;pr_engname&#39;: &#39;JOHN JAMESON 70 CL WHISKY&#39;, &#39;pr_ggcode&#39;: &#39;001&#39;, &#39;pr_market&#39;: &#39;JOHN JAMESON 70 CL WHISKY&#39;, &#39;pr_name&#39;: &#39;JOHN JAMESON 70 CL WHISKY&#39;, &#39;pr_puqty&#39;: &#39;6.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1375&#39;, &#39;pr_suref3&#39;: &#39;C&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: None, &#39;pr_country_en&#39;: &#39;United Kingdom&#39;, &#39;pr_keyword_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_filter_th&#39;: None, &#39;pr_filter_en&#39;: None, &#39;online_category_l1_th&#39;: None, &#39;online_category_l1_en&#39;: None, &#39;online_category_l2_th&#39;: None, &#39;online_category_l2_en&#39;: None, &#39;online_category_l3_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Alcohol &amp; Beverage&#39;, &#39;villa_category_l3_en&#39;: &#39;Whisky&#39;, &#39;villa_category_l4_en&#39;: None, &#39;content_en&#39;: &#39;0000026 John Jameson Whisky 700ml&#39;, &#39;content_th&#39;: &#39;John Jameson Whisky 700ml&#39;, &#39;hema_brand_th&#39;: &#39;John Jameson&#39;, &#39;hema_brand_en&#39;: &#39;John Jameson&#39;, &#39;hema_sizedesc&#39;: &#39;700ml&#39;, &#39;pr_brand_en&#39;: &#39;John Jameson&#39;, &#39;pr_brand_th&#39;: &#39;John Jameson&#39;, &#39;pr_online_name_en&#39;: &#39;John Jameson Whisky 700ml&#39;, &#39;pr_online_name_th&#39;: &#39;John Jameson Whisky 700ml&#39;, &#39;hema_name_en&#39;: &#39;Whisky&#39;, &#39;hema_name_th&#39;: &#39;Whisky&#39;, &#39;pr_name_en&#39;: &#39;JOHN JAMESON 70 CL WHISKY&#39;, &#39;pr_name_th&#39;: &#39;JOHN JAMESON 70 CL WHISKY&#39;, &#39;sort_weight&#39;: &#39;0&#39;}, {&#39;cprcode&#39;: 28, &#39;iprcode&#39;: 28, &#39;oprcode&#39;: 28, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;J B RARE WHISKY 750&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0000028&#39;, &#39;pr_dpcode&#39;: &#39;01&#39;, &#39;pr_engname&#39;: &#39;J B RARE WHISKY 750 ML.&#39;, &#39;pr_ggcode&#39;: &#39;001&#39;, &#39;pr_market&#39;: &#39;J B RARE WHISKY 750&#39;, &#39;pr_name&#39;: &#39;J B RARE WHISKY 750 ML&#39;, &#39;pr_puqty&#39;: &#39;1.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1782&#39;, &#39;pr_suref3&#39;: &#39;C&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: None, &#39;pr_country_en&#39;: &#39;United Kingdom&#39;, &#39;pr_keyword_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_filter_th&#39;: &#39;Alcohol,Spirits  Liqueurs&#39;, &#39;pr_filter_en&#39;: &#39;Alcohol,Spirits  Liqueurs&#39;, &#39;online_category_l1_th&#39;: &#39;เบียร์, ไวน์และสุรา&#39;, &#39;online_category_l1_en&#39;: &#39;Beer Wine &amp; Spirits&#39;, &#39;online_category_l2_th&#39;: &#39;เหล้า&#39;, &#39;online_category_l2_en&#39;: &#39;Spirits &amp; Liqueurs&#39;, &#39;online_category_l3_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Alcohol &amp; Beverage&#39;, &#39;villa_category_l3_en&#39;: &#39;Whisky&#39;, &#39;villa_category_l4_en&#39;: &#39;Scoth Whisky&#39;, &#39;content_en&#39;: &#39;0000028 J&amp;B Rare Whisky 750ml&#39;, &#39;content_th&#39;: &#39;J&amp;B Rare Whisky 750ml&#39;, &#39;hema_brand_th&#39;: &#39;J&amp;B&#39;, &#39;hema_brand_en&#39;: &#39;J&amp;B&#39;, &#39;hema_sizedesc&#39;: &#39;750ml&#39;, &#39;pr_brand_en&#39;: &#39;J&amp;B&#39;, &#39;pr_brand_th&#39;: &#39;J&amp;B&#39;, &#39;pr_online_name_en&#39;: &#39;J&amp;B Rare Whisky 750ml&#39;, &#39;pr_online_name_th&#39;: &#39;J&amp;B Rare Whisky 750ml&#39;, &#39;hema_name_en&#39;: &#39;Rare Whisky&#39;, &#39;hema_name_th&#39;: &#39;Rare Whisky&#39;, &#39;pr_name_en&#39;: &#39;J B RARE WHISKY 750 ML.&#39;, &#39;pr_name_th&#39;: &#39;J B RARE WHISKY 750 ML&#39;, &#39;sort_weight&#39;: &#39;0&#39;}, {&#39;cprcode&#39;: 33, &#39;iprcode&#39;: 33, &#39;oprcode&#39;: 33, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;BALLANTINE S 700ml.&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;01&#39;, &#39;pr_code&#39;: &#39;0000033&#39;, &#39;pr_dpcode&#39;: &#39;01&#39;, &#39;pr_engname&#39;: &#39;BALLANTINE S FINEST 700 ML.&#39;, &#39;pr_ggcode&#39;: &#39;001&#39;, &#39;pr_market&#39;: &#39;BALLANTINE S 700 ml.&#39;, &#39;pr_name&#39;: &#39;BALLANTINE S FINEST 700 ML&#39;, &#39;pr_puqty&#39;: &#39;6.00&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;1375&#39;, &#39;pr_suref3&#39;: &#39;C&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;pr_country_th&#39;: None, &#39;pr_country_en&#39;: &#39;United Kingdom&#39;, &#39;pr_keyword_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_filter_th&#39;: None, &#39;pr_filter_en&#39;: None, &#39;online_category_l1_th&#39;: None, &#39;online_category_l1_en&#39;: None, &#39;online_category_l2_th&#39;: None, &#39;online_category_l2_en&#39;: None, &#39;online_category_l3_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;villa_category_l1_en&#39;: &#39;Dry Grocery&#39;, &#39;villa_category_l2_en&#39;: &#39;Alcohol &amp; Beverage&#39;, &#39;villa_category_l3_en&#39;: &#39;Whisky&#39;, &#39;villa_category_l4_en&#39;: None, &#39;content_en&#39;: &#34;0000033 Ballentine&#39;s Finest Whisky 700ml&#34;, &#39;content_th&#39;: &#34;Ballentine&#39;s Finest Whisky 700ml&#34;, &#39;hema_brand_th&#39;: &#34;Ballentine&#39;s&#34;, &#39;hema_brand_en&#39;: &#34;Ballentine&#39;s&#34;, &#39;hema_sizedesc&#39;: &#39;700ml&#39;, &#39;pr_brand_en&#39;: &#39;Ballentines&#39;, &#39;pr_brand_th&#39;: &#39;Ballentines&#39;, &#39;pr_online_name_en&#39;: &#34;Ballentine&#39;s Finest Whisky 700ml&#34;, &#39;pr_online_name_th&#39;: &#34;Ballentine&#39;s Finest Whisky 700ml&#34;, &#39;hema_name_en&#39;: &#39;Finest Whisky&#39;, &#39;hema_name_th&#39;: &#39;Finest Whisky&#39;, &#39;pr_name_en&#39;: &#39;BALLANTINE S FINEST 700 ML.&#39;, &#39;pr_name_th&#39;: &#39;BALLANTINE S FINEST 700 ML&#39;, &#39;sort_weight&#39;: &#39;0&#39;}]
time taken for validation  -0.323415 ms
divided into chunks -0.323462 ms
loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
get all from s3 -0.820544 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Query-test">Query test<a class="anchor-link" href="#Query-test"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Product-Query">Product Query<a class="anchor-link" href="#Product-Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductsFromList" class="doc_header"><code>class</code> <code>ProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L199" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductsFromList</code>(<strong><code>iprcodes</code></strong>:<code>List</code>[<code>str</code>])</p>
</blockquote>
<p>ProductsFromList(iprcodes: List[str])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaProductsFromList" class="doc_header"><code>lambdaProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L203" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaProductsFromList</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0217153&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0000009&#39;</span><span class="p">]})</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;result length is not 3 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;result type is not dict&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
db shape is (1, 20)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AssertionError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;timed exec&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>

<span class="ansi-red-fg">AssertionError</span>: result length is not 3 0</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:[</span><span class="s1">&#39;0000009&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0217153&#39;</span><span class="p">]})</span>
<span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 4315e49752277cb0f5dbad228fdbdcce714878f5
data is still in sync, using local cache
db shape is (1, 20)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;[]&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleQueryInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="mi">171670</span>
<span class="p">}</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="mi">12345</span><span class="p">}))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product not found
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>cprcode                           171670
iprcode                           171670
oprcode                           171670
ordertype                              Y
pr_abb              JIRAPAT YOUNG KALE 2
pr_active                              Y
pr_cgcode                             05
pr_code                          0171670
pr_dpcode                             19
pr_engname      JIRAAT YOUNG KALE 200 G.
pr_ggcode                            057
pr_market        JIRAPAT ยอดคะน้า 200 G.
pr_name          JIRAPAT ยอดคะน้า 200 G.
pr_puqty                               1
pr_sa_method                           1
pr_sucode1                         CM845
pr_suref3                              A
prtype                                 I
psqty                                  1
pstype                                 1
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaSingleQuery" class="doc_header"><code>lambdaSingleQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L211" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaSingleQuery</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;cprcode&#34;:171670,&#34;iprcode&#34;:171670,&#34;oprcode&#34;:171670,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;JIRAPAT YOUNG KALE 2&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;05&#34;,&#34;pr_code&#34;:&#34;0171670&#34;,&#34;pr_dpcode&#34;:&#34;19&#34;,&#34;pr_engname&#34;:&#34;JIRAAT YOUNG KALE 200 G.&#34;,&#34;pr_ggcode&#34;:&#34;057&#34;,&#34;pr_market&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_name&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_puqty&#34;:&#34;1&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;CM845&#34;,&#34;pr_suref3&#34;:&#34;A&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;11234&#39;</span><span class="p">}),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;error&#39;: &#39;key is not convertable to in 11234&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AllQuery">AllQuery<a class="anchor-link" href="#AllQuery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">%</span><span class="k">time</span> url = ProductDatabase.allQuery(bucket = INVENTORY_BUCKET_NAME, key=&#39;allData-json.zl&#39;)
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># response = requests.get(url)</span>
<span class="k">def</span> <span class="nf">retrieveJsonZl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">response</span><span class="p">:</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">jsonDb</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">newDb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">jsonDb</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newDb</span>
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 25.8 ms, sys: 474 µs, total: 26.3 ms
Wall time: 367 ms
https://product-bucket-dev-manual.s3-accelerate.amazonaws.com/allData-json.zl?AWSAccessKeyId=AKIAVX4Z5TKDSNNNULGB&amp;Signature=URm%2Bb4mIXb2ODeBsU2Hsvk5QvOA%3D&amp;Expires=1611708917
CPU times: user 27.2 ms, sys: 0 ns, total: 27.2 ms
Wall time: 194 ms
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>pr_market</th>
      <th>pr_name</th>
      <th>pr_puqty</th>
      <th>pr_sa_method</th>
      <th>pr_sucode1</th>
      <th>pr_suref3</th>
      <th>prtype</th>
      <th>psqty</th>
      <th>pstype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>5</td>
      <td>171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>57</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>1</td>
      <td>1</td>
      <td>CM845</td>
      <td>A</td>
      <td>I</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2897</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2898</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: &#39;online_category_l1_en&#39;

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-39-16bac04a5e88&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>items <span class="ansi-blue-fg">=</span> filter<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> x<span class="ansi-blue-fg">:</span> x <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;&#39;</span><span class="ansi-blue-fg">,</span> newDb<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;online_category_l1_en&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> len<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>newDb<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;online_category_l1_en&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-</span> len<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-intense-fg ansi-bold">   2904</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>nlevels <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2905</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_getitem_multilevel<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2906</span><span class="ansi-red-fg">             </span>indexer <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2907</span>             <span class="ansi-green-fg">if</span> is_integer<span class="ansi-blue-fg">(</span>indexer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2908</span>                 indexer <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>indexer<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2898</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2900</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> KeyError<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> err
<span class="ansi-green-intense-fg ansi-bold">   2901</span> 
<span class="ansi-green-intense-fg ansi-bold">   2902</span>         <span class="ansi-green-fg">if</span> tolerance <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyError</span>: &#39;online_category_l1_en&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2897</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2898</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: &#39;online_category_l1_en&#39;

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-40-3c57281daa59&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>items <span class="ansi-blue-fg">=</span> filter<span class="ansi-blue-fg">(</span><span class="ansi-green-fg">lambda</span> x<span class="ansi-blue-fg">:</span> x <span class="ansi-blue-fg">!=</span> <span class="ansi-blue-fg">&#39;&#39;</span><span class="ansi-blue-fg">,</span> newDb<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;online_category_l1_en&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> len<span class="ansi-blue-fg">(</span>list<span class="ansi-blue-fg">(</span>items<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-intense-fg ansi-bold">   2904</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>nlevels <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2905</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_getitem_multilevel<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2906</span><span class="ansi-red-fg">             </span>indexer <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2907</span>             <span class="ansi-green-fg">if</span> is_integer<span class="ansi-blue-fg">(</span>indexer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2908</span>                 indexer <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>indexer<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2898</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2900</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> KeyError<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> err
<span class="ansi-green-intense-fg ansi-bold">   2901</span> 
<span class="ansi-green-intense-fg ansi-bold">   2902</span>         <span class="ansi-green-fg">if</span> tolerance <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyError</span>: &#39;online_category_l1_en&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;cprcode&#39;, &#39;iprcode&#39;, &#39;oprcode&#39;, &#39;ordertype&#39;, &#39;pr_abb&#39;, &#39;pr_active&#39;,
       &#39;pr_cgcode&#39;, &#39;pr_code&#39;, &#39;pr_dpcode&#39;, &#39;pr_engname&#39;, &#39;pr_ggcode&#39;,
       &#39;pr_market&#39;, &#39;pr_name&#39;, &#39;pr_puqty&#39;, &#39;pr_sa_method&#39;, &#39;pr_sucode1&#39;,
       &#39;pr_suref3&#39;, &#39;prtype&#39;, &#39;psqty&#39;, &#39;pstype&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;pr_suref3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>A    1
Name: pr_suref3, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQuery" class="doc_header"><code>lambdaAllQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L220" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQuery</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="o">%</span><span class="k">time</span> url = Response.fromDict(lambdaAllQuery(&#39;&#39;, &#39;&#39;)).body[&#39;url&#39;]
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 23.3 ms, sys: 3.54 ms, total: 26.8 ms
Wall time: 330 ms
CPU times: user 25.6 ms, sys: 62 µs, total: 25.6 ms
Wall time: 81.1 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1, 20)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AllQueryFeather">AllQueryFeather<a class="anchor-link" href="#AllQueryFeather"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQueryFeather" class="doc_header"><code>lambdaAllQueryFeather</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQueryFeather</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> r = lambdaAllQueryFeather(&#39;&#39;)
<span class="o">%</span><span class="k">time</span> result = Response.fromDict(r).body
<span class="n">url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">time</span> pd.read_feather(url)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
loading hashkey allData-hash
loaded hash is 49a1446695798c5cd7cd318fc844239bbd07f6a6
CPU times: user 73.6 ms, sys: 0 ns, total: 73.6 ms
Wall time: 816 ms
CPU times: user 17 µs, sys: 0 ns, total: 17 µs
Wall time: 21.5 µs
CPU times: user 14.1 ms, sys: 0 ns, total: 14.1 ms
Wall time: 70.7 ms
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>hema_sizedesc</th>
      <th>pr_brand_en</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>Y</td>
      <td>J.WALER BLACK 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000012</td>
      <td>01</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>...</td>
      <td>70 CL.</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker Black 70 Cl.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>Johnnie Walker Black</td>
      <td>JOHNNIE WALKER BLACK</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>Y</td>
      <td>J. WALKER RED 70 CL.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000009</td>
      <td>01</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>...</td>
      <td>700ml</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker Red 700ml</td>
      <td>JOHNNIE WALKER RED 700ml</td>
      <td>Johnnie Walker Red</td>
      <td>JOHNNIE WALKER RED</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>JOHNNIE WALKER RED 70 CL</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>Y</td>
      <td>JOHN JAMESON 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000026</td>
      <td>01</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>...</td>
      <td>700ml</td>
      <td>John Jameson</td>
      <td>John Jameson</td>
      <td>John Jameson Whisky 700ml</td>
      <td>John Jameson Whisky 700ml</td>
      <td>Whisky</td>
      <td>Whisky</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
      <td>33</td>
      <td>33</td>
      <td>Y</td>
      <td>BALLANTINE S 700ml.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000033</td>
      <td>01</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>...</td>
      <td>700ml</td>
      <td>Ballentines</td>
      <td>Ballentines</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>Finest Whisky</td>
      <td>Finest Whisky</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>BALLANTINE S FINEST 700 ML</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>Y</td>
      <td>J B RARE WHISKY 750</td>
      <td>Y</td>
      <td>01</td>
      <td>0000028</td>
      <td>01</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>...</td>
      <td>750ml</td>
      <td>J&amp;B</td>
      <td>J&amp;B</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>Rare Whisky</td>
      <td>Rare Whisky</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>J B RARE WHISKY 750 ML</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">pdUtils</span><span class="o">.</span><span class="n">getDfHash</span><span class="p">(</span><span class="n">database</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;database and hash are not the same&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-s3,-checking-scan-time">Update s3, checking scan time<a class="anchor-link" href="#Update-s3,-checking-scan-time"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;checking scan time&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>checking scan time
CPU times: user 3.53 ms, sys: 305 µs, total: 3.84 ms
Wall time: 6.91 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Reset-Cache">Reset Cache<a class="anchor-link" href="#Reset-Cache"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="clearCache" class="doc_header"><code>clearCache</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L233" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>clearCache</code>()</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">clearCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>hashKey is allData-hash
saving hash to s3
saved hash 4315e49752277cb0f5dbad228fdbdcce714878f5
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">allQuery</span><span class="p">()</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>pr_market</th>
      <th>pr_name</th>
      <th>pr_puqty</th>
      <th>pr_sa_method</th>
      <th>pr_sucode1</th>
      <th>pr_suref3</th>
      <th>prtype</th>
      <th>psqty</th>
      <th>pstype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>057</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>1</td>
      <td>1</td>
      <td>CM845</td>
      <td>A</td>
      <td>I</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaClearCache" class="doc_header"><code>lambdaClearCache</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L243" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaClearCache</code>(<strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lambdaClearCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>hashKey is allData-hash
saving hash to s3
saved hash 49a1446695798c5cd7cd318fc844239bbd07f6a6
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 49a1446695798c5cd7cd318fc844239bbd07f6a6
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>hema_sizedesc</th>
      <th>pr_brand_en</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>12</td>
      <td>12</td>
      <td>12</td>
      <td>Y</td>
      <td>J.WALER BLACK 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000012</td>
      <td>01</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>...</td>
      <td>70 CL.</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker Black 70 Cl.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>Johnnie Walker Black</td>
      <td>JOHNNIE WALKER BLACK</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>JOHNNIE WALKER BLACK 70 CL.</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>9</td>
      <td>9</td>
      <td>9</td>
      <td>Y</td>
      <td>J. WALKER RED 70 CL.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000009</td>
      <td>01</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>...</td>
      <td>700ml</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker</td>
      <td>Johnnie Walker Red 700ml</td>
      <td>JOHNNIE WALKER RED 700ml</td>
      <td>Johnnie Walker Red</td>
      <td>JOHNNIE WALKER RED</td>
      <td>JOHNNIE WALKER RED 70 CL.</td>
      <td>JOHNNIE WALKER RED 70 CL</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>26</td>
      <td>26</td>
      <td>Y</td>
      <td>JOHN JAMESON 70 CL</td>
      <td>Y</td>
      <td>01</td>
      <td>0000026</td>
      <td>01</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>...</td>
      <td>700ml</td>
      <td>John Jameson</td>
      <td>John Jameson</td>
      <td>John Jameson Whisky 700ml</td>
      <td>John Jameson Whisky 700ml</td>
      <td>Whisky</td>
      <td>Whisky</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>JOHN JAMESON 70 CL WHISKY</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33</td>
      <td>33</td>
      <td>33</td>
      <td>Y</td>
      <td>BALLANTINE S 700ml.</td>
      <td>Y</td>
      <td>01</td>
      <td>0000033</td>
      <td>01</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>...</td>
      <td>700ml</td>
      <td>Ballentines</td>
      <td>Ballentines</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>Ballentine's Finest Whisky 700ml</td>
      <td>Finest Whisky</td>
      <td>Finest Whisky</td>
      <td>BALLANTINE S FINEST 700 ML.</td>
      <td>BALLANTINE S FINEST 700 ML</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>28</td>
      <td>28</td>
      <td>28</td>
      <td>Y</td>
      <td>J B RARE WHISKY 750</td>
      <td>Y</td>
      <td>01</td>
      <td>0000028</td>
      <td>01</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>...</td>
      <td>750ml</td>
      <td>J&amp;B</td>
      <td>J&amp;B</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>J&amp;B Rare Whisky 750ml</td>
      <td>Rare Whisky</td>
      <td>Rare Whisky</td>
      <td>J B RARE WHISKY 750 ML.</td>
      <td>J B RARE WHISKY 750 ML</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>6 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

