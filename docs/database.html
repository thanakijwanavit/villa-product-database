---

title: Database Class


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>missing environment variable &#39;INVENTORY_BUCKET_NAME&#39; in query NB
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Database-Class">Main Database Class<a class="anchor-link" href="#Main-Database-Class"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductDatabase" class="doc_header"><code>class</code> <code>ProductDatabase</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L58" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductDatabase</code>(<strong><code>hash_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>range_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>_user_instantiated</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong>**<code>attributes</code></strong>:<code>Any</code>) :: <a href="/villaProductDatabase/query.html#Querier"><code>Querier</code></a></p>
</blockquote>
<p>Defines a <code>PynamoDB</code> Model</p>
<p>This model is backed by a table in DynamoDB.
You can create the table by with the <code>create_table</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-with-dictionary">Update with dictionary<a class="anchor-link" href="#Update-with-dictionary"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">## get original item</span>
<span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;0000009&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;engname is </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">### update item</span>
<span class="n">updatedItem</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateWithDict</span><span class="p">(</span><span class="n">item</span><span class="p">,{</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span><span class="s1">&#39;testName&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;testName&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name is changed to  </span><span class="si">{</span><span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>engname is JOHNNIE WALKER RED 70 CL.
 name is changed to  testName
CPU times: user 10.2 ms, sys: 0 ns, total: 10.2 ms
Wall time: 12.7 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-load-and-save-data">Batch load and save data<a class="anchor-link" href="#Batch-load-and-save-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;loadFrom cache not working&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
data is still in sync, using local cache
CPU times: user 432 ms, sys: 0 ns, total: 432 ms
Wall time: 586 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dump-database-to-s3">Dump database to s3<a class="anchor-link" href="#Dump-database-to-s3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ProductDatabase.resetS3Cache()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cacheDb" class="doc_header"><code>cacheDb</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L98" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cacheDb</code>(<strong><code>bucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>'allData'</code></em>, <strong><code>limit</code></strong>=<em><code>100</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>cache db to s3 and local efs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># originalDb = ProductDatabase.loadFromCache()</span>
<span class="c1"># listPd = list(product.needsUpdateIndex.query(&#39;Y&#39;, limit=5))</span>
<span class="c1"># changesDf = ProductDatabase.toDf(listPd)</span>
<span class="c1"># changesDf.set_index(&#39;cprcode&#39;, inplace=True)</span>
<span class="c1"># originalDb.set_index(&#39;cprcode&#39;,inplace=True)</span>
<span class="c1"># newDf = originalDb.append(changesDf)</span>
<span class="c1"># newDf.reset_index(inplace=True)</span>
<span class="c1"># originalDb</span>

<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 211e72cc25eae74c9b1a49ea6fc1480548cde052
data is still in sync, using local cache
quering for changes
convert to df
(100, 53)
hashKey is allData-hash
saving hash to s3
saved hash ef207804b464ea25a12a48f5fb1be980547cc3bf
CPU times: user 1.36 s, sys: 0 ns, total: 1.36 s
Wall time: 2.41 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
      <th>SaleMode_unit</th>
      <th>master_online</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0171670</td>
      <td>0171670</td>
      <td>0171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAPAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0243940</td>
      <td>0243940</td>
      <td>0243940</td>
      <td>Y</td>
      <td>KIDDO 4M SUPER NOVA</td>
      <td>Y</td>
      <td>14</td>
      <td>0243940</td>
      <td>19</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>...</td>
      <td>KIDDO ของเล่นดาวเรืองแสงและดาวเคราะห์</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kiddo Toys</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0227760</td>
      <td>0227759</td>
      <td>0227759</td>
      <td>N</td>
      <td>PORK SAUSAGE PATTIES</td>
      <td>Y</td>
      <td>83</td>
      <td>0227760</td>
      <td>19</td>
      <td>PORK SAUSAGE PATTIES</td>
      <td>...</td>
      <td>(ขาย) PORK SAUSAGE PATTIES หลายบาร์ 0227759</td>
      <td>Pork Sausage Patties</td>
      <td>(ขาย) PORK SAUSAGE PATTIES หลายบาร์ 0227759</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0232665</td>
      <td>0232665</td>
      <td>0232665</td>
      <td>Y</td>
      <td>PF EGG PLANT</td>
      <td>Y</td>
      <td>05</td>
      <td>0232665</td>
      <td>19</td>
      <td>PF EGG PLANT</td>
      <td>...</td>
      <td>PF มะเขือม่วงใหญ่</td>
      <td>PF EGG PLANT</td>
      <td>PF EGG PLANT</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Fruits &amp; Vegetable Local</td>
      <td>Local Vegetable</td>
      <td>GRAMS</td>
      <td>N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0121435</td>
      <td>0121435</td>
      <td>0121435</td>
      <td>Y</td>
      <td>STLE KOKO KRUNCH  DU</td>
      <td>Y</td>
      <td>07</td>
      <td>0121435</td>
      <td>05</td>
      <td>NESTLE KOKO KRUNCH  DUO CEREAL 330 G.</td>
      <td>...</td>
      <td>NESTLE KOKO KRUNCH DUO CEREAL 330 G.</td>
      <td>Koko Krunch Duo Cereal 330g</td>
      <td>Koko Krunch Duo Cereal 330g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Baby Food &amp; Milk / Breakfast Food</td>
      <td>Cereal / Muesli</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>196</th>
      <td>0225375</td>
      <td>0225375</td>
      <td>0225375</td>
      <td>Y</td>
      <td>ANO PINOT CHARDONNAY</td>
      <td>Y</td>
      <td>10</td>
      <td>0225375</td>
      <td>01</td>
      <td>ANO PINOT CHARDONNAY BRUT</td>
      <td>...</td>
      <td>CINZANO PINOT CHARDONNAY BRUT</td>
      <td>Cinzano Pinot Chardonnay Brut 750ml</td>
      <td>Cinzano Pinot Chardonnay Brut 750ml</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Champagne</td>
      <td>Prosecco</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>197</th>
      <td>0240617</td>
      <td>0240617</td>
      <td>0240617</td>
      <td>Y</td>
      <td>2 TRAY BLACK CLEAR</td>
      <td>Y</td>
      <td>52</td>
      <td>0240617</td>
      <td>17</td>
      <td>2 TRAY BLACK CLEAR</td>
      <td>...</td>
      <td>ถาด 2 ช่องพร้อมฝาสีดำ</td>
      <td>2 TRAY BLACK CLEAR</td>
      <td>2 TRAY BLACK CLEAR</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Store Supply</td>
      <td>Tray</td>
      <td></td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>198</th>
      <td>0217813</td>
      <td>0217813</td>
      <td>0217813</td>
      <td>Y</td>
      <td>MONOPRIX HERRING FIL</td>
      <td>Y</td>
      <td>82</td>
      <td>0217813</td>
      <td>28</td>
      <td>MONOPRIX HERRING FILET SMOKED TERRIN MX</td>
      <td>...</td>
      <td>MONOPRIX HERRING FILET SMOKED TERRIN MX</td>
      <td>Monoprix Smoked Herring Fillet Terrin Mix 200g</td>
      <td>Monoprix Smoked Herring Fillet Terrin Mix 200g</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Import</td>
      <td>Seafood</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>199</th>
      <td>0231742</td>
      <td>0231742</td>
      <td>0231742</td>
      <td>Y</td>
      <td>GALBANI FETTA GOLOSA</td>
      <td>Y</td>
      <td>74</td>
      <td>0231742</td>
      <td>19</td>
      <td>GALBANI FETTA GOLOSA 8KG</td>
      <td>...</td>
      <td>กัลบานีเฟทต้าโกโลซาแฮม 8กก</td>
      <td>GALBANI FETTA GOLOSA 8KG</td>
      <td>GALBANI FETTA GOLOSA 8KG</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Import</td>
      <td>Sausages</td>
      <td>GRAMS</td>
      <td>N</td>
    </tr>
    <tr>
      <th>200</th>
      <td>0238195</td>
      <td>0238195</td>
      <td>0238195</td>
      <td>Y</td>
      <td>HOMEMADE CHIPS AND</td>
      <td>Y</td>
      <td>74</td>
      <td>0238195</td>
      <td>19</td>
      <td>HOMEMADE CHIPS AND  SALSA</td>
      <td>...</td>
      <td>(ขาย)0238194 โฮมเมด ชิปส์ กับ ซัลซ่า</td>
      <td>Sunrise Tacos Homemade Chips and Salsa (blank)</td>
      <td>Sunrise Tacos Homemade Chips and Salsa (blank)</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>International Foods</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>201 rows × 54 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@add_class_method</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dumpToS3</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucketName</span><span class="o">=</span> <span class="n">INVENTORY_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;allData&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">dumpToS3</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 8fa1eb84fee3076dd1ca5c11bb5f460412480cc1
remote hash is not the same, load remote cache
quering for changes
convert to df
(1000, 53)
hashKey is allData-hash
saving hash to s3
saved hash d8c7090261753c24c62945a8ba6ca7a9551c2803
CPU times: user 12.9 s, sys: 0 ns, total: 12.9 s
Wall time: 15.3 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_name_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>sort_weight</th>
      <th>villa_category_l1_en</th>
      <th>villa_category_l2_en</th>
      <th>villa_category_l3_en</th>
      <th>villa_category_l4_en</th>
      <th>SaleMode_unit</th>
      <th>master_online</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0171670</td>
      <td>0171670</td>
      <td>0171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAPAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0243940</td>
      <td>0243940</td>
      <td>0243940</td>
      <td>Y</td>
      <td>KIDDO 4M SUPER NOVA</td>
      <td>Y</td>
      <td>14</td>
      <td>0243940</td>
      <td>19</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>...</td>
      <td>KIDDO ของเล่นดาวเรืองแสงและดาวเคราะห์</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>KIDDO 4M SUPER NOVA 20PCS WITH PLANETS</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Toys</td>
      <td>Kiddo Toys</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0227760</td>
      <td>0227759</td>
      <td>0227759</td>
      <td>N</td>
      <td>PORK SAUSAGE PATTIES</td>
      <td>Y</td>
      <td>83</td>
      <td>0227760</td>
      <td>19</td>
      <td>PORK SAUSAGE PATTIES</td>
      <td>...</td>
      <td>(ขาย) PORK SAUSAGE PATTIES หลายบาร์ 0227759</td>
      <td>Pork Sausage Patties</td>
      <td>(ขาย) PORK SAUSAGE PATTIES หลายบาร์ 0227759</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Delicatessen</td>
      <td>Local</td>
      <td>Sausages</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0232665</td>
      <td>0232665</td>
      <td>0232665</td>
      <td>Y</td>
      <td>PF EGG PLANT</td>
      <td>Y</td>
      <td>05</td>
      <td>0232665</td>
      <td>19</td>
      <td>PF EGG PLANT</td>
      <td>...</td>
      <td>PF มะเขือม่วงใหญ่</td>
      <td>PF EGG PLANT</td>
      <td>PF EGG PLANT</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Fruits &amp; Vegetable Local</td>
      <td>Local Vegetable</td>
      <td>GRAMS</td>
      <td>N</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0121435</td>
      <td>0121435</td>
      <td>0121435</td>
      <td>Y</td>
      <td>STLE KOKO KRUNCH  DU</td>
      <td>Y</td>
      <td>07</td>
      <td>0121435</td>
      <td>05</td>
      <td>NESTLE KOKO KRUNCH  DUO CEREAL 330 G.</td>
      <td>...</td>
      <td>NESTLE KOKO KRUNCH DUO CEREAL 330 G.</td>
      <td>Koko Krunch Duo Cereal 330g</td>
      <td>Koko Krunch Duo Cereal 330g</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Baby Food &amp; Milk / Breakfast Food</td>
      <td>Cereal / Muesli</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1696</th>
      <td>0241125</td>
      <td>0241125</td>
      <td>0241125</td>
      <td>Y</td>
      <td>KAMBLY BUTTERFLY SAL</td>
      <td>Y</td>
      <td>01</td>
      <td>0241125</td>
      <td>02</td>
      <td>KAMBLY BUTTERFLY SALTED CARAMEL</td>
      <td>...</td>
      <td>แคมบลีย์ บัตเตอร์ฟลาย ซอลต์เต็ด คาราเมล</td>
      <td>KAMBLY BUTTERFLY SALTED CARAMEL</td>
      <td>KAMBLY BUTTERFLY SALTED CARAMEL</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Grocery</td>
      <td>Cookies &amp; Snacks</td>
      <td>Biscuits &amp; Crackers</td>
      <td>ITEM</td>
      <td>N</td>
    </tr>
    <tr>
      <th>1697</th>
      <td>0235325</td>
      <td>0235325</td>
      <td>0235325</td>
      <td>Y</td>
      <td>BALLOON-CHRISTMAS OR</td>
      <td>Y</td>
      <td>16</td>
      <td>0235325</td>
      <td>19</td>
      <td>BALLOON-CHRISTMAS ORNAMENT 3</td>
      <td>...</td>
      <td>BALLOON-คริสมาสต์ ออนาเม้น3</td>
      <td>BALLOON-CHRISTMAS ORNAMENT 3</td>
      <td>BALLOON-คริสมาสต์ ออนาเม้น3</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>Household Hardware</td>
      <td>Houseware</td>
      <td>ITEM</td>
      <td>Y</td>
    </tr>
    <tr>
      <th>1698</th>
      <td>0182623</td>
      <td>0182623</td>
      <td>0182623</td>
      <td>Y</td>
      <td>MELON</td>
      <td>Y</td>
      <td>05</td>
      <td>0182623</td>
      <td>19</td>
      <td>ยกเลิกMELON</td>
      <td>...</td>
      <td>QUALITY VEGETABEL แตงธิเบต</td>
      <td>ยกเลิกMELON</td>
      <td>ยกเลิกMELON</td>
      <td>0</td>
      <td>Fresh</td>
      <td>Fresh Produce</td>
      <td>Fruits &amp; Vegetable Local</td>
      <td>Local Fruit</td>
      <td>ITEM</td>
      <td>N</td>
    </tr>
    <tr>
      <th>1699</th>
      <td>0214460</td>
      <td>0214460</td>
      <td>0214460</td>
      <td>Y</td>
      <td>MANICARE  M23051SMUD</td>
      <td>Y</td>
      <td>16</td>
      <td>0214460</td>
      <td>19</td>
      <td>MANICARE  M23051SMUDGE BRUSH</td>
      <td>...</td>
      <td>MANICARE  M23051  แปรงทาตา</td>
      <td>MANICARE  M23051SMUDGE BRUSH</td>
      <td>MANICARE  M23051SMUDGE BRUSH</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Household</td>
      <td>HBA</td>
      <td>Cosmetics</td>
      <td>ITEM</td>
      <td>N</td>
    </tr>
    <tr>
      <th>1700</th>
      <td>0240731</td>
      <td>0240731</td>
      <td>0240731</td>
      <td>Y</td>
      <td>SUNTORY HAKUSHU SING</td>
      <td>Y</td>
      <td>01</td>
      <td>0240731</td>
      <td>01</td>
      <td>SUNTORY HAKUSHU SINGLE MALT WHISKY 12 Y</td>
      <td>...</td>
      <td>ซันโทรี่ ฮากุชู  ซิงเกิ้ลมอลล์วิสกี้ 12 ปี</td>
      <td>SUNTORY HAKUSHU SINGLE MALT WHISKY 12 Y</td>
      <td>SUNTORY HAKUSHU SINGLE MALT WHISKY 12 Y</td>
      <td>0</td>
      <td>Dry Grocery</td>
      <td>Alcohol &amp; Beverage</td>
      <td>Whisky</td>
      <td></td>
      <td>ITEM</td>
      <td>N</td>
    </tr>
  </tbody>
</table>
<p>1701 rows × 54 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpToS3" class="doc_header"><code>lambdaDumpToS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L122" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpToS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">lambdaDumpToS3</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is d8c7090261753c24c62945a8ba6ca7a9551c2803
data is still in sync, using local cache
quering for changes
convert to df
(500, 53)
hashKey is allData-hash
saving hash to s3
saved hash d20128693d487b6952a8ae8ef85e598812f72094
{&#39;cprcode&#39;: &#39;0171670&#39;, &#39;iprcode&#39;: &#39;0171670&#39;, &#39;oprcode&#39;: &#39;0171670&#39;, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAPAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;, &#39;content_en&#39;: None, &#39;content_th&#39;: None, &#39;hema_brand_en&#39;: None, &#39;hema_brand_th&#39;: None, &#39;hema_name_en&#39;: None, &#39;hema_name_th&#39;: None, &#39;hema_sizedesc&#39;: None, &#39;online_category_l1_en&#39;: None, &#39;online_category_l1_th&#39;: None, &#39;online_category_l2_en&#39;: None, &#39;online_category_l2_th&#39;: None, &#39;online_category_l3_en&#39;: None, &#39;online_category_l3_th&#39;: None, &#39;pr_barcode&#39;: None, &#39;pr_barcode2&#39;: None, &#39;pr_brand_en&#39;: None, &#39;pr_brand_th&#39;: None, &#39;pr_country_en&#39;: None, &#39;pr_country_th&#39;: None, &#39;pr_filter_en&#39;: None, &#39;pr_filter_th&#39;: None, &#39;pr_keyword_en&#39;: None, &#39;pr_keyword_th&#39;: None, &#39;pr_name_en&#39;: None, &#39;pr_name_th&#39;: None, &#39;pr_online_name_en&#39;: None, &#39;pr_online_name_th&#39;: None, &#39;sort_weight&#39;: None, &#39;villa_category_l1_en&#39;: None, &#39;villa_category_l2_en&#39;: None, &#39;villa_category_l3_en&#39;: None, &#39;villa_category_l4_en&#39;: None, &#39;SaleMode_unit&#39;: None, &#39;master_online&#39;: None}
CPU times: user 6.71 s, sys: 0 ns, total: 6.71 s
Wall time: 8.23 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is e63c6c6ab5030e00da6c2c0352ea4a9c9cd573f8
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>pr_ggcode</th>
      <th>pr_market</th>
      <th>pr_name</th>
      <th>pr_puqty</th>
      <th>pr_sa_method</th>
      <th>pr_sucode1</th>
      <th>pr_suref3</th>
      <th>prtype</th>
      <th>psqty</th>
      <th>pstype</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0171670</td>
      <td>0171670</td>
      <td>0171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAPAT YOUNG KALE 200 G.</td>
      <td>057</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>JIRAPAT ยอดคะน้า 200 G.</td>
      <td>1</td>
      <td>1</td>
      <td>CM845</td>
      <td>A</td>
      <td>I</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-Standard-(instant-save)">Save using Standard (instant save)<a class="anchor-link" href="#Save-using-Standard-(instant-save)"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Product" class="doc_header"><code>class</code> <code>Product</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L129" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Product</code>(<strong><code>iprcode</code></strong>:<code>str</code>, <strong><code>cprcode</code></strong>:<code>str</code>, <strong><code>data</code></strong>:<code>Optional</code>[<code>CatchAllVar</code>])</p>
</blockquote>
<p>Product(iprcode: str, cprcode: str, data: Union[~CatchAllVar, NoneType])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ValueUpdate" class="doc_header"><code>class</code> <code>ValueUpdate</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L135" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ValueUpdate</code>(<strong><code>items</code></strong>:<code>List</code>[<a href="/villaProductDatabase/database.html#Product"><code>Product</code></a>])</p>
</blockquote>
<p>ValueUpdate(items: List[villaProductDatabase.database.Product])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chunks" class="doc_header"><code>chunks</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L139" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chunks</code>(<strong><code>l</code></strong>, <strong><code>n</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74, 75, 76, 77, 78, 79],
 [80, 81, 82, 83, 84, 85, 86, 87, 88, 89],
 [90, 91, 92, 93, 94, 95, 96, 97, 98, 99]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span> <span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT YOUNG KALE 2&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAAT YOUNG KALE 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;057&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;CM845&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]</span> <span class="c1">#ProductDatabase.valueUpdate({&#39;items&#39;:sampleProducts})</span>
<span class="n">products</span> <span class="o">=</span> <span class="n">ValueUpdate</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="s1">&#39;items&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="c1"># print(products[0])</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.013 ms
divided into chunks 1.138 ms
loading hashkey allData-hash
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
data is still in sync, using local cache
get all from s3 543.353 ms
incumbentSeries is type &lt;class &#39;pandas.core.series.Series&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;success&#39;: 1,
 &#39;failure&#39;: 0,
 &#39;skipped&#39;: 0,
 &#39;failureMessage&#39;: [],
 &#39;timetaken(ms)&#39;: 610.757}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateProduct" class="doc_header"><code>lambdaUpdateProduct</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L142" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateProduct</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
<span class="n">lambdaUpdateProduct</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.011 ms
divided into chunks 0.315 ms
loading hashkey allData-hash
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
data is still in sync, using local cache
get all from s3 511.995 ms
incumbentSeries is type &lt;class &#39;pandas.core.series.Series&#39;&gt;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:1,&#34;failure&#34;:0,&#34;skipped&#34;:0,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:572.1460000000001}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-s3">Save using s3<a class="anchor-link" href="#Save-using-s3"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="update-using-s3-link">update using s3 link<a class="anchor-link" href="#update-using-s3-link"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updateS3Input" class="doc_header"><code>updateS3Input</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updateS3Input</code>(<strong><code>inputBucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span>
                     <span class="n">accelerate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;test input data saved to s3&#39;</span><span class="p">)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span> <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s3 save result is </span><span class="si">{</span><span class="n">saveResult</span><span class="si">}</span><span class="s1"> update result is </span><span class="si">{</span><span class="n">updateResult</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.012 ms
divided into chunks 0.437 ms
loading hashkey allData-hash
error downloading file An error occurred (404) when calling the HeadObject operation: Not Found
local loading error&#39;list&#39; object has no attribute &#39;get&#39;, loading remote hash
locding remtoe failed An error occurred (404) when calling the HeadObject operation: Not Found returning blank df
get all from s3 237.40200000000002 ms
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2897</span>             <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2898</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/index.pyx</span> in <span class="ansi-cyan-fg">pandas._libs.index.IndexEngine.get_loc</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-green-fg">pandas/_libs/hashtable_class_helper.pxi</span> in <span class="ansi-cyan-fg">pandas._libs.hashtable.PyObjectHashTable.get_item</span><span class="ansi-blue-fg">()</span>

<span class="ansi-red-fg">KeyError</span>: &#39;cprcode&#39;

The above exception was the direct cause of the following exception:

<span class="ansi-red-fg">KeyError</span>                                  Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-31-c472d2bc5685&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span>                      accelerate = True)
<span class="ansi-green-intense-fg ansi-bold">      6</span> logging<span class="ansi-blue-fg">.</span>info<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;test input data saved to s3&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 7</span><span class="ansi-red-fg"> </span>updateResult <span class="ansi-blue-fg">=</span> ProductDatabase<span class="ansi-blue-fg">.</span>updateS3Input<span class="ansi-blue-fg">(</span> inputBucketName<span class="ansi-blue-fg">=</span>INPUT_BUCKET_NAME<span class="ansi-blue-fg">,</span> key<span class="ansi-blue-fg">=</span> inputKeyName<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> 
<span class="ansi-green-intense-fg ansi-bold">      9</span> logging<span class="ansi-blue-fg">.</span>info<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;s3 save result is {saveResult} update result is {updateResult}&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/nicHelper/wrappers.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(cls, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span>         <span class="ansi-blue-fg">@</span>classmethod
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 36</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span> cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>         setattr<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> func<span class="ansi-blue-fg">.</span>__name__<span class="ansi-blue-fg">,</span> wrapper<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-red-fg"># Note we are not binding func, but wrapper which accepts self but does exactly the same as func</span>

<span class="ansi-green-fg">&lt;ipython-input-30-a6538ce90b4c&gt;</span> in <span class="ansi-cyan-fg">updateS3Input</span><span class="ansi-blue-fg">(cls, inputBucketName, key, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span class="ansi-green-fg">def</span> updateS3Input<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> inputBucketName <span class="ansi-blue-fg">=</span> INPUT_BUCKET_NAME<span class="ansi-blue-fg">,</span> key <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#39;&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span>   products <span class="ansi-blue-fg">=</span> S3<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">=</span>key<span class="ansi-blue-fg">,</span> bucket <span class="ansi-blue-fg">=</span> inputBucketName<span class="ansi-blue-fg">,</span>  <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 5</span><span class="ansi-red-fg">   </span>updateResult <span class="ansi-blue-fg">=</span> cls<span class="ansi-blue-fg">.</span>valueUpdate2<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">&#39;items&#39;</span><span class="ansi-blue-fg">:</span>products<span class="ansi-blue-fg">}</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span>   <span class="ansi-green-fg">return</span> updateResult

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/nicHelper/wrappers.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(cls, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span>         <span class="ansi-blue-fg">@</span>classmethod
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 36</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span> cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>         setattr<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> func<span class="ansi-blue-fg">.</span>__name__<span class="ansi-blue-fg">,</span> wrapper<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-red-fg"># Note we are not binding func, but wrapper which accepts self but does exactly the same as func</span>

<span class="ansi-green-fg">~/SageMaker/stacks/villaMaster/villa-master-dev/product/database2/villaProductDatabase/update.py</span> in <span class="ansi-cyan-fg">valueUpdate2</span><span class="ansi-blue-fg">(cls, inputs)</span>
<span class="ansi-green-intense-fg ansi-bold">     93</span> 
<span class="ansi-green-intense-fg ansi-bold">     94</span>           <span class="ansi-red-fg">##### check if product is in the database, if not, create an empty class with the product code</span>
<span class="ansi-green-fg">---&gt; 95</span><span class="ansi-red-fg">           </span>incumbentSeries <span class="ansi-blue-fg">=</span> db<span class="ansi-blue-fg">[</span>db<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;cprcode&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">==</span>cprcode<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>iloc<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     96</span>           <span class="ansi-green-fg">if</span> incumbentSeries<span class="ansi-blue-fg">.</span>any<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>             print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;incumbentSeries is type {type(incumbentSeries)}&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/frame.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-intense-fg ansi-bold">   2904</span>             <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>nlevels <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2905</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_getitem_multilevel<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 2906</span><span class="ansi-red-fg">             </span>indexer <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>columns<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2907</span>             <span class="ansi-green-fg">if</span> is_integer<span class="ansi-blue-fg">(</span>indexer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   2908</span>                 indexer <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>indexer<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/core/indexes/base.py</span> in <span class="ansi-cyan-fg">get_loc</span><span class="ansi-blue-fg">(self, key, method, tolerance)</span>
<span class="ansi-green-intense-fg ansi-bold">   2898</span>                 <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>_engine<span class="ansi-blue-fg">.</span>get_loc<span class="ansi-blue-fg">(</span>casted_key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   2899</span>             <span class="ansi-green-fg">except</span> KeyError <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 2900</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">raise</span> KeyError<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> err
<span class="ansi-green-intense-fg ansi-bold">   2901</span> 
<span class="ansi-green-intense-fg ansi-bold">   2902</span>         <span class="ansi-green-fg">if</span> tolerance <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">not</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-red-fg">KeyError</span>: &#39;cprcode&#39;</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateS3" class="doc_header"><code>lambdaUpdateS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L156" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>input validated 0.053 ms
divided into chunks 0.17300000000000001 ms
loading hashkey allData-hash
error downloading file An error occurred (404) when calling the HeadObject operation: Not Found
local loading error&#39;list&#39; object has no attribute &#39;get&#39;, loading remote hash
locding remtoe failed An error occurred (404) when calling the HeadObject operation: Not Found returning blank df
get all from s3 194.14999999999998 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;error&#34;:&#34;Traceback (most recent call last):\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/.persisted_conda\\/python38\\/lib\\/python3.8\\/site-packages\\/pandas\\/core\\/indexes\\/base.py\\&#34;, line 2898, in get_loc\\n    return self._engine.get_loc(casted_key)\\n  File \\&#34;pandas\\/_libs\\/index.pyx\\&#34;, line 70, in pandas._libs.index.IndexEngine.get_loc\\n  File \\&#34;pandas\\/_libs\\/index.pyx\\&#34;, line 101, in pandas._libs.index.IndexEngine.get_loc\\n  File \\&#34;pandas\\/_libs\\/hashtable_class_helper.pxi\\&#34;, line 1675, in pandas._libs.hashtable.PyObjectHashTable.get_item\\n  File \\&#34;pandas\\/_libs\\/hashtable_class_helper.pxi\\&#34;, line 1683, in pandas._libs.hashtable.PyObjectHashTable.get_item\\nKeyError: \&#39;cprcode\&#39;\\n\\nThe above exception was the direct cause of the following exception:\\n\\nTraceback (most recent call last):\\n  File \\&#34;&lt;ipython-input-28-ca6b85a42a07&gt;\\&#34;, line 5, in lambdaUpdateS3\\n    updateResult = ProductDatabase.updateS3Input(\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/.persisted_conda\\/python38\\/lib\\/python3.8\\/site-packages\\/nicHelper\\/wrappers.py\\&#34;, line 36, in wrapper\\n    return func( cls, *args, **kwargs)\\n  File \\&#34;&lt;ipython-input-24-a6538ce90b4c&gt;\\&#34;, line 5, in updateS3Input\\n    updateResult = cls.valueUpdate2({\&#39;items\&#39;:products})\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/.persisted_conda\\/python38\\/lib\\/python3.8\\/site-packages\\/nicHelper\\/wrappers.py\\&#34;, line 36, in wrapper\\n    return func( cls, *args, **kwargs)\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/stacks\\/villaMaster\\/villa-master-dev\\/product\\/database2\\/villaProductDatabase\\/update.py\\&#34;, line 95, in valueUpdate2\\n    incumbentSeries = db[db[\&#39;cprcode\&#39;]==cprcode].iloc[0]\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/.persisted_conda\\/python38\\/lib\\/python3.8\\/site-packages\\/pandas\\/core\\/frame.py\\&#34;, line 2906, in __getitem__\\n    indexer = self.columns.get_loc(key)\\n  File \\&#34;\\/home\\/ec2-user\\/SageMaker\\/.persisted_conda\\/python38\\/lib\\/python3.8\\/site-packages\\/pandas\\/core\\/indexes\\/base.py\\&#34;, line 2900, in get_loc\\n    raise KeyError(key) from err\\nKeyError: \&#39;cprcode\&#39;\\n&#34;}&#39;,
 &#39;statusCode&#39;: 400,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Query-test">Query test<a class="anchor-link" href="#Query-test"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Product-Query">Product Query<a class="anchor-link" href="#Product-Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductsFromList" class="doc_header"><code>class</code> <code>ProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L173" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductsFromList</code>(<strong><code>iprcodes</code></strong>:<code>List</code>[<code>str</code>])</p>
</blockquote>
<p>ProductsFromList(iprcodes: List[str])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaProductsFromList" class="doc_header"><code>lambdaProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L177" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaProductsFromList</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0217153&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0000009&#39;</span><span class="p">]})</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;result length is not 3 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;result type is not dict&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
data is still in sync, using local cache
db shape is (45149, 52)
CPU times: user 292 ms, sys: 53 ms, total: 345 ms
Wall time: 424 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:[</span><span class="s1">&#39;0000009&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0217153&#39;</span><span class="p">]})</span>
<span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
data is still in sync, using local cache
db shape is (45149, 52)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;[{&#34;cprcode&#34;:&#34;0217153&#34;,&#34;iprcode&#34;:&#34;0217153&#34;,&#34;oprcode&#34;:&#34;0217153&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;COCOA LOCO MILK CHOC&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;98&#34;,&#34;pr_code&#34;:&#34;0217153&#34;,&#34;pr_dpcode&#34;:&#34;28&#34;,&#34;pr_engname&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_ggcode&#34;:&#34;003&#34;,&#34;pr_market&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL&#34;,&#34;pr_name&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_puqty&#34;:&#34;24.00&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;F1239&#34;,&#34;pr_suref3&#34;:&#34;S&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;pr_country_th&#34;:&#34;&#34;,&#34;pr_country_en&#34;:&#34;United Kingdom&#34;,&#34;pr_keyword_th&#34;:&#34;&#34;,&#34;pr_keyword_en&#34;:&#34;&#34;,&#34;pr_filter_th&#34;:&#34;&#34;,&#34;pr_filter_en&#34;:&#34;&#34;,&#34;online_category_l1_th&#34;:&#34;&#34;,&#34;online_category_l1_en&#34;:&#34;&#34;,&#34;online_category_l2_th&#34;:&#34;&#34;,&#34;online_category_l2_en&#34;:&#34;&#34;,&#34;online_category_l3_th&#34;:&#34;&#34;,&#34;online_category_l3_en&#34;:&#34;&#34;,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Grocery&#34;,&#34;villa_category_l3_en&#34;:&#34;Cookies &amp; Snacks&#34;,&#34;villa_category_l4_en&#34;:&#34;Biscuits &amp; Crackers&#34;,&#34;content_en&#34;:&#34;0217153 COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;content_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_brand_th&#34;:&#34;&#34;,&#34;hema_brand_en&#34;:&#34;&#34;,&#34;hema_sizedesc&#34;:&#34;&#34;,&#34;pr_brand_en&#34;:&#34;&#34;,&#34;pr_brand_th&#34;:&#34;&#34;,&#34;pr_online_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_online_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;hema_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_name_en&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_name_th&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_barcode&#34;:&#34;5060148383378&#34;,&#34;pr_barcode2&#34;:&#34;506014838337&#34;,&#34;sort_weight&#34;:&#34;0&#34;},{&#34;cprcode&#34;:&#34;0000009&#34;,&#34;iprcode&#34;:&#34;0000009&#34;,&#34;oprcode&#34;:&#34;0000009&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;J. WALKER RED 70 CL.&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;01&#34;,&#34;pr_code&#34;:&#34;0000009&#34;,&#34;pr_dpcode&#34;:&#34;01&#34;,&#34;pr_engname&#34;:&#34;JOHNNIE WALKER RED 70 CL.&#34;,&#34;pr_ggcode&#34;:&#34;001&#34;,&#34;pr_market&#34;:&#34;J. WALKER RED 70 CL&#34;,&#34;pr_name&#34;:&#34;JOHNNIE WALKER RED 70 CL&#34;,&#34;pr_puqty&#34;:&#34;12.00&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;1782&#34;,&#34;pr_suref3&#34;:&#34;A&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;pr_country_th&#34;:&#34;&#34;,&#34;pr_country_en&#34;:&#34;United Kingdom&#34;,&#34;pr_keyword_th&#34;:&#34;&#34;,&#34;pr_keyword_en&#34;:&#34;&#34;,&#34;pr_filter_th&#34;:&#34;Alcohol,Spirits  Liqueurs&#34;,&#34;pr_filter_en&#34;:&#34;Alcohol,Spirits  Liqueurs&#34;,&#34;online_category_l1_th&#34;:&#34;\\u0e40\\u0e1a\\u0e35\\u0e22\\u0e23\\u0e4c, \\u0e44\\u0e27\\u0e19\\u0e4c\\u0e41\\u0e25\\u0e30\\u0e2a\\u0e38\\u0e23\\u0e32&#34;,&#34;online_category_l1_en&#34;:&#34;Beer Wine &amp; Spirits&#34;,&#34;online_category_l2_th&#34;:&#34;\\u0e40\\u0e2b\\u0e25\\u0e49\\u0e32&#34;,&#34;online_category_l2_en&#34;:&#34;Spirits &amp; Liqueurs&#34;,&#34;online_category_l3_th&#34;:&#34;&#34;,&#34;online_category_l3_en&#34;:&#34;&#34;,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Alcohol &amp; Beverage&#34;,&#34;villa_category_l3_en&#34;:&#34;Whisky&#34;,&#34;villa_category_l4_en&#34;:&#34;Scoth Whisky&#34;,&#34;content_en&#34;:&#34;0000009 Johnnie Walker Red 700ml&#34;,&#34;content_th&#34;:&#34;JOHNNIE WALKER RED 700ml&#34;,&#34;hema_brand_th&#34;:&#34;Johnnie Walker&#34;,&#34;hema_brand_en&#34;:&#34;Johnnie Walker&#34;,&#34;hema_sizedesc&#34;:&#34;700ml&#34;,&#34;pr_brand_en&#34;:&#34;Johnnie Walker&#34;,&#34;pr_brand_th&#34;:&#34;Johnnie Walker&#34;,&#34;pr_online_name_en&#34;:&#34;Johnnie Walker Red 700ml&#34;,&#34;pr_online_name_th&#34;:&#34;JOHNNIE WALKER RED 700ml&#34;,&#34;hema_name_en&#34;:&#34;Johnnie Walker Red&#34;,&#34;hema_name_th&#34;:&#34;JOHNNIE WALKER RED&#34;,&#34;pr_name_en&#34;:&#34;JOHNNIE WALKER RED 70 CL.&#34;,&#34;pr_name_th&#34;:&#34;JOHNNIE WALKER RED 70 CL&#34;,&#34;pr_barcode&#34;:null,&#34;pr_barcode2&#34;:null,&#34;sort_weight&#34;:&#34;0&#34;},{&#34;cprcode&#34;:&#34;203915&#34;,&#34;iprcode&#34;:&#34;203915&#34;,&#34;oprcode&#34;:&#34;203915&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;MEIJI GUMMY CHOCO GR&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;4&#34;,&#34;pr_code&#34;:&#34;203915&#34;,&#34;pr_dpcode&#34;:&#34;2.0&#34;,&#34;pr_engname&#34;:&#34;MEIJI GUMMY CHOCO GREEN GRAPE 30G&#34;,&#34;pr_ggcode&#34;:&#34;2&#34;,&#34;pr_market&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30&#34;,&#34;pr_name&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30 \\u0e01\\u0e23\\u0e31\\u0e21&#34;,&#34;pr_puqty&#34;:&#34;20.0&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;2943&#34;,&#34;pr_suref3&#34;:&#34;C&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1.0&#34;,&#34;pstype&#34;:&#34;1.0&#34;,&#34;pr_country_th&#34;:&#34;none&#34;,&#34;pr_country_en&#34;:&#34;China&#34;,&#34;pr_keyword_th&#34;:&#34;none&#34;,&#34;pr_keyword_en&#34;:&#34;none&#34;,&#34;pr_filter_th&#34;:&#34;Grocery,Chocolate&#34;,&#34;pr_filter_en&#34;:&#34;Grocery,Chocolate&#34;,&#34;online_category_l1_th&#34;:&#34;\\u0e2a\\u0e34\\u0e19\\u0e04\\u0e49\\u0e32\\u0e1a\\u0e23\\u0e34\\u0e42\\u0e20\\u0e04&#34;,&#34;online_category_l1_en&#34;:&#34;Grocery&#34;,&#34;online_category_l2_th&#34;:&#34;\\u0e0a\\u0e47\\u0e2d\\u0e04\\u0e42\\u0e01\\u0e41\\u0e25\\u0e15&#34;,&#34;online_category_l2_en&#34;:&#34;Chocolate&#34;,&#34;online_category_l3_th&#34;:&#34;none&#34;,&#34;online_category_l3_en&#34;:&#34;none&#34;,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Grocery&#34;,&#34;villa_category_l3_en&#34;:&#34;Candies&#34;,&#34;villa_category_l4_en&#34;:&#34;Confectionery&#34;,&#34;content_en&#34;:&#34;0203915 Meiji Gummy Choco Green Grape 30g&#34;,&#34;content_th&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;hema_brand_th&#34;:&#34;Meiji&#34;,&#34;hema_brand_en&#34;:&#34;Meiji&#34;,&#34;hema_sizedesc&#34;:&#34;30g&#34;,&#34;pr_brand_en&#34;:&#34;MEIJI&#34;,&#34;pr_brand_th&#34;:&#34;MEIJI&#34;,&#34;pr_online_name_en&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;pr_online_name_th&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;hema_name_en&#34;:&#34;Gummy Choco Green Grape&#34;,&#34;hema_name_th&#34;:&#34;Gummy Choco Green Grape&#34;,&#34;pr_name_en&#34;:&#34;MEIJI GUMMY CHOCO GREEN GRAPE 30G&#34;,&#34;pr_name_th&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30 \\u0e01\\u0e23\\u0e31\\u0e21&#34;,&#34;pr_barcode&#34;:null,&#34;pr_barcode2&#34;:null,&#34;sort_weight&#34;:&#34;0.0&#34;}]&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleQueryInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span>
<span class="p">}</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;12345&#39;</span><span class="p">}))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product not found
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>cprcode                                            0171670
iprcode                                            0171670
oprcode                                            0171670
ordertype                                                Y
pr_abb                                JIRAPAT YOUNG KALE 2
pr_active                                                Y
pr_cgcode                                               05
pr_code                                            0171670
pr_dpcode                                               19
pr_engname                        JIRAAT YOUNG KALE 200 G.
pr_ggcode                                              057
pr_market                          JIRAPAT ยอดคะน้า 200 G.
pr_name                            JIRAPAT ยอดคะน้า 200 G.
pr_puqty                                                 1
pr_sa_method                                             1
pr_sucode1                                           CM845
pr_suref3                                                A
prtype                                                   I
psqty                                                    1
pstype                                                   1
pr_country_th                                         none
pr_country_en                                         none
pr_keyword_th                                         none
pr_keyword_en                                         none
pr_filter_th                                          none
pr_filter_en                                          none
online_category_l1_th                                 none
online_category_l1_en                                 none
online_category_l2_th                                 none
online_category_l2_en                                 none
online_category_l3_th                                 none
online_category_l3_en                                 none
villa_category_l1_en                                  none
villa_category_l2_en                                  none
villa_category_l3_en                                  none
villa_category_l4_en                                  none
content_en               0171670 JIRAPAT YOUNG KALE 200 G.
content_th                       JIRAPAT YOUNG KALE 200 G.
hema_brand_th                                         none
hema_brand_en                                         none
hema_sizedesc                                         none
pr_brand_en                                           none
pr_brand_th                                           none
pr_online_name_en                                     none
pr_online_name_th                                     none
hema_name_en                                          none
hema_name_th                                          none
pr_name_en                                            none
pr_name_th                                            none
pr_barcode                                            none
pr_barcode2                                           none
sort_weight                                           none
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaSingleQuery" class="doc_header"><code>lambdaSingleQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L185" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaSingleQuery</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;cprcode&#34;:&#34;0171670&#34;,&#34;iprcode&#34;:&#34;0171670&#34;,&#34;oprcode&#34;:&#34;0171670&#34;,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;JIRAPAT YOUNG KALE 2&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;05&#34;,&#34;pr_code&#34;:&#34;0171670&#34;,&#34;pr_dpcode&#34;:&#34;19&#34;,&#34;pr_engname&#34;:&#34;JIRAAT YOUNG KALE 200 G.&#34;,&#34;pr_ggcode&#34;:&#34;057&#34;,&#34;pr_market&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_name&#34;:&#34;JIRAPAT \\u0e22\\u0e2d\\u0e14\\u0e04\\u0e30\\u0e19\\u0e49\\u0e32 200 G.&#34;,&#34;pr_puqty&#34;:&#34;1&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;CM845&#34;,&#34;pr_suref3&#34;:&#34;A&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;pr_country_th&#34;:&#34;none&#34;,&#34;pr_country_en&#34;:&#34;none&#34;,&#34;pr_keyword_th&#34;:&#34;none&#34;,&#34;pr_keyword_en&#34;:&#34;none&#34;,&#34;pr_filter_th&#34;:&#34;none&#34;,&#34;pr_filter_en&#34;:&#34;none&#34;,&#34;online_category_l1_th&#34;:&#34;none&#34;,&#34;online_category_l1_en&#34;:&#34;none&#34;,&#34;online_category_l2_th&#34;:&#34;none&#34;,&#34;online_category_l2_en&#34;:&#34;none&#34;,&#34;online_category_l3_th&#34;:&#34;none&#34;,&#34;online_category_l3_en&#34;:&#34;none&#34;,&#34;villa_category_l1_en&#34;:&#34;none&#34;,&#34;villa_category_l2_en&#34;:&#34;none&#34;,&#34;villa_category_l3_en&#34;:&#34;none&#34;,&#34;villa_category_l4_en&#34;:&#34;none&#34;,&#34;content_en&#34;:&#34;0171670 JIRAPAT YOUNG KALE 200 G.&#34;,&#34;content_th&#34;:&#34;JIRAPAT YOUNG KALE 200 G.&#34;,&#34;hema_brand_th&#34;:&#34;none&#34;,&#34;hema_brand_en&#34;:&#34;none&#34;,&#34;hema_sizedesc&#34;:&#34;none&#34;,&#34;pr_brand_en&#34;:&#34;none&#34;,&#34;pr_brand_th&#34;:&#34;none&#34;,&#34;pr_online_name_en&#34;:&#34;none&#34;,&#34;pr_online_name_th&#34;:&#34;none&#34;,&#34;hema_name_en&#34;:&#34;none&#34;,&#34;hema_name_th&#34;:&#34;none&#34;,&#34;pr_name_en&#34;:&#34;none&#34;,&#34;pr_name_th&#34;:&#34;none&#34;,&#34;pr_barcode&#34;:&#34;none&#34;,&#34;pr_barcode2&#34;:&#34;none&#34;,&#34;sort_weight&#34;:&#34;none&#34;}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;11234&#39;</span><span class="p">}),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;error&#39;: &#39;product not found&#39;}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AllQuery">AllQuery<a class="anchor-link" href="#AllQuery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">%</span><span class="k">time</span> url = ProductDatabase.allQuery(bucket = INVENTORY_BUCKET_NAME, key=&#39;allData-json.zl&#39;)
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># response = requests.get(url)</span>
<span class="k">def</span> <span class="nf">retrieveJsonZl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">response</span><span class="p">:</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">jsonDb</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">newDb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">jsonDb</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newDb</span>
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 6.34 ms, sys: 0 ns, total: 6.34 ms
Wall time: 5.9 ms
https://product-bucket-dev-manual.s3-accelerate.amazonaws.com/allData-json.zl?AWSAccessKeyId=AKIAVX4Z5TKDSNNNULGB&amp;Signature=4JyjYfvhauM6a7W6xi5JD5ZMGF0%3D&amp;Expires=1609503502
CPU times: user 1.41 s, sys: 248 ms, total: 1.66 s
Wall time: 1.74 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_barcode</th>
      <th>pr_barcode2</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>217153</td>
      <td>217153</td>
      <td>217153</td>
      <td>Y</td>
      <td>COCOA LOCO MILK CHOC</td>
      <td>Y</td>
      <td>98</td>
      <td>217153</td>
      <td>28</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>...</td>
      <td></td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>5060148383378</td>
      <td>506014838337</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>235141</td>
      <td>235141</td>
      <td>235141</td>
      <td>Y</td>
      <td>EEBOO-PZCT3-PUZZLE</td>
      <td>Y</td>
      <td>8</td>
      <td>235141</td>
      <td>19</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>...</td>
      <td></td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO-PZCT3-ตัวต่อนับเลข ANIMAL COUNTING_3ED</td>
      <td>689196509575</td>
      <td>68919650957</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>182223</td>
      <td>182223</td>
      <td>182223</td>
      <td>Y</td>
      <td>CIRIO PIZZASSIMO 400</td>
      <td>Y</td>
      <td>6</td>
      <td>182223</td>
      <td>6</td>
      <td>CIRIO PIZZASSIMO 400G.</td>
      <td>...</td>
      <td>CIRIO</td>
      <td>Cirio Pizzassimo 400g</td>
      <td>Cirio Pizzassimo 400g</td>
      <td>Pizzassimo</td>
      <td>Pizzassimo</td>
      <td>CIRIO PIZZASSIMO 400G.</td>
      <td>CIRIO ซอสทำพิซซ่า 400 G.</td>
      <td>8000320997266</td>
      <td>800032099726</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>124461</td>
      <td>124461</td>
      <td>124461</td>
      <td>Y</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>Y</td>
      <td>2</td>
      <td>124461</td>
      <td>2</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>...</td>
      <td>New Choice</td>
      <td>New Choice Lychee</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>New Choice Lychee</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>8938501660121</td>
      <td>893850166012</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>171670</td>
      <td>171670</td>
      <td>171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>5</td>
      <td>171670</td>
      <td>19</td>
      <td>JIRAPAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 52 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>20238</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>24911</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;cprcode&#39;, &#39;iprcode&#39;, &#39;oprcode&#39;, &#39;ordertype&#39;, &#39;pr_abb&#39;, &#39;pr_active&#39;,
       &#39;pr_cgcode&#39;, &#39;pr_code&#39;, &#39;pr_dpcode&#39;, &#39;pr_engname&#39;, &#39;pr_ggcode&#39;,
       &#39;pr_market&#39;, &#39;pr_name&#39;, &#39;pr_puqty&#39;, &#39;pr_sa_method&#39;, &#39;pr_sucode1&#39;,
       &#39;pr_suref3&#39;, &#39;prtype&#39;, &#39;psqty&#39;, &#39;pstype&#39;, &#39;pr_country_th&#39;,
       &#39;pr_country_en&#39;, &#39;pr_keyword_th&#39;, &#39;pr_keyword_en&#39;, &#39;pr_filter_th&#39;,
       &#39;pr_filter_en&#39;, &#39;online_category_l1_th&#39;, &#39;online_category_l1_en&#39;,
       &#39;online_category_l2_th&#39;, &#39;online_category_l2_en&#39;,
       &#39;online_category_l3_th&#39;, &#39;online_category_l3_en&#39;,
       &#39;villa_category_l1_en&#39;, &#39;villa_category_l2_en&#39;, &#39;villa_category_l3_en&#39;,
       &#39;villa_category_l4_en&#39;, &#39;content_en&#39;, &#39;content_th&#39;, &#39;hema_brand_th&#39;,
       &#39;hema_brand_en&#39;, &#39;hema_sizedesc&#39;, &#39;pr_brand_en&#39;, &#39;pr_brand_th&#39;,
       &#39;pr_online_name_en&#39;, &#39;pr_online_name_th&#39;, &#39;hema_name_en&#39;,
       &#39;hema_name_th&#39;, &#39;pr_name_en&#39;, &#39;pr_name_th&#39;, &#39;pr_barcode&#39;, &#39;pr_barcode2&#39;,
       &#39;sort_weight&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;pr_suref3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>A     30759
C      4463
T      4263
S      2828
D      2557
DS      277
s         2
Name: pr_suref3, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQuery" class="doc_header"><code>lambdaAllQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L194" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQuery</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="o">%</span><span class="k">time</span> url = Response.fromDict(lambdaAllQuery(&#39;&#39;, &#39;&#39;)).body[&#39;url&#39;]
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
CPU times: user 3.22 ms, sys: 3.98 ms, total: 7.2 ms
Wall time: 17.1 ms
CPU times: user 1.87 s, sys: 244 ms, total: 2.12 s
Wall time: 2.26 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(45149, 52)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AllQueryFeather">AllQueryFeather<a class="anchor-link" href="#AllQueryFeather"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQueryFeather" class="doc_header"><code>lambdaAllQueryFeather</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L199" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQueryFeather</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> r = lambdaAllQueryFeather(&#39;&#39;)
<span class="o">%</span><span class="k">time</span> result = Response.fromDict(r).body
<span class="n">url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">time</span> pd.read_feather(url)
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>product-bucket-dev-manual
loading hashkey allData-hash
using url
presign success
loaded hash is e706d6d6b6a9a7e831045ed1e859e7fb24bd5e4b
CPU times: user 34 ms, sys: 0 ns, total: 34 ms
Wall time: 76.3 ms
CPU times: user 19 µs, sys: 0 ns, total: 19 µs
Wall time: 22.9 µs
CPU times: user 300 ms, sys: 73.2 ms, total: 373 ms
Wall time: 817 ms
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>pr_barcode</th>
      <th>pr_barcode2</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0217153</td>
      <td>0217153</td>
      <td>0217153</td>
      <td>Y</td>
      <td>COCOA LOCO MILK CHOC</td>
      <td>Y</td>
      <td>98</td>
      <td>0217153</td>
      <td>28</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>...</td>
      <td></td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.</td>
      <td>5060148383378</td>
      <td>506014838337</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0235141</td>
      <td>0235141</td>
      <td>0235141</td>
      <td>Y</td>
      <td>EEBOO-PZCT3-PUZZLE</td>
      <td>Y</td>
      <td>08</td>
      <td>0235141</td>
      <td>19</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>...</td>
      <td></td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO,ANIMAL COUNTING PUZZLE_3ED,PZCT3</td>
      <td>EEBOO-PZCT3-ตัวต่อนับเลข ANIMAL COUNTING_3ED</td>
      <td>689196509575</td>
      <td>68919650957</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0182223</td>
      <td>0182223</td>
      <td>0182223</td>
      <td>Y</td>
      <td>CIRIO PIZZASSIMO 400</td>
      <td>Y</td>
      <td>06</td>
      <td>0182223</td>
      <td>06</td>
      <td>CIRIO PIZZASSIMO 400G.</td>
      <td>...</td>
      <td>CIRIO</td>
      <td>Cirio Pizzassimo 400g</td>
      <td>Cirio Pizzassimo 400g</td>
      <td>Pizzassimo</td>
      <td>Pizzassimo</td>
      <td>CIRIO PIZZASSIMO 400G.</td>
      <td>CIRIO ซอสทำพิซซ่า 400 G.</td>
      <td>8000320997266</td>
      <td>800032099726</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0124461</td>
      <td>0124461</td>
      <td>0124461</td>
      <td>Y</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>Y</td>
      <td>02</td>
      <td>0124461</td>
      <td>02</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>...</td>
      <td>New Choice</td>
      <td>New Choice Lychee</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>New Choice Lychee</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>NEW CHOICE LYCHEE</td>
      <td>NEW CHOICE กลิ่นลิ้นจี่</td>
      <td>8938501660121</td>
      <td>893850166012</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0171670</td>
      <td>0171670</td>
      <td>0171670</td>
      <td>Y</td>
      <td>JIRAPAT YOUNG KALE 2</td>
      <td>Y</td>
      <td>05</td>
      <td>0171670</td>
      <td>19</td>
      <td>JIRAPAT YOUNG KALE 200 G.</td>
      <td>...</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>45144</th>
      <td>0226783</td>
      <td>0226783</td>
      <td>0226783</td>
      <td>Y</td>
      <td>BETAGRO เป็ดย่างครึ่</td>
      <td>Y</td>
      <td>74</td>
      <td>0226783</td>
      <td>19</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>...</td>
      <td></td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>BETAGRO เป็ดย่างครึ่งตัว</td>
      <td>2269245</td>
      <td>226924</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45145</th>
      <td>0236832</td>
      <td>0236832</td>
      <td>0236832</td>
      <td>Y</td>
      <td>หน้ากากอนามัย3ชั้น ช</td>
      <td>Y</td>
      <td>06</td>
      <td>0236832</td>
      <td>09</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>...</td>
      <td></td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู</td>
      <td>หน้ากากอนามัย3ชั้น ชนิดกระดาษแบบคล้องหู P.3</td>
      <td>8857121193256</td>
      <td>885712119325</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45146</th>
      <td>0225419</td>
      <td>0225419</td>
      <td>0225419</td>
      <td>Y</td>
      <td>DKFF BEETROOT</td>
      <td>Y</td>
      <td>05</td>
      <td>0225419</td>
      <td>19</td>
      <td>DKFF BEETROOT</td>
      <td>...</td>
      <td></td>
      <td>DKFF BEETROOT</td>
      <td>DKFF BEETROOT</td>
      <td>DKFF BEETROOT</td>
      <td>DKFF BEETROOT</td>
      <td>DKFF BEETROOT</td>
      <td>DKFF บีทรูท</td>
      <td>2264772</td>
      <td>226477</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45147</th>
      <td>0217647</td>
      <td>0217647</td>
      <td>0217647</td>
      <td>Y</td>
      <td>GRAPE GREEN SHINE MU</td>
      <td>Y</td>
      <td>02</td>
      <td>0217647</td>
      <td>19</td>
      <td>GRAPE GREEN SHINE MUSCUT</td>
      <td>...</td>
      <td></td>
      <td>GRAPE GREEN SHINE MUSCUT</td>
      <td>องุ่นเขียว ซัยน์มัสคัท 900G</td>
      <td>GRAPE GREEN SHINE MUSCUT</td>
      <td>องุ่นเขียว ซัยน์มัสคัท 900G</td>
      <td>GRAPE GREEN SHINE MUSCUT</td>
      <td>องุ่นเขียว ซัยน์มัสคัท 900G</td>
      <td>2247207</td>
      <td>224720</td>
      <td>0</td>
    </tr>
    <tr>
      <th>45148</th>
      <td>0236616</td>
      <td>0236616</td>
      <td>0236616</td>
      <td>Y</td>
      <td>GREEN THUMB581445</td>
      <td>Y</td>
      <td>08</td>
      <td>0236616</td>
      <td>19</td>
      <td>GREEN THUMB581445</td>
      <td>...</td>
      <td></td>
      <td>GREEN THUMB581445</td>
      <td>GREEN THUMB581445</td>
      <td>GREEN THUMB581445</td>
      <td>GREEN THUMB581445</td>
      <td>GREEN THUMB581445</td>
      <td>GREEN THUMB-ข้อต่อ 581445</td>
      <td>052088047088</td>
      <td>05208804708</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>45149 rows × 52 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">pdUtils</span><span class="o">.</span><span class="n">getDfHash</span><span class="p">(</span><span class="n">database</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;database and hash are not the same&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-s3,-checking-scan-time">Update s3, checking scan time<a class="anchor-link" href="#Update-s3,-checking-scan-time"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;checking scan time&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>checking scan time
CPU times: user 16.1 s, sys: 1.01 s, total: 17.1 s
Wall time: 30.5 s
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>106219</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

