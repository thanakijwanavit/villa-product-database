---

title: Database Class


keywords: fastai
sidebar: home_sidebar

summary: "API details."
description: "API details."
nb_path: "database.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: database.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>missing environment variable &#39;INVENTORY_BUCKET_NAME&#39; in query NB
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
dax endpoint missing &#39;DAX_ENDPOINT&#39;
dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>dax endpoint missing &#39;DAX_ENDPOINT&#39;
None
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Main-Database-Class">Main Database Class<a class="anchor-link" href="#Main-Database-Class"> </a></h1>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductDatabase" class="doc_header"><code>class</code> <code>ProductDatabase</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductDatabase</code>(<strong><code>hash_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>range_key</code></strong>:<code>Optional</code>[<code>Any</code>]=<em><code>None</code></em>, <strong><code>_user_instantiated</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong>**<code>attributes</code></strong>:<code>Any</code>) :: <a href="/villaProductDatabase/query.html#Querier"><code>Querier</code></a></p>
</blockquote>
<p>Defines a <code>PynamoDB</code> Model</p>
<p>This model is backed by a table in DynamoDB.
You can create the table by with the <code>create_table</code> method.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Update-with-dictionary">Update with dictionary<a class="anchor-link" href="#Update-with-dictionary"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1">## get original item</span>
<span class="n">item</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="mi">9</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;engname is </span><span class="si">{</span><span class="n">item</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1">### update item</span>
<span class="n">updatedItem</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateWithDict</span><span class="p">(</span><span class="n">item</span><span class="p">,{</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span><span class="s1">&#39;testName&#39;</span><span class="p">})</span>
<span class="k">assert</span> <span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pr_engname&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;testName&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; name is changed to  </span><span class="si">{</span><span class="n">updatedItem</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pr_engname&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>engname is JOHNNIE WALKER RED 70 CL.
 name is changed to  testName
CPU times: user 0 ns, sys: 3.61 ms, total: 3.61 ms
Wall time: 6.57 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Batch-load-and-save-data">Batch load and save data<a class="anchor-link" href="#Batch-load-and-save-data"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">,</span> <span class="s1">&#39;loadFrom cache not working&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is be55bb1dccdf79efbf5b20255abf91b0cdf154c3
data is still in sync, using local cache
CPU times: user 314 ms, sys: 91.5 ms, total: 405 ms
Wall time: 593 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Dump-database-to-s3">Dump database to s3<a class="anchor-link" href="#Dump-database-to-s3"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ProductDatabase.resetS3Cache()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cacheDb" class="doc_header"><code>cacheDb</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L104" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cacheDb</code>(<strong><code>bucketName</code></strong>=<em><code>None</code></em>, <strong><code>key</code></strong>=<em><code>'allData'</code></em>, <strong><code>limit</code></strong>=<em><code>100</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>cache db to s3 and local efs</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># originalDb = ProductDatabase.loadFromCache()</span>
<span class="c1"># listPd = list(product.needsUpdateIndex.query(&#39;Y&#39;, limit=5))</span>
<span class="c1"># changesDf = ProductDatabase.toDf(listPd)</span>
<span class="c1"># changesDf.set_index(&#39;cprcode&#39;, inplace=True)</span>
<span class="c1"># originalDb.set_index(&#39;cprcode&#39;,inplace=True)</span>
<span class="c1"># newDf = originalDb.append(changesDf)</span>
<span class="c1"># newDf.reset_index(inplace=True)</span>
<span class="c1"># originalDb</span>

<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is be55bb1dccdf79efbf5b20255abf91b0cdf154c3
data is still in sync, using local cache
quering for changes
convert to df
(100, 49)
hashKey is allData-hash
saving hash to s3
saved hash 1515594397ef54de982d91763edb374f035cfca0
saving to remote cache
CPU times: user 5 s, sys: 493 ms, total: 5.49 s
Wall time: 7.55 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>hema_sizedesc</th>
      <th>pr_brand_en</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>Y</td>
      <td>87</td>
      <td>225407</td>
      <td>21.0</td>
      <td>KONJAC LINGUINI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>Y</td>
      <td>06</td>
      <td>0241101</td>
      <td>8.0</td>
      <td>BUMILGOCHUJANG</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>BUMILGOCHUJANG</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>บูมิลโคชูจังซอสเผ้ดเกาหลี</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>Y</td>
      <td>5</td>
      <td>190100</td>
      <td>19.0</td>
      <td>WHITE SHIMEJI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>WHITE SHIMEJI</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>Y</td>
      <td>7</td>
      <td>62644</td>
      <td>8.0</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>...</td>
      <td>430g</td>
      <td>STUTE</td>
      <td>STUTE</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Apricot Jam</td>
      <td>Apricot Jam</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>Y</td>
      <td>10</td>
      <td>192167</td>
      <td>9.0</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>...</td>
      <td>150g</td>
      <td>COLGATE</td>
      <td>COLGATE</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Total Charcoal Deep Clean</td>
      <td>Total Charcoal Deep Clean</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>COGATE ยสฟ.โททอลชาร์โคลดีพคลีน 150กรัม</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43798.0</th>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>Y</td>
      <td>CRANBERRY CIABATTA 8</td>
      <td>Y</td>
      <td>15</td>
      <td>0236128</td>
      <td>19.0</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>แครนเบอร์รี่เชียบัตต้า 85G</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43799.0</th>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>Y</td>
      <td>Nature’s Best</td>
      <td>Y</td>
      <td>06</td>
      <td>0240795</td>
      <td>2.0</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>เนเจอร์ส เบสท์ เมล็ดเกาลัดคั่วพร้อมเปลือก</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43800.0</th>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>Y</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>Y</td>
      <td>15</td>
      <td>178950</td>
      <td>19.0</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>ทิพย์เบเกอรี่ 25 ฿</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43801.0</th>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>Y</td>
      <td>HUGOS CHOCOLATE ROAS</td>
      <td>Y</td>
      <td>04</td>
      <td>0238167</td>
      <td>2.0</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS ช็อกโกแลตเคลือบเมล็ดอัลมอนด์ 1121 120G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>233164.0</th>
      <td>NaN</td>
      <td>233164.0</td>
      <td>233164.0</td>
      <td>Y</td>
      <td>CL 119905 VOLUME DRY</td>
      <td>Y</td>
      <td>58</td>
      <td>0233164</td>
      <td>19.0</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>CL 119905 VOLUME DRY SHAMPOO 200 ML</td>
      <td>CL 119905 วอลุ่ม ดรายแชมพู 200 มล</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>43803 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@add_class_method</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">dumpToS3</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">bucketName</span><span class="o">=</span> <span class="n">INVENTORY_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;allData&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
  <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cacheDb</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">dumpToS3</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 1515594397ef54de982d91763edb374f035cfca0
data is still in sync, using local cache
quering for changes
convert to df
(1000, 49)
hashKey is allData-hash
saving hash to s3
saved hash 8f9240e80783f1ada52376d3afde843ae02dbf1a
saving to remote cache
CPU times: user 20.5 s, sys: 536 ms, total: 21 s
Wall time: 23.7 s
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>hema_sizedesc</th>
      <th>pr_brand_en</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>Y</td>
      <td>87</td>
      <td>225407</td>
      <td>21.0</td>
      <td>KONJAC LINGUINI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>Y</td>
      <td>06</td>
      <td>0241101</td>
      <td>8.0</td>
      <td>BUMILGOCHUJANG</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>BUMILGOCHUJANG</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>บูมิลโคชูจังซอสเผ้ดเกาหลี</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>Y</td>
      <td>5</td>
      <td>190100</td>
      <td>19.0</td>
      <td>WHITE SHIMEJI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>WHITE SHIMEJI</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>Y</td>
      <td>7</td>
      <td>62644</td>
      <td>8.0</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>...</td>
      <td>430g</td>
      <td>STUTE</td>
      <td>STUTE</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Apricot Jam</td>
      <td>Apricot Jam</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4.0</th>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>Y</td>
      <td>10</td>
      <td>192167</td>
      <td>9.0</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>...</td>
      <td>150g</td>
      <td>COLGATE</td>
      <td>COLGATE</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Total Charcoal Deep Clean</td>
      <td>Total Charcoal Deep Clean</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>COGATE ยสฟ.โททอลชาร์โคลดีพคลีน 150กรัม</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43798.0</th>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>Y</td>
      <td>CRANBERRY CIABATTA 8</td>
      <td>Y</td>
      <td>15</td>
      <td>0236128</td>
      <td>19.0</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>แครนเบอร์รี่เชียบัตต้า 85G</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43799.0</th>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>Y</td>
      <td>Nature’s Best</td>
      <td>Y</td>
      <td>06</td>
      <td>0240795</td>
      <td>2.0</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>เนเจอร์ส เบสท์ เมล็ดเกาลัดคั่วพร้อมเปลือก</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43800.0</th>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>Y</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>Y</td>
      <td>15</td>
      <td>178950</td>
      <td>19.0</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>ทิพย์เบเกอรี่ 25 ฿</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43801.0</th>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>Y</td>
      <td>HUGOS CHOCOLATE ROAS</td>
      <td>Y</td>
      <td>04</td>
      <td>0238167</td>
      <td>2.0</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS ช็อกโกแลตเคลือบเมล็ดอัลมอนด์ 1121 120G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>167814.0</th>
      <td>NaN</td>
      <td>167814.0</td>
      <td>167814.0</td>
      <td>Y</td>
      <td>KRAFT MINI FUN MARSH</td>
      <td>Y</td>
      <td>82</td>
      <td>167814</td>
      <td>28.0</td>
      <td>KRAFT MINI FUN MARSHMALLOWS 283.5G</td>
      <td>...</td>
      <td>283g</td>
      <td>KRAFT</td>
      <td>KRAFT</td>
      <td>Kraft Mini Fun Marshmallows  283g</td>
      <td>Kraft Mini Fun Marshmallows  283g</td>
      <td>Mini Fun Marshmallows</td>
      <td>Mini Fun Marshmallows</td>
      <td>KRAFT MINI FUN MARSHMALLOWS 283.5G</td>
      <td>KRAFT MINI FUN MARSHMALLOWS 283.5G</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>43803 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaDumpToS3" class="doc_header"><code>lambdaDumpToS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L129" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaDumpToS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">fromDict</span><span class="p">(</span><span class="n">lambdaDumpToS3</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">body</span><span class="p">[</span><span class="s1">&#39;result&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is 8f9240e80783f1ada52376d3afde843ae02dbf1a
data is still in sync, using local cache
quering for changes
convert to df
(500, 49)
hashKey is allData-hash
saving hash to s3
saved hash c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
saving to remote cache
{&#39;cprcode&#39;: 225407.0, &#39;iprcode&#39;: 225407.0, &#39;oprcode&#39;: 225407.0, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;MOKU&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;87&#39;, &#39;pr_code&#39;: &#39;225407&#39;, &#39;pr_dpcode&#39;: &#39;21.0&#39;, &#39;pr_engname&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_ggcode&#39;: &#39;10&#39;, &#39;pr_market&#39;: &#39;MOKU&#39;, &#39;pr_name&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;pr_puqty&#39;: &#39;1.0&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;F1148&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1.0&#39;, &#39;pstype&#39;: &#39;1.0&#39;, &#39;pr_country_th&#39;: &#39;none&#39;, &#39;pr_country_en&#39;: &#39;Thailand&#39;, &#39;pr_keyword_th&#39;: &#39;none&#39;, &#39;pr_keyword_en&#39;: &#39;none&#39;, &#39;pr_filter_th&#39;: &#39;none&#39;, &#39;pr_filter_en&#39;: &#39;none&#39;, &#39;online_category_l1_th&#39;: &#39;อาหารสำเร็จรูปและไข่&#39;, &#39;online_category_l1_en&#39;: &#39;Delicatessen &amp; Eggs&#39;, &#39;online_category_l2_th&#39;: &#39;อาหารพร้อมทาน&#39;, &#39;online_category_l2_en&#39;: &#39;Ready Meals&#39;, &#39;online_category_l3_th&#39;: &#39;none&#39;, &#39;online_category_l3_en&#39;: &#39;none&#39;, &#39;villa_category_l1_en&#39;: &#39;Fresh&#39;, &#39;villa_category_l2_en&#39;: &#39;Delicatessen&#39;, &#39;villa_category_l3_en&#39;: &#39;Local&#39;, &#39;villa_category_l4_en&#39;: &#39;Local Foods&#39;, &#39;content_en&#39;: &#39;0225407 KONJAC LINGUINI&#39;, &#39;content_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;hema_brand_th&#39;: &#39;none&#39;, &#39;hema_brand_en&#39;: &#39;none&#39;, &#39;hema_sizedesc&#39;: &#39;none&#39;, &#39;pr_brand_en&#39;: &#39;none&#39;, &#39;pr_brand_th&#39;: &#39;none&#39;, &#39;pr_online_name_en&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_online_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;hema_name_en&#39;: &#39;KONJAC LINGUINI&#39;, &#39;hema_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;pr_name_en&#39;: &#39;KONJAC LINGUINI&#39;, &#39;pr_name_th&#39;: &#39;บุกเส้นแบน ตราโมกุ&#39;, &#39;sort_weight&#39;: &#39;0.0&#39;}
CPU times: user 11.8 s, sys: 537 ms, total: 12.4 s
Wall time: 14.5 s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">loadFromCache</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cprcode</th>
      <th>iprcode</th>
      <th>oprcode</th>
      <th>ordertype</th>
      <th>pr_abb</th>
      <th>pr_active</th>
      <th>pr_cgcode</th>
      <th>pr_code</th>
      <th>pr_dpcode</th>
      <th>pr_engname</th>
      <th>...</th>
      <th>hema_sizedesc</th>
      <th>pr_brand_en</th>
      <th>pr_brand_th</th>
      <th>pr_online_name_en</th>
      <th>pr_online_name_th</th>
      <th>hema_name_en</th>
      <th>hema_name_th</th>
      <th>pr_name_en</th>
      <th>pr_name_th</th>
      <th>sort_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>225407.0</td>
      <td>Y</td>
      <td>MOKU</td>
      <td>Y</td>
      <td>87</td>
      <td>225407</td>
      <td>21.0</td>
      <td>KONJAC LINGUINI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>KONJAC LINGUINI</td>
      <td>บุกเส้นแบน ตราโมกุ</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>241101.0</td>
      <td>Y</td>
      <td>BUMILGOCHUJANG</td>
      <td>Y</td>
      <td>06</td>
      <td>0241101</td>
      <td>8.0</td>
      <td>BUMILGOCHUJANG</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>BUMILGOCHUJANG</td>
      <td>none</td>
      <td>none</td>
      <td>BUMILGOCHUJANG</td>
      <td>บูมิลโคชูจังซอสเผ้ดเกาหลี</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>190100.0</td>
      <td>Y</td>
      <td>WHITE SHIMEJI</td>
      <td>Y</td>
      <td>5</td>
      <td>190100</td>
      <td>19.0</td>
      <td>WHITE SHIMEJI</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>White Shimeji</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>WHITE SHIMEJI</td>
      <td>QUALITY VEGETABLE เห็ดชิเมจิขาว</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>62644.0</td>
      <td>Y</td>
      <td>STUTE APRICOT JAM430</td>
      <td>Y</td>
      <td>7</td>
      <td>62644</td>
      <td>8.0</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>...</td>
      <td>430g</td>
      <td>STUTE</td>
      <td>STUTE</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Stute Apricot Jam 430g</td>
      <td>Apricot Jam</td>
      <td>Apricot Jam</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>STUTE APRICOT JAM 430 G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>192167.0</td>
      <td>Y</td>
      <td>**COLGATE TOTAL CHAR</td>
      <td>Y</td>
      <td>10</td>
      <td>192167</td>
      <td>9.0</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>...</td>
      <td>150g</td>
      <td>COLGATE</td>
      <td>COLGATE</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Colgate Total Charcoal Deep Clean  150g</td>
      <td>Total Charcoal Deep Clean</td>
      <td>Total Charcoal Deep Clean</td>
      <td>**COLGATE TOTAL CHARCOAL DEEP CLEAN 150G</td>
      <td>COGATE ยสฟ.โททอลชาร์โคลดีพคลีน 150กรัม</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>43798</th>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>236128.0</td>
      <td>Y</td>
      <td>CRANBERRY CIABATTA 8</td>
      <td>Y</td>
      <td>15</td>
      <td>0236128</td>
      <td>19.0</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>CRANBERRY CIABATTA 85G</td>
      <td>แครนเบอร์รี่เชียบัตต้า 85G</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43799</th>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>240795.0</td>
      <td>Y</td>
      <td>Nature’s Best</td>
      <td>Y</td>
      <td>06</td>
      <td>0240795</td>
      <td>2.0</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>none</td>
      <td>none</td>
      <td>NATURE’S BEST CHESTNUTS WITH SHELL</td>
      <td>เนเจอร์ส เบสท์ เมล็ดเกาลัดคั่วพร้อมเปลือก</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43800</th>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>178950.0</td>
      <td>Y</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>Y</td>
      <td>15</td>
      <td>178950</td>
      <td>19.0</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>TIPBAKERY 25 ฿</td>
      <td>ทิพย์เบเกอรี่ 25 ฿</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43801</th>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>238167.0</td>
      <td>Y</td>
      <td>HUGOS CHOCOLATE ROAS</td>
      <td>Y</td>
      <td>04</td>
      <td>0238167</td>
      <td>2.0</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS CHOCOLATE ROASTED ALMONDS 120G.</td>
      <td>HUGOS ช็อกโกแลตเคลือบเมล็ดอัลมอนด์ 1121 120G.</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>43802</th>
      <td>NaN</td>
      <td>214323.0</td>
      <td>214323.0</td>
      <td>Y</td>
      <td>DOVE SAKURA BLOSSOM</td>
      <td>Y</td>
      <td>3</td>
      <td>214323</td>
      <td>9.0</td>
      <td>DOVE SAKURA BLOSSOM PUMP 12X720G</td>
      <td>...</td>
      <td>none</td>
      <td>none</td>
      <td>none</td>
      <td>Dove Sakura Blossom Pump 12 X 720g</td>
      <td>โดฟสบู่เหลว ซากุระบลอสซั่ม 12X720ก.</td>
      <td>Dove Sakura Blossom Pump 12 X 720g</td>
      <td>โดฟสบู่เหลว ซากุระบลอสซั่ม 12X720ก.</td>
      <td>DOVE SAKURA BLOSSOM PUMP 12X720G</td>
      <td>โดฟสบู่เหลว ซากุระบลอสซั่ม 12X720ก.</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>43803 rows × 50 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-Standard-(instant-save)">Save using Standard (instant save)<a class="anchor-link" href="#Save-using-Standard-(instant-save)"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Product" class="doc_header"><code>class</code> <code>Product</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L136" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Product</code>(<strong><code>iprcode</code></strong>:<code>int</code>, <strong><code>cprcode</code></strong>:<code>int</code>, <strong><code>data</code></strong>:<code>Optional</code>[<code>CatchAllVar</code>])</p>
</blockquote>
<p>Product(iprcode: int, cprcode: int, data: Union[~CatchAllVar, NoneType])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ValueUpdate" class="doc_header"><code>class</code> <code>ValueUpdate</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L142" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ValueUpdate</code>(<strong><code>items</code></strong>:<code>List</code>[<a href="/villaProductDatabase/database.html#Product"><code>Product</code></a>])</p>
</blockquote>
<p>ValueUpdate(items: List[villaProductDatabase.database.Product])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="chunks" class="doc_header"><code>chunks</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L146" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>chunks</code>(<strong><code>l</code></strong>, <strong><code>n</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunks</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)),</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[[0, 1, 2, 3, 4, 5, 6, 7, 8, 9],
 [10, 11, 12, 13, 14, 15, 16, 17, 18, 19],
 [20, 21, 22, 23, 24, 25, 26, 27, 28, 29],
 [30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
 [40, 41, 42, 43, 44, 45, 46, 47, 48, 49],
 [50, 51, 52, 53, 54, 55, 56, 57, 58, 59],
 [60, 61, 62, 63, 64, 65, 66, 67, 68, 69],
 [70, 71, 72, 73, 74, 75, 76, 77, 78, 79],
 [80, 81, 82, 83, 84, 85, 86, 87, 88, 89],
 [90, 91, 92, 93, 94, 95, 96, 97, 98, 99]]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleProducts</span> <span class="o">=</span> <span class="p">[{</span> <span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;oprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;ordertype&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_abb&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT YOUNG KALE 2&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_active&#39;</span><span class="p">:</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_cgcode&#39;</span><span class="p">:</span> <span class="s1">&#39;05&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_code&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_dpcode&#39;</span><span class="p">:</span> <span class="s1">&#39;19&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_engname&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAAT YOUNG KALE 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_ggcode&#39;</span><span class="p">:</span> <span class="s1">&#39;057&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_market&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_name&#39;</span><span class="p">:</span> <span class="s1">&#39;JIRAPAT ยอดคะน้า 200 G.&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_puqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sa_method&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_sucode1&#39;</span><span class="p">:</span> <span class="s1">&#39;CM845&#39;</span><span class="p">,</span> <span class="s1">&#39;pr_suref3&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;prtype&#39;</span><span class="p">:</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;psqty&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;pstype&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">}]</span> <span class="c1">#ProductDatabase.valueUpdate({&#39;items&#39;:sampleProducts})</span>
<span class="n">ProductDatabase</span><span class="o">.</span><span class="n">valueUpdate2</span><span class="p">({</span><span class="s1">&#39;items&#39;</span><span class="p">:</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">convertIntCols</span><span class="p">(</span><span class="n">sampleProducts</span><span class="p">)})</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.38146 ms
divided into chunks -0.382286 ms
loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
get all from s3 -1.091853 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;success&#39;: 1,
 &#39;failure&#39;: 0,
 &#39;skipped&#39;: 0,
 &#39;failureMessage&#39;: [],
 &#39;timetaken(ms)&#39;: 1163.942}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateProduct" class="doc_header"><code>lambdaUpdateProduct</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L149" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateProduct</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;products&#39;</span><span class="p">:</span><span class="n">sampleProducts</span><span class="p">})</span>
<span class="n">lambdaUpdateProduct</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.020947 ms
divided into chunks -0.021035 ms
loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
get all from s3 -0.531852 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:1,&#34;failure&#34;:0,&#34;skipped&#34;:0,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:598.636}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Save-using-s3">Save using s3<a class="anchor-link" href="#Save-using-s3"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="update-using-s3-link">update using s3 link<a class="anchor-link" href="#update-using-s3-link"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="updateS3Input" class="doc_header"><code>updateS3Input</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L156" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>updateS3Input</code>(<strong><code>inputBucketName</code></strong>:<code>str</code>=<em><code>None</code></em>, <strong><code>key</code></strong>:<code>str</code>=<em><code>''</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span>
                     <span class="n">accelerate</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;test input data saved to s3&#39;</span><span class="p">)</span>
<span class="n">updateResult</span> <span class="o">=</span> <span class="n">ProductDatabase</span><span class="o">.</span><span class="n">updateS3Input</span><span class="p">(</span> <span class="n">inputBucketName</span><span class="o">=</span><span class="n">INPUT_BUCKET_NAME</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span> <span class="n">inputKeyName</span><span class="p">)</span>

<span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;s3 save result is </span><span class="si">{</span><span class="n">saveResult</span><span class="si">}</span><span class="s1"> update result is </span><span class="si">{</span><span class="n">updateResult</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.024872 ms
divided into chunks -0.024968 ms
loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
get all from s3 -0.819929 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaUpdateS3" class="doc_header"><code>lambdaUpdateS3</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L164" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaUpdateS3</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">inputKeyName</span> <span class="o">=</span> <span class="s1">&#39;input-data-name&#39;</span>
<span class="n">saveResult</span> <span class="o">=</span> <span class="n">S3</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">inputKeyName</span><span class="p">,</span> 
                     <span class="n">objectToSave</span> <span class="o">=</span> <span class="n">sampleProducts</span> <span class="p">,</span> 
                     <span class="n">bucket</span> <span class="o">=</span> <span class="n">INPUT_BUCKET_NAME</span><span class="p">)</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="n">inputKeyName</span><span class="p">})</span>
<span class="n">lambdaUpdateS3</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>products are [{&#39;cprcode&#39;: 171670, &#39;iprcode&#39;: 171670, &#39;oprcode&#39;: 171670, &#39;ordertype&#39;: &#39;Y&#39;, &#39;pr_abb&#39;: &#39;JIRAPAT YOUNG KALE 2&#39;, &#39;pr_active&#39;: &#39;Y&#39;, &#39;pr_cgcode&#39;: &#39;05&#39;, &#39;pr_code&#39;: &#39;0171670&#39;, &#39;pr_dpcode&#39;: &#39;19&#39;, &#39;pr_engname&#39;: &#39;JIRAAT YOUNG KALE 200 G.&#39;, &#39;pr_ggcode&#39;: &#39;057&#39;, &#39;pr_market&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_name&#39;: &#39;JIRAPAT ยอดคะน้า 200 G.&#39;, &#39;pr_puqty&#39;: &#39;1&#39;, &#39;pr_sa_method&#39;: &#39;1&#39;, &#39;pr_sucode1&#39;: &#39;CM845&#39;, &#39;pr_suref3&#39;: &#39;A&#39;, &#39;prtype&#39;: &#39;I&#39;, &#39;psqty&#39;: &#39;1&#39;, &#39;pstype&#39;: &#39;1&#39;}]
time taken for validation  -0.021385 ms
divided into chunks -0.021568 ms
loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
get all from s3 -0.575215 ms
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;{&#34;success&#34;:1,&#34;failure&#34;:0,&#34;skipped&#34;:0,&#34;failureMessage&#34;:[],&#34;timetaken(ms)&#34;:642.068}&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Query-test">Query test<a class="anchor-link" href="#Query-test"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Product-Query">Product Query<a class="anchor-link" href="#Product-Query"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProductsFromList" class="doc_header"><code>class</code> <code>ProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L181" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProductsFromList</code>(<strong><code>iprcodes</code></strong>:<code>List</code>[<code>str</code>])</p>
</blockquote>
<p>ProductsFromList(iprcodes: List[str])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaProductsFromList" class="doc_header"><code>lambdaProductsFromList</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L185" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaProductsFromList</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;0217153&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0000009&#39;</span><span class="p">]})</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;result length is not 3 </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">,</span> <span class="s1">&#39;result type is not dict&#39;</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
db shape is (43803, 50)
CPU times: user 287 ms, sys: 56.9 ms, total: 344 ms
Wall time: 465 ms
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcodes&#39;</span><span class="p">:[</span><span class="s1">&#39;0000009&#39;</span><span class="p">,</span><span class="s1">&#39;203915&#39;</span><span class="p">,</span><span class="s1">&#39;0217153&#39;</span><span class="p">]})</span>
<span class="n">lambdaProductsFromList</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>loading hashkey allData-hash
loaded hash is c9ffa27c2e8e501717abcd9c58f2d5fb902d847d
data is still in sync, using local cache
db shape is (43803, 50)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;body&#39;: &#39;[{&#34;cprcode&#34;:203915.0,&#34;iprcode&#34;:203915.0,&#34;oprcode&#34;:203915.0,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;MEIJI GUMMY CHOCO GR&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;4&#34;,&#34;pr_code&#34;:&#34;203915&#34;,&#34;pr_dpcode&#34;:&#34;2.0&#34;,&#34;pr_engname&#34;:&#34;MEIJI GUMMY CHOCO GREEN GRAPE 30G&#34;,&#34;pr_ggcode&#34;:&#34;2&#34;,&#34;pr_market&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30&#34;,&#34;pr_name&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30 \\u0e01\\u0e23\\u0e31\\u0e21&#34;,&#34;pr_puqty&#34;:&#34;20.0&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;2943&#34;,&#34;pr_suref3&#34;:&#34;C&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1.0&#34;,&#34;pstype&#34;:&#34;1.0&#34;,&#34;pr_country_th&#34;:&#34;none&#34;,&#34;pr_country_en&#34;:&#34;China&#34;,&#34;pr_keyword_th&#34;:&#34;none&#34;,&#34;pr_keyword_en&#34;:&#34;none&#34;,&#34;pr_filter_th&#34;:&#34;Grocery,Chocolate&#34;,&#34;pr_filter_en&#34;:&#34;Grocery,Chocolate&#34;,&#34;online_category_l1_th&#34;:&#34;\\u0e2a\\u0e34\\u0e19\\u0e04\\u0e49\\u0e32\\u0e1a\\u0e23\\u0e34\\u0e42\\u0e20\\u0e04&#34;,&#34;online_category_l1_en&#34;:&#34;Grocery&#34;,&#34;online_category_l2_th&#34;:&#34;\\u0e0a\\u0e47\\u0e2d\\u0e04\\u0e42\\u0e01\\u0e41\\u0e25\\u0e15&#34;,&#34;online_category_l2_en&#34;:&#34;Chocolate&#34;,&#34;online_category_l3_th&#34;:&#34;none&#34;,&#34;online_category_l3_en&#34;:&#34;none&#34;,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Grocery&#34;,&#34;villa_category_l3_en&#34;:&#34;Candies&#34;,&#34;villa_category_l4_en&#34;:&#34;Confectionery&#34;,&#34;content_en&#34;:&#34;0203915 Meiji Gummy Choco Green Grape 30g&#34;,&#34;content_th&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;hema_brand_th&#34;:&#34;Meiji&#34;,&#34;hema_brand_en&#34;:&#34;Meiji&#34;,&#34;hema_sizedesc&#34;:&#34;30g&#34;,&#34;pr_brand_en&#34;:&#34;MEIJI&#34;,&#34;pr_brand_th&#34;:&#34;MEIJI&#34;,&#34;pr_online_name_en&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;pr_online_name_th&#34;:&#34;Meiji Gummy Choco Green Grape 30g&#34;,&#34;hema_name_en&#34;:&#34;Gummy Choco Green Grape&#34;,&#34;hema_name_th&#34;:&#34;Gummy Choco Green Grape&#34;,&#34;pr_name_en&#34;:&#34;MEIJI GUMMY CHOCO GREEN GRAPE 30G&#34;,&#34;pr_name_th&#34;:&#34;\\u0e40\\u0e21\\u0e08\\u0e34 \\u0e01\\u0e31\\u0e21\\u0e21\\u0e35\\u0e48 \\u0e0a\\u0e47\\u0e2d\\u0e01\\u0e42\\u0e01 \\u0e01\\u0e23\\u0e35\\u0e19\\u0e40\\u0e01\\u0e23\\u0e1b 30 \\u0e01\\u0e23\\u0e31\\u0e21&#34;,&#34;sort_weight&#34;:&#34;0.0&#34;},{&#34;cprcode&#34;:217153.0,&#34;iprcode&#34;:217153.0,&#34;oprcode&#34;:217153.0,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;COCOA LOCO MILK CHOC&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;98&#34;,&#34;pr_code&#34;:&#34;0217153&#34;,&#34;pr_dpcode&#34;:&#34;28&#34;,&#34;pr_engname&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_ggcode&#34;:&#34;003&#34;,&#34;pr_market&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL&#34;,&#34;pr_name&#34;:&#34;COCOA LOCO MILK CHOCOLATE OWL LOLLY 26G.&#34;,&#34;pr_puqty&#34;:&#34;24&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;F1222&#34;,&#34;pr_suref3&#34;:&#34;S&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;pr_country_th&#34;:null,&#34;pr_country_en&#34;:null,&#34;pr_keyword_th&#34;:null,&#34;pr_keyword_en&#34;:null,&#34;pr_filter_th&#34;:null,&#34;pr_filter_en&#34;:null,&#34;online_category_l1_th&#34;:null,&#34;online_category_l1_en&#34;:null,&#34;online_category_l2_th&#34;:null,&#34;online_category_l2_en&#34;:null,&#34;online_category_l3_th&#34;:null,&#34;online_category_l3_en&#34;:null,&#34;villa_category_l1_en&#34;:null,&#34;villa_category_l2_en&#34;:null,&#34;villa_category_l3_en&#34;:null,&#34;villa_category_l4_en&#34;:null,&#34;content_en&#34;:null,&#34;content_th&#34;:null,&#34;hema_brand_th&#34;:null,&#34;hema_brand_en&#34;:null,&#34;hema_sizedesc&#34;:null,&#34;pr_brand_en&#34;:null,&#34;pr_brand_th&#34;:null,&#34;pr_online_name_en&#34;:null,&#34;pr_online_name_th&#34;:null,&#34;hema_name_en&#34;:null,&#34;hema_name_th&#34;:null,&#34;pr_name_en&#34;:null,&#34;pr_name_th&#34;:null,&#34;sort_weight&#34;:null},{&#34;cprcode&#34;:9.0,&#34;iprcode&#34;:9.0,&#34;oprcode&#34;:9.0,&#34;ordertype&#34;:&#34;Y&#34;,&#34;pr_abb&#34;:&#34;J. WALKER RED 70 CL.&#34;,&#34;pr_active&#34;:&#34;Y&#34;,&#34;pr_cgcode&#34;:&#34;01&#34;,&#34;pr_code&#34;:&#34;0000009&#34;,&#34;pr_dpcode&#34;:&#34;01&#34;,&#34;pr_engname&#34;:&#34;JOHNNIE WALKER RED 70 CL.&#34;,&#34;pr_ggcode&#34;:&#34;001&#34;,&#34;pr_market&#34;:&#34;J. WALKER RED 70 CL&#34;,&#34;pr_name&#34;:&#34;JOHNNIE WALKER RED 70 CL&#34;,&#34;pr_puqty&#34;:&#34;12.00&#34;,&#34;pr_sa_method&#34;:&#34;1&#34;,&#34;pr_sucode1&#34;:&#34;1782&#34;,&#34;pr_suref3&#34;:&#34;A&#34;,&#34;prtype&#34;:&#34;I&#34;,&#34;psqty&#34;:&#34;1&#34;,&#34;pstype&#34;:&#34;1&#34;,&#34;pr_country_th&#34;:null,&#34;pr_country_en&#34;:&#34;United Kingdom&#34;,&#34;pr_keyword_th&#34;:null,&#34;pr_keyword_en&#34;:null,&#34;pr_filter_th&#34;:&#34;Alcohol,Spirits  Liqueurs&#34;,&#34;pr_filter_en&#34;:&#34;Alcohol,Spirits  Liqueurs&#34;,&#34;online_category_l1_th&#34;:&#34;\\u0e40\\u0e1a\\u0e35\\u0e22\\u0e23\\u0e4c, \\u0e44\\u0e27\\u0e19\\u0e4c\\u0e41\\u0e25\\u0e30\\u0e2a\\u0e38\\u0e23\\u0e32&#34;,&#34;online_category_l1_en&#34;:&#34;Beer Wine &amp; Spirits&#34;,&#34;online_category_l2_th&#34;:&#34;\\u0e40\\u0e2b\\u0e25\\u0e49\\u0e32&#34;,&#34;online_category_l2_en&#34;:&#34;Spirits &amp; Liqueurs&#34;,&#34;online_category_l3_th&#34;:null,&#34;online_category_l3_en&#34;:null,&#34;villa_category_l1_en&#34;:&#34;Dry Grocery&#34;,&#34;villa_category_l2_en&#34;:&#34;Alcohol &amp; Beverage&#34;,&#34;villa_category_l3_en&#34;:&#34;Whisky&#34;,&#34;villa_category_l4_en&#34;:&#34;Scoth Whisky&#34;,&#34;content_en&#34;:&#34;0000009 Johnnie Walker Red 700ml&#34;,&#34;content_th&#34;:&#34;JOHNNIE WALKER RED 700ml&#34;,&#34;hema_brand_th&#34;:&#34;Johnnie Walker&#34;,&#34;hema_brand_en&#34;:&#34;Johnnie Walker&#34;,&#34;hema_sizedesc&#34;:&#34;700ml&#34;,&#34;pr_brand_en&#34;:&#34;Johnnie Walker&#34;,&#34;pr_brand_th&#34;:&#34;Johnnie Walker&#34;,&#34;pr_online_name_en&#34;:&#34;Johnnie Walker Red 700ml&#34;,&#34;pr_online_name_th&#34;:&#34;JOHNNIE WALKER RED 700ml&#34;,&#34;hema_name_en&#34;:&#34;Johnnie Walker Red&#34;,&#34;hema_name_th&#34;:&#34;JOHNNIE WALKER RED&#34;,&#34;pr_name_en&#34;:&#34;JOHNNIE WALKER RED 70 CL.&#34;,&#34;pr_name_th&#34;:&#34;JOHNNIE WALKER RED 70 CL&#34;,&#34;sort_weight&#34;:&#34;0&#34;}]&#39;,
 &#39;statusCode&#39;: 200,
 &#39;headers&#39;: {&#39;Access-Control-Allow-Headers&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,
  &#39;Access-Control-Allow-Methods&#39;: &#39;*&#39;}}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sampleQueryInput</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="s1">&#39;0171670&#39;</span>
<span class="p">}</span>  
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">try</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;12345&#39;</span><span class="p">}))</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>key is not convertable to in 12345
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">singleProductQuery</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-37-3232817ebb61&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>ProductDatabase<span class="ansi-blue-fg">.</span>singleProductQuery<span class="ansi-blue-fg">(</span>sampleQueryInput<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/nicHelper/wrappers.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(cls, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span>         <span class="ansi-blue-fg">@</span>classmethod
<span class="ansi-green-intense-fg ansi-bold">     35</span>         <span class="ansi-green-fg">def</span> wrapper<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 36</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span> cls<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>         setattr<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> func<span class="ansi-blue-fg">.</span>__name__<span class="ansi-blue-fg">,</span> wrapper<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>         <span class="ansi-red-fg"># Note we are not binding func, but wrapper which accepts self but does exactly the same as func</span>

<span class="ansi-green-fg">~/SageMaker/stacks/villaMaster/villa-master-dev/product/database2/villaProductDatabase/query.py</span> in <span class="ansi-cyan-fg">singleProductQuery</span><span class="ansi-blue-fg">(cls, input_)</span>
<span class="ansi-green-intense-fg ansi-bold">     74</span> <span class="ansi-blue-fg">@</span>add_class_method<span class="ansi-blue-fg">(</span>Querier<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     75</span> <span class="ansi-green-fg">def</span> singleProductQuery<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">,</span> input_<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">-&gt;</span>pd<span class="ansi-blue-fg">.</span>Series<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 76</span><span class="ansi-red-fg">   </span><span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> cls<span class="ansi-blue-fg">.</span>validateInputQuery<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;iprcode&#39;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">,</span> input_<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> <span class="ansi-blue-fg">f&#34;error input {input_}&#34;</span>
<span class="ansi-green-intense-fg ansi-bold">     77</span>   iprcode <span class="ansi-blue-fg">=</span> int<span class="ansi-blue-fg">(</span>input_<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#39;iprcode&#39;</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>   <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">(</span>result<span class="ansi-blue-fg">:=</span>next<span class="ansi-blue-fg">(</span>cls<span class="ansi-blue-fg">.</span>query<span class="ansi-blue-fg">(</span>iprcode<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> <span class="ansi-green-fg">return</span> result<span class="ansi-blue-fg">.</span>toSeries<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/stacks/villaMaster/villa-master-dev/product/database2/villaProductDatabase/query.py</span> in <span class="ansi-cyan-fg">validateInputQuery</span><span class="ansi-blue-fg">(keys, input_)</span>
<span class="ansi-green-intense-fg ansi-bold">     41</span>         <span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#34;key {key} is missing from the input&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     42</span>       <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> type<span class="ansi-blue-fg">(</span>input_<span class="ansi-blue-fg">.</span>get<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span>int<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 43</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">f&#39;key is not convertable to in {input_.get(key)}&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     44</span>     <span class="ansi-green-fg">return</span> <span class="ansi-green-fg">True</span>
<span class="ansi-green-intense-fg ansi-bold">     45</span> 

<span class="ansi-red-fg">ValueError</span>: key is not convertable to in 0171670</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaSingleQuery" class="doc_header"><code>lambdaSingleQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L193" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaSingleQuery</code>(<strong><code>event</code></strong>, <strong><code>_</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">event</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span><span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">sampleQueryInput</span><span class="p">))</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
<span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="n">lambdaSingleQuery</span><span class="p">(</span><span class="n">Event</span><span class="o">.</span><span class="n">getInput</span><span class="p">({</span><span class="s1">&#39;iprcode&#39;</span><span class="p">:</span><span class="s1">&#39;11234&#39;</span><span class="p">}),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">Response</span><span class="o">.</span><span class="n">parseBody</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="AllQuery">AllQuery<a class="anchor-link" href="#AllQuery"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="kn">import</span> <span class="nn">zlib</span>
<span class="o">%</span><span class="k">time</span> url = ProductDatabase.allQuery(bucket = INVENTORY_BUCKET_NAME, key=&#39;allData-json.zl&#39;)
<span class="nb">print</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="c1"># response = requests.get(url)</span>
<span class="k">def</span> <span class="nf">retrieveJsonZl</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
  <span class="n">response</span><span class="p">:</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>
    <span class="n">jsonDb</span> <span class="o">=</span> <span class="n">zlib</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
    <span class="n">newDb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="n">jsonDb</span><span class="p">,</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;split&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">newDb</span>
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">]))</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">items</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;online_category_l1_en&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">newDb</span><span class="p">[</span><span class="s1">&#39;pr_suref3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQuery" class="doc_header"><code>lambdaAllQuery</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L202" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQuery</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">s3bz.s3bz</span> <span class="kn">import</span> <span class="n">Requests</span>
<span class="o">%</span><span class="k">time</span> url = Response.fromDict(lambdaAllQuery(&#39;&#39;, &#39;&#39;)).body[&#39;url&#39;]
<span class="o">%</span><span class="k">time</span> newDb = retrieveJsonZl(url)
<span class="n">newDb</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="AllQueryFeather">AllQueryFeather<a class="anchor-link" href="#AllQueryFeather"> </a></h4>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lambdaAllQueryFeather" class="doc_header"><code>lambdaAllQueryFeather</code><a href="https://github.com/thanakijwanavit/villaProductDatabase/tree/master/villaProductDatabase/database.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lambdaAllQueryFeather</code>(<strong><code>event</code></strong>, <strong>*<code>args</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">time</span> r = lambdaAllQueryFeather(&#39;&#39;)
<span class="o">%</span><span class="k">time</span> result = Response.fromDict(r).body
<span class="n">url</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">]</span>
<span class="o">%</span><span class="k">time</span> pd.read_feather(url)
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">database</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;url&#39;</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">pdUtils</span><span class="o">.</span><span class="n">getDfHash</span><span class="p">(</span><span class="n">database</span><span class="p">)</span> <span class="o">==</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;hash&#39;</span><span class="p">]</span> <span class="p">,</span> <span class="s1">&#39;database and hash are not the same&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Update-s3,-checking-scan-time">Update s3, checking scan time<a class="anchor-link" href="#Update-s3,-checking-scan-time"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;checking scan time&#39;</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ProductDatabase</span><span class="o">.</span><span class="n">scan</span><span class="p">()))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nicHelper.schema</span> <span class="kn">import</span> <span class="n">validateUrl</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">input_</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cprcode&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">,</span> <span class="s1">&#39;iprcode&#39;</span><span class="p">:</span> <span class="mi">123</span><span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">validateUrl</span><span class="p">(</span><span class="s1">&#39;https://raw.githubusercontent.com/thanakijwanavit/villaMasterSchema/master/Product.json&#39;</span><span class="p">,</span> <span class="n">input_</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">cprcode</span>
<span class="n">result</span><span class="o">.</span><span class="n">iprcode</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>123</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nicHelper.dictUtil</span> <span class="kn">import</span> <span class="n">genSchema</span>
<span class="kn">import</span> <span class="nn">yaml</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schema</span> <span class="o">=</span> <span class="n">genSchema</span><span class="p">(</span><span class="n">input_</span><span class="p">,</span><span class="n">format_</span><span class="o">=</span><span class="s1">&#39;yaml&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>$schema: http://json-schema.org/schema#
properties:
  cprcode:
    type: integer
  iprcode:
    type: integer
required:
- cprcode
- iprcode
type: object

</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">schemaDict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>&lt;ipython-input-17-e5d2d005a550&gt;:1: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  schemaDict = yaml.load(schema)
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">schemaDict</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;{&#34;$schema&#34;: &#34;http://json-schema.org/schema#&#34;, &#34;properties&#34;: {&#34;cprcode&#34;: {&#34;type&#34;: &#34;integer&#34;}, &#34;iprcode&#34;: {&#34;type&#34;: &#34;integer&#34;}}, &#34;required&#34;: [&#34;cprcode&#34;, &#34;iprcode&#34;], &#34;type&#34;: &#34;object&#34;}&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;/tmp/&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;tmpFile&#39;,
 &#39;input&#39;,
 &#39;hsperfdata_role-agent&#39;,
 &#39;tmpPath&#39;,
 &#39;tmpw7pzt324.json&#39;,
 &#39;testdict&#39;,
 &#39;test2&#39;,
 &#39;test4&#39;,
 &#39;test&#39;,
 &#39;tempFile.bz&#39;,
 &#39;tempFile&#39;,
 &#39;test1&#39;,
 &#39;product.json&#39;,
 &#39;teststr&#39;,
 &#39;.ICE-unix&#39;,
 &#39;feather&#39;,
 &#39;fish.ec2-user&#39;,
 &#39;zlibJsonCache.zl&#39;,
 &#39;test3&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_json</span><span class="p">(</span><span class="s1">&#39;/tmp/product.json&#39;</span><span class="p">,</span><span class="n">orient</span> <span class="o">=</span> <span class="s1">&#39;records&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-22-84c42d2c5305&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">import</span> pandas <span class="ansi-green-fg">as</span> pd
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg"> </span>pd<span class="ansi-blue-fg">.</span>read_json<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;/tmp/product.json&#39;</span><span class="ansi-blue-fg">,</span>orient <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">&#39;records&#39;</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/util/_decorators.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span>                 <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    198</span>                     kwargs<span class="ansi-blue-fg">[</span>new_arg_name<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> new_arg_value
<span class="ansi-green-fg">--&gt; 199</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    200</span> 
<span class="ansi-green-intense-fg ansi-bold">    201</span>         <span class="ansi-green-fg">return</span> cast<span class="ansi-blue-fg">(</span>F<span class="ansi-blue-fg">,</span> wrapper<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/util/_decorators.py</span> in <span class="ansi-cyan-fg">wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    294</span>                 )
<span class="ansi-green-intense-fg ansi-bold">    295</span>                 warnings<span class="ansi-blue-fg">.</span>warn<span class="ansi-blue-fg">(</span>msg<span class="ansi-blue-fg">,</span> FutureWarning<span class="ansi-blue-fg">,</span> stacklevel<span class="ansi-blue-fg">=</span>stacklevel<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 296</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> func<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    297</span> 
<span class="ansi-green-intense-fg ansi-bold">    298</span>         <span class="ansi-green-fg">return</span> wrapper

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/io/json/_json.py</span> in <span class="ansi-cyan-fg">read_json</span><span class="ansi-blue-fg">(path_or_buf, orient, typ, dtype, convert_axes, convert_dates, keep_default_dates, numpy, precise_float, date_unit, encoding, lines, chunksize, compression, nrows)</span>
<span class="ansi-green-intense-fg ansi-bold">    616</span>         <span class="ansi-green-fg">return</span> json_reader
<span class="ansi-green-intense-fg ansi-bold">    617</span> 
<span class="ansi-green-fg">--&gt; 618</span><span class="ansi-red-fg">     </span>result <span class="ansi-blue-fg">=</span> json_reader<span class="ansi-blue-fg">.</span>read<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    619</span>     <span class="ansi-green-fg">if</span> should_close<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    620</span>         filepath_or_buffer<span class="ansi-blue-fg">.</span>close<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/io/json/_json.py</span> in <span class="ansi-cyan-fg">read</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    753</span>                 obj <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get_object_parser<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_combine_lines<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    754</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 755</span><span class="ansi-red-fg">             </span>obj <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>_get_object_parser<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>data<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    756</span>         self<span class="ansi-blue-fg">.</span>close<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    757</span>         <span class="ansi-green-fg">return</span> obj

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/io/json/_json.py</span> in <span class="ansi-cyan-fg">_get_object_parser</span><span class="ansi-blue-fg">(self, json)</span>
<span class="ansi-green-intense-fg ansi-bold">    775</span>         obj <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">    776</span>         <span class="ansi-green-fg">if</span> typ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;frame&#34;</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 777</span><span class="ansi-red-fg">             </span>obj <span class="ansi-blue-fg">=</span> FrameParser<span class="ansi-blue-fg">(</span>json<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>parse<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    778</span> 
<span class="ansi-green-intense-fg ansi-bold">    779</span>         <span class="ansi-green-fg">if</span> typ <span class="ansi-blue-fg">==</span> <span class="ansi-blue-fg">&#34;series&#34;</span> <span class="ansi-green-fg">or</span> obj <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/io/json/_json.py</span> in <span class="ansi-cyan-fg">parse</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    884</span> 
<span class="ansi-green-intense-fg ansi-bold">    885</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 886</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>_parse_no_numpy<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    887</span> 
<span class="ansi-green-intense-fg ansi-bold">    888</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>obj <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/site-packages/pandas/io/json/_json.py</span> in <span class="ansi-cyan-fg">_parse_no_numpy</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">   1136</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1137</span>             self.obj = DataFrame(
<span class="ansi-green-fg">-&gt; 1138</span><span class="ansi-red-fg">                 </span>loads<span class="ansi-blue-fg">(</span>json<span class="ansi-blue-fg">,</span> precise_float<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>precise_float<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span>
<span class="ansi-green-intense-fg ansi-bold">   1139</span>             )
<span class="ansi-green-intense-fg ansi-bold">   1140</span> 

<span class="ansi-red-fg">ValueError</span>: Unexpected character found when decoding object value</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">with</span> <span class="nb">open</span> <span class="p">(</span><span class="s1">&#39;/tmp/product.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
  <span class="n">productJson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">JSONDecodeError</span>                           Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-23-675b30535d7e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span class="ansi-green-fg">with</span> open <span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#39;/tmp/product.json&#39;</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;r&#39;</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">as</span> f<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">----&gt; 2</span><span class="ansi-red-fg">   </span>productJson <span class="ansi-blue-fg">=</span> json<span class="ansi-blue-fg">.</span>load<span class="ansi-blue-fg">(</span>f<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/json/__init__.py</span> in <span class="ansi-cyan-fg">load</span><span class="ansi-blue-fg">(fp, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    291</span>     kwarg<span class="ansi-blue-fg">;</span> otherwise<span class="ansi-red-fg"> </span><span class="ansi-red-fg">`</span><span class="ansi-red-fg">`</span>JSONDecoder<span class="ansi-red-fg">`</span><span class="ansi-red-fg">`</span> <span class="ansi-green-fg">is</span> used<span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">    292</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 293</span><span class="ansi-red-fg">     return loads(fp.read(),
</span><span class="ansi-green-intense-fg ansi-bold">    294</span>         cls<span class="ansi-blue-fg">=</span>cls<span class="ansi-blue-fg">,</span> object_hook<span class="ansi-blue-fg">=</span>object_hook<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    295</span>         parse_float<span class="ansi-blue-fg">=</span>parse_float<span class="ansi-blue-fg">,</span> parse_int<span class="ansi-blue-fg">=</span>parse_int<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/json/__init__.py</span> in <span class="ansi-cyan-fg">loads</span><span class="ansi-blue-fg">(s, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)</span>
<span class="ansi-green-intense-fg ansi-bold">    355</span>             parse_int <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span> parse_float <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span> <span class="ansi-green-fg">and</span>
<span class="ansi-green-intense-fg ansi-bold">    356</span>             parse_constant is None and object_pairs_hook is None and not kw):
<span class="ansi-green-fg">--&gt; 357</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> _default_decoder<span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    358</span>     <span class="ansi-green-fg">if</span> cls <span class="ansi-green-fg">is</span> <span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    359</span>         cls <span class="ansi-blue-fg">=</span> JSONDecoder

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/json/decoder.py</span> in <span class="ansi-cyan-fg">decode</span><span class="ansi-blue-fg">(self, s, _w)</span>
<span class="ansi-green-intense-fg ansi-bold">    335</span> 
<span class="ansi-green-intense-fg ansi-bold">    336</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 337</span><span class="ansi-red-fg">         </span>obj<span class="ansi-blue-fg">,</span> end <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>raw_decode<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">,</span> idx<span class="ansi-blue-fg">=</span>_w<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>end<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    338</span>         end <span class="ansi-blue-fg">=</span> _w<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">,</span> end<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>end<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    339</span>         <span class="ansi-green-fg">if</span> end <span class="ansi-blue-fg">!=</span> len<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/SageMaker/.persisted_conda/python38/lib/python3.8/json/decoder.py</span> in <span class="ansi-cyan-fg">raw_decode</span><span class="ansi-blue-fg">(self, s, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">    351</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    352</span>         <span class="ansi-green-fg">try</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 353</span><span class="ansi-red-fg">             </span>obj<span class="ansi-blue-fg">,</span> end <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>scan_once<span class="ansi-blue-fg">(</span>s<span class="ansi-blue-fg">,</span> idx<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    354</span>         <span class="ansi-green-fg">except</span> StopIteration <span class="ansi-green-fg">as</span> err<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    355</span>             <span class="ansi-green-fg">raise</span> JSONDecodeError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;Expecting value&#34;</span><span class="ansi-blue-fg">,</span> s<span class="ansi-blue-fg">,</span> err<span class="ansi-blue-fg">.</span>value<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">from</span> <span class="ansi-green-fg">None</span>

<span class="ansi-red-fg">JSONDecodeError</span>: Expecting &#39;,&#39; delimiter: line 1 column 6291457 (char 6291456)</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

